THREE.DecalVertex=function(l,n){this.vertex=l;this.normal=n};THREE.DecalVertex.prototype.clone=function(){return new THREE.DecalVertex(this.vertex.clone(),this.normal.clone())};
THREE.DecalGeometry=function(l,n,r,p,k){THREE.Geometry.call(this);void 0===k&&(k=null);k=k||new THREE.Vector3(1,1,1);this.uvs=[];this.cube=new THREE.Mesh(new THREE.BoxGeometry(p.x,p.y,p.z),new THREE.MeshBasicMaterial);this.cube.rotation.set(r.x,r.y,r.z);this.cube.position.copy(n);this.cube.scale.set(1,1,1);this.cube.updateMatrix();this.iCubeMatrix=(new THREE.Matrix4).getInverse(this.cube.matrix);this.faceIndices=["a","b","c","d"];this.clipFace=function(c,a){function b(a,b,c){var d=a.vertex.dot(c)-
e;c=b.vertex.dot(c)-e;d/=d-c;return new THREE.DecalVertex(new THREE.Vector3(a.vertex.x+d*(b.vertex.x-a.vertex.x),a.vertex.y+d*(b.vertex.y-a.vertex.y),a.vertex.z+d*(b.vertex.z-a.vertex.z)),new THREE.Vector3(a.normal.x+d*(b.normal.x-a.normal.x),a.normal.y+d*(b.normal.y-a.normal.y),a.normal.z+d*(b.normal.z-a.normal.z)))}var e=.5*Math.abs(p.clone().dot(a));if(0===c.length)return[];for(var f=[],d=0;d<c.length;d+=3){var k,l,q,n=0;k=c[d+0].vertex.dot(a)-e;l=c[d+1].vertex.dot(a)-e;q=c[d+2].vertex.dot(a)-
e;k=0<k;l=0<l;q=0<q;n=(k?1:0)+(l?1:0)+(q?1:0);switch(n){case 0:f.push(c[d]);f.push(c[d+1]);f.push(c[d+2]);break;case 1:var g,h,m;k&&(g=c[d+1],h=c[d+2],m=b(c[d],g,a),nV4=b(c[d],h,a));if(l){g=c[d];h=c[d+2];m=b(c[d+1],g,a);nV4=b(c[d+1],h,a);f.push(m);f.push(h.clone());f.push(g.clone());f.push(h.clone());f.push(m.clone());f.push(nV4);break}q&&(g=c[d],h=c[d+1],m=b(c[d+2],g,a),nV4=b(c[d+2],h,a));f.push(g.clone());f.push(h.clone());f.push(m);f.push(nV4);f.push(m.clone());f.push(h.clone());break;case 2:k||
(g=c[d].clone(),h=b(g,c[d+1],a),m=b(g,c[d+2],a),f.push(g),f.push(h),f.push(m)),l||(g=c[d+1].clone(),h=b(g,c[d+2],a),m=b(g,c[d],a),f.push(g),f.push(h),f.push(m)),q||(g=c[d+2].clone(),h=b(g,c[d],a),m=b(g,c[d+1],a),f.push(g),f.push(h),f.push(m))}}return f};this.pushVertex=function(c,a,b){a=l.geometry.vertices[a].clone();a.applyMatrix4(l.matrix);a.applyMatrix4(this.iCubeMatrix);c.push(new THREE.DecalVertex(a,b.clone()))};this.computeDecal=function(){for(var c=[],a=0;a<l.geometry.faces.length;a++){var b=
l.geometry.faces[a],e=[];3===(b instanceof THREE.Face3?3:4)?(this.pushVertex(e,b[this.faceIndices[0]],b.vertexNormals[0]),this.pushVertex(e,b[this.faceIndices[1]],b.vertexNormals[1])):(this.pushVertex(e,b[this.faceIndices[0]],b.vertexNormals[0]),this.pushVertex(e,b[this.faceIndices[1]],b.vertexNormals[1]),this.pushVertex(e,b[this.faceIndices[2]],b.vertexNormals[2]),this.pushVertex(e,b[this.faceIndices[3]],b.vertexNormals[3]),this.pushVertex(e,b[this.faceIndices[0]],b.vertexNormals[0]));this.pushVertex(e,
b[this.faceIndices[2]],b.vertexNormals[2]);k.x&&(e=this.clipFace(e,new THREE.Vector3(1,0,0)),e=this.clipFace(e,new THREE.Vector3(-1,0,0)));k.y&&(e=this.clipFace(e,new THREE.Vector3(0,1,0)),e=this.clipFace(e,new THREE.Vector3(0,-1,0)));k.z&&(e=this.clipFace(e,new THREE.Vector3(0,0,1)),e=this.clipFace(e,new THREE.Vector3(0,0,-1)));for(b=0;b<e.length;b++){var f=e[b];this.uvs.push(new THREE.Vector2(.5+f.vertex.x/p.x,.5+f.vertex.y/p.y));e[b].vertex.applyMatrix4(this.cube.matrix)}0!==e.length&&Array.prototype.push.apply(c,
e)}for(a=0;a<c.length;a+=3)this.vertices.push(c[a].vertex,c[a+1].vertex,c[a+2].vertex),b=new THREE.Face3(a,a+1,a+2),b.vertexNormals.push(c[a+0].normal),b.vertexNormals.push(c[a+1].normal),b.vertexNormals.push(c[a+2].normal),this.faces.push(b),this.faceVertexUvs[0].push([this.uvs[a],this.uvs[a+1],this.uvs[a+2]]);this.tangentsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.morphTargetsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!0;this.computeFaceNormals()};
this.computeDecal()};THREE.DecalGeometry.prototype=Object.create(THREE.Geometry.prototype);