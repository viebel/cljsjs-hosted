(function(r,u){"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?exports=module.exports=u():exports.diffDOM=u():"function"===typeof define?define(u):r.diffDOM=u()})(this,function(){function r(b,a,c){var d=b[a];b[a]=b[c];b[c]=d}var u,y=!1,p=function(b){if(b){var a=Object.keys(b),c=a.length,d;for(d=0;d<c;d++)this[a[d]]=b[a[d]]}};p.prototype={toString:function(){return JSON.stringify(this)},setValue:function(b,a){this[b]=a;return this}};var z=function(b){var a=[];"#text"!==b.nodeName&&
"#comment"!==b.nodeName&&(a.push(b.nodeName),b.attributes&&(b.attributes["class"]&&a.push(b.nodeName+"."+b.attributes["class"].replace(/ /g,".")),b.attributes.id&&a.push(b.nodeName+"#"+b.attributes.id)));return a},D=function(b){var a={},c={},d=b.length,e,f,g,k,h,l,n;for(l=0;l<d;l++)for(f=b[l],e=f.length,f=z(f),n=0;n<e;n++)(g=f[n],k=g in a,h=g in c,k||h)?k&&(delete a[g],c[g]=!0):a[g]=!0;return a},E=function(b,a){var c=D(b),d=D(a),e={},c=Object.keys(c),f=c.length,g,k;for(k=0;k<f;k++)g=c[k],d[g]&&(e[g]=
!0);return e},F=function(b){delete b.outerDone;delete b.innerDone;delete b.valueDone;return b.childNodes?b.childNodes.every(F):!0},A=function(b,a){var c,d;return!["nodeName","value","checked","selected","data"].every(function(c){return b[c]!==a[c]?!1:!0})||!!b.attributes!==!!a.attributes||!!b.childNodes!==!!a.childNodes||b.attributes&&(c=Object.keys(b.attributes),d=Object.keys(a.attributes),c.length!==d.length||!c.every(function(c){return b.attributes[c]!==a.attributes[c]?!1:!0}))?!1:!b.childNodes||
b.childNodes.length===a.childNodes.length&&b.childNodes.every(function(b,c){return A(b,a.childNodes[c])})?!0:!1},B=function(b,a,c,d,e){var f,g;if(!b||!a||b.nodeName!==a.nodeName)return!1;if("#text"===b.nodeName)return e?!0:b.data===a.data;if(b.nodeName in c)return!0;if(b.attributes&&a.attributes){if(b.attributes.id){if(b.attributes.id!==a.attributes.id)return!1;if(b.nodeName+"#"+b.attributes.id in c)return!0}if(b.attributes["class"]&&b.attributes["class"]===a.attributes["class"]&&b.nodeName+"."+b.attributes["class"].replace(/ /g,
".")in c)return!0}if(d)return!0;b=b.childNodes?b.childNodes.slice().reverse():[];g=a.childNodes?a.childNodes.slice().reverse():[];if(b.length!==g.length)return!1;if(e)return b.every(function(a,b){return a.nodeName===g[b].nodeName});f=E(b,g);return b.every(function(a,b){return B(a,g[b],f,!0,!0)})},t=function(b){return JSON.parse(JSON.stringify(b))},H=function(b,a,c,d){var e=0,f=[],g=b.length,k=a.length,h=Array.apply(null,Array(g+1)).map(function(){return[]}),l=E(b,a),n=g===k,m,q,w,v;n&&b.some(function(b,
c){var d=z(b),e=z(a[c]);if(d.length!==e.length)return n=!1,!0;d.some(function(a,b){if(a!==e[b])return n=!1,!0});if(!n)return!0});for(m=0;m<g;m++)for(w=b[m],q=0;q<k;q++)v=a[q],c[m]||d[q]||!B(w,v,l,n)?h[m+1][q+1]=0:(h[m+1][q+1]=h[m][q]?h[m][q]+1:1,h[m+1][q+1]>=e&&(e=h[m+1][q+1],f=[m+1,q+1]));return 0===e?!1:{oldValue:f[0]-e,newValue:f[1]-e,length:e}},x=function(b,a){return Array.apply(null,Array(b)).map(function(){return a})},I=function(b,a){for(var c=b.childNodes?b.childNodes:[],d=a.childNodes?a.childNodes:
[],e=x(c.length,!1),f=x(d.length,!1),g=[],k=!0,h=function(a,b){return b},l=function(a){e[k.oldValue+a]=!0;f[k.newValue+a]=!0},n,m,q;k;)if(k=H(c,d,e,f))for(g.push(k),m=Array.apply(null,Array(k.length)).map(h),n=m.length,q=0;q<n;q++)l(m[q]);b.subsets=g;b.subsetsAge=100;return g},G=function(){this.list=[]};G.prototype={list:!1,add:function(b){this.list.push.apply(this.list,b)},forEach:function(b){var a=this.list.length,c;for(c=0;c<a;c++)b(this.list[c])}};var C=function(b){var a={debug:!1,diffcap:10,
maxDepth:!1,maxChildCount:50,maxChildDiffCount:3,valueDiffing:!0,textDiff:function(a,b,c,g){a.data=g},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1},c;"undefined"===typeof b&&(b={});for(c in a)this[c]="undefined"===typeof b[c]?a[c]:b[c];b={addAttribute:"addAttribute",modifyAttribute:"modifyAttribute",removeAttribute:"removeAttribute",modifyTextElement:"modifyTextElement",relocateGroup:"relocateGroup",
removeElement:"removeElement",addElement:"addElement",removeTextElement:"removeTextElement",addTextElement:"addTextElement",replaceElement:"replaceElement",modifyValue:"modifyValue",modifyChecked:"modifyChecked",modifySelected:"modifySelected",modifyComment:"modifyComment",action:"action",route:"route",oldValue:"oldValue",newValue:"newValue",element:"element",group:"group",from:"from",to:"to",name:"name",value:"value",data:"data",attributes:"attributes",nodeName:"nodeName",childNodes:"childNodes",
checked:"checked",selected:"selected"};if(this.compress)for(c in a=0,this._const={},b)this._const[c]=a,a++;else this._const=b};C.Diff=p;C.prototype={diff:function(b,a){var c=this.nodeToObj(b),d=this.nodeToObj(a);u=0;this.debug&&(this.t1Orig=this.nodeToObj(b),this.t2Orig=this.nodeToObj(a));this.tracker=new G;return this.findDiffs(c,d)},findDiffs:function(b,a){var c;do{if(this.debug&&(u+=1,u>this.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+
" -\x3e "+JSON.stringify(this.t2Orig));c=this.findNextDiff(b,a,[]);0!==c.length||A(b,a)||(y?(console.error("Could not find remaining diffs!"),console.log({t1:b,t2:a})):(y=!0,F(b),c=this.findNextDiff(b,a,[])));0<c.length&&(y=!1,this.tracker.add(c),this.applyVirtual(b,c))}while(0<c.length);return this.tracker.list},findNextDiff:function(b,a,c){var d,e;if(this.maxDepth&&c.length>this.maxDepth)return[];if(!b.outerDone){d=this.findOuterDiff(b,a,c);this.filterOuterDiff&&(e=this.filterOuterDiff(b,a,d))&&
(d=e);if(0<d.length)return b.outerDone=!0,d;b.outerDone=!0}if(!b.innerDone){d=this.findInnerDiff(b,a,c);if(0<d.length)return d;b.innerDone=!0}if(this.valueDiffing&&!b.valueDone){d=this.findValueDiff(b,a,c);if(0<d.length)return b.valueDone=!0,d;b.valueDone=!0}return[]},findOuterDiff:function(b,a,c){var d=[],e,f,g,k,h,l;if(b.nodeName!==a.nodeName)return[(new p).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,t(b)).setValue(this._const.newValue,t(a)).setValue(this._const.route,
c)];if(c.length&&this.maxChildCount&&b.childNodes&&a.childNodes&&b.childNodes.length>this.maxChildCount&&a.childNodes.length>this.maxChildCount){e=b.childNodes.length<a.childNodes.length?b.childNodes.length:a.childNodes.length;for(g=f=0;f<this.maxChildDiffCount&&g<e;)A(b.childNodes[g],a.childNodes[g])||f++,g++;if(f===this.maxChildDiffCount)return[(new p).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,t(b)).setValue(this._const.newValue,t(a)).setValue(this._const.route,
c)]}if(b.data!==a.data)return"#text"===b.nodeName?[(new p).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,c).setValue(this._const.oldValue,b.data).setValue(this._const.newValue,a.data)]:[(new p).setValue(this._const.action,this._const.modifyComment).setValue(this._const.route,c).setValue(this._const.oldValue,b.data).setValue(this._const.newValue,a.data)];f=b.attributes?Object.keys(b.attributes).sort():[];g=a.attributes?Object.keys(a.attributes).sort():[];k=f.length;
for(l=0;l<k;l++)e=f[l],h=g.indexOf(e),-1===h?d.push((new p).setValue(this._const.action,this._const.removeAttribute).setValue(this._const.route,c).setValue(this._const.name,e).setValue(this._const.value,b.attributes[e])):(g.splice(h,1),b.attributes[e]!==a.attributes[e]&&d.push((new p).setValue(this._const.action,this._const.modifyAttribute).setValue(this._const.route,c).setValue(this._const.name,e).setValue(this._const.oldValue,b.attributes[e]).setValue(this._const.newValue,a.attributes[e])));k=g.length;
for(l=0;l<k;l++)e=g[l],d.push((new p).setValue(this._const.action,this._const.addAttribute).setValue(this._const.route,c).setValue(this._const.name,e).setValue(this._const.value,a.attributes[e]));return d},nodeToObj:function(b){var a={},c,d,e,f;a.nodeName=b.nodeName;if("#text"===a.nodeName||"#comment"===a.nodeName)a.data=b.data;else{if(b.attributes&&0<b.attributes.length)for(a.attributes={},c=Array.prototype.slice.call(b.attributes),e=c.length,f=0;f<e;f++)d=c[f],a.attributes[d.name]=d.value;if("TEXTAREA"===
a.nodeName)a.value=b.value;else if(b.childNodes&&0<b.childNodes.length)for(a.childNodes=[],c=Array.prototype.slice.call(b.childNodes),e=c.length,f=0;f<e;f++)d=c[f],a.childNodes.push(this.nodeToObj(d));this.valueDiffing&&(void 0!==b.checked&&b.type&&-1!==["radio","checkbox"].indexOf(b.type.toLowerCase())?a.checked=b.checked:void 0!==b.value&&(a.value=b.value),void 0!==b.selected&&(a.selected=b.selected))}return a},objToNode:function(b,a){var c,d,e,f,g;if("#text"===b.nodeName)c=document.createTextNode(b.data);
else if("#comment"===b.nodeName)c=document.createComment(b.data);else{"svg"===b.nodeName||a?(c=document.createElementNS("http://www.w3.org/2000/svg",b.nodeName),a=!0):c=document.createElement(b.nodeName);if(b.attributes)for(e=Object.keys(b.attributes),f=e.length,g=0;g<f;g++)d=e[g],c.setAttribute(d,b.attributes[d]);if(b.childNodes)for(e=b.childNodes,f=e.length,g=0;g<f;g++)d=e[g],c.appendChild(this.objToNode(d,a));this.valueDiffing&&(b.value&&(c.value=b.value),b.checked&&(c.checked=b.checked),b.selected&&
(c.selected=b.selected))}return c},findInnerDiff:function(b,a,c){var d=b.subsets&&b.subsetsAge--?b.subsets:b.childNodes&&a.childNodes?I(b,a):[],e=b.childNodes?b.childNodes:[],f=a.childNodes?a.childNodes:[],g,k=[],h=0,l,n;if(0<d.length&&(k=this.attemptGroupRelocation(b,a,d,c),0<k.length))return k;a=Math.max(e.length,f.length);e.length!==f.length&&(g=!0);for(n=0;n<a;n+=1)d=e[n],l=f[n],g&&(d&&!l?("#text"===d.nodeName?k.push((new p).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,
c.concat(h)).setValue(this._const.value,d.data)):k.push((new p).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,c.concat(h)).setValue(this._const.element,t(d))),--h):l&&!d&&("#text"===l.nodeName?k.push((new p).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,c.concat(h)).setValue(this._const.value,l.data)):k.push((new p).setValue(this._const.action,this._const.addElement).setValue(this._const.route,c.concat(h)).setValue(this._const.element,
t(l))))),d&&l&&(k=k.concat(this.findNextDiff(d,l,c.concat(h)))),h+=1;b.innerDone=!0;return k},attemptGroupRelocation:function(b,a,c,d){var e=b.childNodes?x(b.childNodes.length,!0):[],f=a.childNodes?x(a.childNodes.length,!0):[],g=0,k=c.length,h,l,n,m,q;for(h=0;h<k;h++){q=c[h];n=q.oldValue+q.length;m=q.newValue+q.length;for(l=q.oldValue;l<n;l+=1)e[l]=g;for(l=q.newValue;l<m;l+=1)f[l]=g;g+=1}l=Math.min(e.length,f.length);for(var w,g=[],v,k=h=0;h<l;k+=1,h+=1)if(!0===e[h]){l=b.childNodes[k];if("#text"===
l.nodeName){if("#text"===a.childNodes[h].nodeName&&l.data!==a.childNodes[h].data){for(n=k;b.childNodes.length>n+1&&"#text"===b.childNodes[n+1].nodeName;)if(n+=1,a.childNodes[h].data===b.childNodes[n].data){w=!0;break}if(!w){g.push((new p).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,d.concat(h)).setValue(this._const.oldValue,l.data).setValue(this._const.newValue,a.childNodes[h].data));break}}g.push((new p).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,
d.concat(h)).setValue(this._const.value,l.data))}else g.push((new p).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,d.concat(h)).setValue(this._const.element,t(l)));e.splice(h,1);l=Math.min(e.length,f.length);--h}else if(!0===f[h])l=a.childNodes[h],"#text"===l.nodeName?g.push((new p).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,d.concat(h)).setValue(this._const.value,l.data)):g.push((new p).setValue(this._const.action,this._const.addElement).setValue(this._const.route,
d.concat(h)).setValue(this._const.element,t(l))),e.splice(h,0,!0),l=Math.min(e.length,f.length),--k;else if(e[h]!==f[h]){if(0<g.length)break;q=c[e[h]];m=Math.min(q.newValue,b.childNodes.length-q.length);if(m!==q.oldValue){n=!1;for(v=0;v<q.length;v+=1)B(b.childNodes[m+v],b.childNodes[q.oldValue+v],[],!1,!0)||(n=!0);if(n)return[(new p).setValue(this._const.action,this._const.relocateGroup).setValue("groupLength",q.length).setValue(this._const.from,q.oldValue).setValue(this._const.to,m).setValue(this._const.route,
d)]}}return g},findValueDiff:function(b,a,c){var d=[];b.selected!==a.selected&&d.push((new p).setValue(this._const.action,this._const.modifySelected).setValue(this._const.oldValue,b.selected).setValue(this._const.newValue,a.selected).setValue(this._const.route,c));(b.value||a.value)&&b.value!==a.value&&"OPTION"!==b.nodeName&&d.push((new p).setValue(this._const.action,this._const.modifyValue).setValue(this._const.oldValue,b.value).setValue(this._const.newValue,a.value).setValue(this._const.route,c));
b.checked!==a.checked&&d.push((new p).setValue(this._const.action,this._const.modifyChecked).setValue(this._const.oldValue,b.checked).setValue(this._const.newValue,a.checked).setValue(this._const.route,c));return d},applyVirtual:function(b,a){var c=a.length,d,e;if(0===c)return!0;for(e=0;e<c;e++)d=a[e],this.applyVirtualDiff(b,d);return!0},getFromVirtualRoute:function(b,a){var c=b,d,e;for(a=a.slice();0<a.length;){if(!c.childNodes)return!1;e=a.splice(0,1)[0];d=c;c=c.childNodes[e]}return{node:c,parentNode:d,
nodeIndex:e}},applyVirtualDiff:function(b,a){var c=this.getFromVirtualRoute(b,a[this._const.route]),d=c.node,e=c.parentNode,f=c.nodeIndex,g=[],k,h,l,n,m,q,p=this,c={diff:a,node:d};if(this.preVirtualDiffApply(c))return!0;switch(a[this._const.action]){case this._const.addAttribute:d.attributes||(d.attributes={});d.attributes[a[this._const.name]]=a[this._const.value];"checked"===a[this._const.name]?d.checked=!0:"selected"===a[this._const.name]?d.selected=!0:"INPUT"===d.nodeName&&"value"===a[this._const.name]&&
(d.value=a[this._const.value]);break;case this._const.modifyAttribute:d.attributes[a[this._const.name]]=a[this._const.newValue];"INPUT"===d.nodeName&&"value"===a[this._const.name]&&(d.value=a[this._const.value]);break;case this._const.removeAttribute:delete d.attributes[a[this._const.name]];0===Object.keys(d.attributes).length&&delete d.attributes;"checked"===a[this._const.name]?d.checked=!1:"selected"===a[this._const.name]?delete d.selected:"INPUT"===d.nodeName&&"value"===a[this._const.name]&&delete d.value;
break;case this._const.modifyTextElement:d.data=a[this._const.newValue];break;case this._const.modifyValue:d.value=a[this._const.newValue];break;case this._const.modifyComment:d.data=a[this._const.newValue];break;case this._const.modifyChecked:d.checked=a[this._const.newValue];break;case this._const.modifySelected:d.selected=a[this._const.newValue];break;case this._const.replaceElement:h=t(a[this._const.newValue]);h.outerDone=!0;h.innerDone=!0;h.valueDone=!0;e.childNodes[f]=h;break;case this._const.relocateGroup:l=
d.childNodes.splice(a[this._const.from],a.groupLength).reverse();n=l.length;for(q=0;q<n;q++)e=l[q],d.childNodes.splice(a[p._const.to],0,e);d.subsets&&d.subsets.forEach(function(b){a[p._const.from]<a[p._const.to]&&b.oldValue<=a[p._const.to]&&b.oldValue>a[p._const.from]?(b.oldValue-=a.groupLength,k=b.oldValue+b.length-a[p._const.to],0<k&&(g.push({oldValue:a[p._const.to]+a.groupLength,newValue:b.newValue+b.length-k,length:k}),b.length-=k)):a[p._const.from]>a[p._const.to]&&b.oldValue>a[p._const.to]&&
b.oldValue<a[p._const.from]?(b.oldValue+=a.groupLength,k=b.oldValue+b.length-a[p._const.to],0<k&&(g.push({oldValue:a[p._const.to]+a.groupLength,newValue:b.newValue+b.length-k,length:k}),b.length-=k)):b.oldValue===a[p._const.from]&&(b.oldValue=a[p._const.to])});break;case this._const.removeElement:e.childNodes.splice(f,1);e.subsets&&e.subsets.forEach(function(a){a.oldValue>f?--a.oldValue:a.oldValue===f?a.delete=!0:a.oldValue<f&&a.oldValue+a.length>f&&(a.oldValue+a.length-1===f?a.length--:(g.push({newValue:a.newValue+
f-a.oldValue,oldValue:f,length:a.length-f+a.oldValue-1}),a.length=f-a.oldValue))});d=e;break;case this._const.addElement:d=a[this._const.route].slice();m=d.splice(d.length-1,1)[0];d=this.getFromVirtualRoute(b,d).node;h=t(a[this._const.element]);h.outerDone=!0;h.innerDone=!0;h.valueDone=!0;d.childNodes||(d.childNodes=[]);m>=d.childNodes.length?d.childNodes.push(h):d.childNodes.splice(m,0,h);d.subsets&&d.subsets.forEach(function(a){a.oldValue>=m?a.oldValue+=1:a.oldValue<m&&a.oldValue+a.length>m&&(k=
a.oldValue+a.length-m,g.push({newValue:a.newValue+a.length-k,oldValue:m+1,length:k}),a.length-=k)});break;case this._const.removeTextElement:e.childNodes.splice(f,1);"TEXTAREA"===e.nodeName&&delete e.value;e.subsets&&e.subsets.forEach(function(a){a.oldValue>f?--a.oldValue:a.oldValue===f?a.delete=!0:a.oldValue<f&&a.oldValue+a.length>f&&(a.oldValue+a.length-1===f?a.length--:(g.push({newValue:a.newValue+f-a.oldValue,oldValue:f,length:a.length-f+a.oldValue-1}),a.length=f-a.oldValue))});d=e;break;case this._const.addTextElement:d=
a[this._const.route].slice();m=d.splice(d.length-1,1)[0];h={nodeName:"#text"};h.data=a[this._const.value];d=this.getFromVirtualRoute(b,d).node;d.childNodes||(d.childNodes=[]);m>=d.childNodes.length?d.childNodes.push(h):d.childNodes.splice(m,0,h);"TEXTAREA"===d.nodeName&&(d.value=a[this._const.newValue]);d.subsets&&d.subsets.forEach(function(a){a.oldValue>=m&&(a.oldValue+=1);a.oldValue<m&&a.oldValue+a.length>m&&(k=a.oldValue+a.length-m,g.push({newValue:a.newValue+a.length-k,oldValue:m+1,length:k}),
a.length-=k)});break;default:console.log("unknown action")}d.subsets&&(d.subsets=d.subsets.filter(function(a){return!a.delete&&a.oldValue!==a.newValue}),g.length&&(d.subsets=d.subsets.concat(g)));c.newNode=h;this.postVirtualDiffApply(c)},apply:function(b,a){var c=a.length,d,e;if(0===c)return!0;for(e=0;e<c;e++)if(d=a[e],!this.applyDiff(b,d))return!1;return!0},getFromRoute:function(b,a){a=a.slice();for(var c,d=b;0<a.length;){if(!d.childNodes)return!1;c=a.splice(0,1)[0];d=d.childNodes[c]}return d},applyDiff:function(b,
a){var c=this.getFromRoute(b,a[this._const.route]),d,e,f,g,k,h,l=this,n={diff:a,node:c};if(this.preDiffApply(n))return!0;switch(a[this._const.action]){case this._const.addAttribute:if(!c||!c.setAttribute)return!1;c.setAttribute(a[this._const.name],a[this._const.value]);break;case this._const.modifyAttribute:if(!c||!c.setAttribute)return!1;c.setAttribute(a[this._const.name],a[this._const.newValue]);break;case this._const.removeAttribute:if(!c||!c.removeAttribute)return!1;c.removeAttribute(a[this._const.name]);
break;case this._const.modifyTextElement:if(!c||3!==c.nodeType)return!1;this.textDiff(c,c.data,a[this._const.oldValue],a[this._const.newValue]);break;case this._const.modifyValue:if(!c||"undefined"===typeof c.value)return!1;c.value=a[this._const.newValue];break;case this._const.modifyComment:if(!c||"undefined"===typeof c.data)return!1;this.textDiff(c,c.data,a[this._const.oldValue],a[this._const.newValue]);break;case this._const.modifyChecked:if(!c||"undefined"===typeof c.checked)return!1;c.checked=
a[this._const.newValue];break;case this._const.modifySelected:if(!c||"undefined"===typeof c.selected)return!1;c.selected=a[this._const.newValue];break;case this._const.replaceElement:c.parentNode.replaceChild(this.objToNode(a[this._const.newValue],"http://www.w3.org/2000/svg"===c.namespaceURI),c);break;case this._const.relocateGroup:f=Array.apply(null,Array(a.groupLength)).map(function(){return c.removeChild(c.childNodes[a[l._const.from]])});g=f.length;for(h=0;h<g;h++)k=f[h],0===h&&(e=c.childNodes[a[l._const.to]]),
c.insertBefore(k,e||null);break;case this._const.removeElement:c.parentNode.removeChild(c);break;case this._const.addElement:e=a[this._const.route].slice();f=e.splice(e.length-1,1)[0];c=this.getFromRoute(b,e);c.insertBefore(this.objToNode(a[this._const.element],"http://www.w3.org/2000/svg"===c.namespaceURI),c.childNodes[f]||null);break;case this._const.removeTextElement:if(!c||3!==c.nodeType)return!1;c.parentNode.removeChild(c);break;case this._const.addTextElement:e=a[this._const.route].slice();
f=e.splice(e.length-1,1)[0];d=document.createTextNode(a[this._const.value]);c=this.getFromRoute(b,e);if(!c||!c.childNodes)return!1;c.insertBefore(d,c.childNodes[f]||null);break;default:console.log("unknown action")}n.newNode=d;this.postDiffApply(n);return!0},undo:function(b,a){var c,d=a.length,e;a=a.slice();d||(a=[a]);a.reverse();for(e=0;e<d;e++)c=a[e],this.undoDiff(b,c)},undoDiff:function(b,a){switch(a[this._const.action]){case this._const.addAttribute:a[this._const.action]=this._const.removeAttribute;
this.applyDiff(b,a);break;case this._const.modifyAttribute:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.removeAttribute:a[this._const.action]=this._const.addAttribute;this.applyDiff(b,a);break;case this._const.modifyTextElement:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.modifyValue:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.modifyComment:r(a,this._const.oldValue,
this._const.newValue);this.applyDiff(b,a);break;case this._const.modifyChecked:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.modifySelected:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.replaceElement:r(a,this._const.oldValue,this._const.newValue);this.applyDiff(b,a);break;case this._const.relocateGroup:r(a,this._const.from,this._const.to);this.applyDiff(b,a);break;case this._const.removeElement:a[this._const.action]=
this._const.addElement;this.applyDiff(b,a);break;case this._const.addElement:a[this._const.action]=this._const.removeElement;this.applyDiff(b,a);break;case this._const.removeTextElement:a[this._const.action]=this._const.addTextElement;this.applyDiff(b,a);break;case this._const.addTextElement:a[this._const.action]=this._const.removeTextElement;this.applyDiff(b,a);break;default:console.log("unknown action")}}};return C});