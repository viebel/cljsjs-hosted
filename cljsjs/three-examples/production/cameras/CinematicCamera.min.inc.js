THREE.CinematicCamera=function(a,b,c,d){THREE.PerspectiveCamera.call(this,a,b,c,d);this.type="CinematicCamera";this.postprocessing={enabled:!0};this.shaderSettings={rings:3,samples:4};this.material_depth=new THREE.MeshDepthMaterial;this.setLens();this.initPostProcessing()};THREE.CinematicCamera.prototype=Object.create(THREE.PerspectiveCamera.prototype);THREE.CinematicCamera.prototype.constructor=THREE.CinematicCamera;
THREE.CinematicCamera.prototype.setLens=function(a,b,c,d){void 0===a&&(a=35);void 0!==b&&(this.filmGauge=b);this.setFocalLength(a);void 0===c&&(c=8);void 0===d&&(d=.019);this.fNumber=c;this.coc=d;this.aperture=a/this.fNumber;this.hyperFocal=a*a/(this.aperture*this.coc)};THREE.CinematicCamera.prototype.linearize=function(a){var b=this.far,c=this.near;return-b*c/(a*(b-c)-b)};THREE.CinematicCamera.prototype.smoothstep=function(a,b,c){a=this.saturate((c-a)/(b-a));return a*a*(3-2*a)};
THREE.CinematicCamera.prototype.saturate=function(a){return Math.max(0,Math.min(1,a))};
THREE.CinematicCamera.prototype.focusAt=function(a){void 0===a&&(a=20);var b=this.getFocalLength();this.focus=a;this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-b));this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-b));this.depthOfField=this.farPoint-this.nearPoint;0>this.depthOfField&&(this.depthOfField=0);this.sdistance=this.smoothstep(this.near,this.far,this.focus);this.ldistance=this.linearize(1-this.sdistance);this.postprocessing.bokeh_uniforms.focalDepth.value=
this.ldistance};
THREE.CinematicCamera.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new THREE.Scene;this.postprocessing.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);this.postprocessing.scene.add(this.postprocessing.camera);var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.postprocessing.rtTextureDepth=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,
a);this.postprocessing.rtTextureColor=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,a);a=THREE.BokehShader;this.postprocessing.bokeh_uniforms=THREE.UniformsUtils.clone(a.uniforms);this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture;this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture;this.postprocessing.bokeh_uniforms.manualdof.value=0;this.postprocessing.bokeh_uniforms.shaderFocus.value=0;this.postprocessing.bokeh_uniforms.fstop.value=
2.8;this.postprocessing.bokeh_uniforms.showFocus.value=1;this.postprocessing.bokeh_uniforms.focalDepth.value=.1;this.postprocessing.bokeh_uniforms.znear.value=this.near;this.postprocessing.bokeh_uniforms.zfar.value=this.near;this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth;this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight;this.postprocessing.materialBokeh=new THREE.ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:a.vertexShader,
fragmentShader:a.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}});this.postprocessing.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh);this.postprocessing.quad.position.z=-500;this.postprocessing.scene.add(this.postprocessing.quad)}};
THREE.CinematicCamera.prototype.renderCinematic=function(a,b){this.postprocessing.enabled&&(b.clear(),a.overrideMaterial=null,b.render(a,camera,this.postprocessing.rtTextureColor,!0),a.overrideMaterial=this.material_depth,b.render(a,camera,this.postprocessing.rtTextureDepth,!0),b.render(this.postprocessing.scene,this.postprocessing.camera))};