THREE.MD2CharacterComplex=function(){function k(a,b){for(var c=new THREE.TextureLoader,d=[],e=0;e<b.length;e++)d[e]=c.load(a+b[e],h),d[e].mapping=THREE.UVMapping,d[e].name=b[e];return d}function g(a,b){var c=new THREE.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),f=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,map:b,morphTargets:!0,morphNormals:!0}),e=new THREE.MorphBlendMesh(a,f);e.rotation.y=-Math.PI/2;e.materialTexture=f;e.materialWireframe=c;e.autoCreateAnimations(d.animationFPS);
return e}function h(){--d.loadCounter;if(0===d.loadCounter)d.onLoadComplete()}function l(a){return 1===a?1:-Math.pow(2,-10*a)+1}var d=this;this.scale=1;this.animationFPS=6;this.transitionFrames=15;this.maxSpeed=275;this.maxReverseSpeed=-275;this.frontDecceleration=this.backAcceleration=this.frontAcceleration=600;this.angularSpeed=2.5;this.root=new THREE.Object3D;this.controls=this.meshWeapon=this.meshBody=null;this.skinsBody=[];this.skinsWeapon=[];this.weapons=[];this.currentSkin=void 0;this.onLoadComplete=
function(){};this.meshes=[];this.animations={};this.bodyOrientation=this.speed=this.loadCounter=0;this.walkSpeed=this.maxSpeed;this.crouchSpeed=.5*this.maxSpeed;this.oldAnimation=this.activeAnimation=null;this.enableShadows=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].castShadow=a,this.meshes[b].receiveShadow=a};this.setVisible=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].visible=a,this.meshes[b].visible=a};this.shareParts=function(a){this.animations=a.animations;
this.walkSpeed=a.walkSpeed;this.crouchSpeed=a.crouchSpeed;this.skinsBody=a.skinsBody;this.skinsWeapon=a.skinsWeapon;var b=g(a.meshBody.geometry,this.skinsBody[0]);b.scale.set(this.scale,this.scale,this.scale);this.root.position.y=a.root.position.y;this.root.add(b);this.meshBody=b;this.meshes.push(b);for(b=0;b<a.weapons.length;b++){var c=g(a.weapons[b].geometry,this.skinsWeapon[b]);c.scale.set(this.scale,this.scale,this.scale);c.visible=!1;c.name=a.weapons[b].name;this.root.add(c);this.meshWeapon=
this.weapons[b]=c;this.meshes.push(c)}};this.loadParts=function(a){this.animations=a.animations;this.walkSpeed=a.walkSpeed;this.crouchSpeed=a.crouchSpeed;this.loadCounter=2*a.weapons.length+a.skins.length+1;for(var b=[],c=0;c<a.weapons.length;c++)b[c]=a.weapons[c][1];this.skinsBody=k(a.baseUrl+"skins/",a.skins);this.skinsWeapon=k(a.baseUrl+"skins/",b);b=new THREE.MD2Loader;b.load(a.baseUrl+a.body,function(a){a.computeBoundingBox();d.root.position.y=-d.scale*a.boundingBox.min.y;a=g(a,d.skinsBody[0]);
a.scale.set(d.scale,d.scale,d.scale);d.root.add(a);d.meshBody=a;d.meshes.push(a);h()});for(var f=function(a,b){return function(c){c=g(c,d.skinsWeapon[a]);c.scale.set(d.scale,d.scale,d.scale);c.visible=!1;c.name=b;d.root.add(c);d.weapons[a]=c;d.meshWeapon=c;d.meshes.push(c);h()}},c=0;c<a.weapons.length;c++)b.load(a.baseUrl+a.weapons[c][0],f(c,a.weapons[c][0]))};this.setPlaybackRate=function(a){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/a);this.meshWeapon&&(this.meshWeapon.duration=
this.meshWeapon.baseDuration/a)};this.setWireframe=function(a){a?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))};this.setSkin=function(a){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[a],this.currentSkin=
a)};this.setWeapon=function(a){for(var b=0;b<this.weapons.length;b++)this.weapons[b].visible=!1;if(a=this.weapons[a])a.visible=!0,this.meshWeapon=a,this.activeAnimation&&(a.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation)))};this.setAnimation=function(a){a!==this.activeAnimation&&a&&(this.meshBody&&(this.meshBody.setAnimationWeight(a,0),this.meshBody.playAnimation(a),this.oldAnimation=this.activeAnimation,
this.activeAnimation=a,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(a,0),this.meshWeapon.playAnimation(a)))};this.update=function(a){this.controls&&this.updateMovementModel(a);this.animations&&(this.updateBehaviors(a),this.updateAnimations(a))};this.updateAnimations=function(a){var b=1;0<this.blendCounter&&(b=(this.transitionFrames-this.blendCounter)/this.transitionFrames,--this.blendCounter);this.meshBody&&(this.meshBody.update(a),this.meshBody.setAnimationWeight(this.activeAnimation,
b),this.meshBody.setAnimationWeight(this.oldAnimation,1-b));this.meshWeapon&&(this.meshWeapon.update(a),this.meshWeapon.setAnimationWeight(this.activeAnimation,b),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-b))};this.updateBehaviors=function(a){a=this.controls;var b=this.animations,c,d;a.crouch?(c=b.crouchMove,d=b.crouchIdle):(c=b.move,d=b.idle);a.jump&&(d=c=b.jump);a.attack&&(d=a.crouch?c=b.crouchAttack:c=b.attack);(a.moveForward||a.moveBackward||a.moveLeft||a.moveRight)&&this.activeAnimation!==
c&&this.setAnimation(c);Math.abs(this.speed)<.2*this.maxSpeed&&!(a.moveLeft||a.moveRight||a.moveForward||a.moveBackward)&&this.activeAnimation!==d&&this.setAnimation(d);a.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation)));a.moveBackward&&(this.meshBody&&
(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))};this.updateMovementModel=function(a){var b=this.controls;this.maxSpeed=b.crouch?this.crouchSpeed:this.walkSpeed;this.maxReverseSpeed=-this.maxSpeed;b.moveForward&&(this.speed=THREE.Math.clamp(this.speed+a*this.frontAcceleration,
this.maxReverseSpeed,this.maxSpeed));b.moveBackward&&(this.speed=THREE.Math.clamp(this.speed-a*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));b.moveLeft&&(this.bodyOrientation+=a*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+1*a*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed));b.moveRight&&(this.bodyOrientation-=a*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+1*a*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed));b.moveForward||b.moveBackward||
(0<this.speed?(b=l(this.speed/this.maxSpeed),this.speed=THREE.Math.clamp(this.speed-b*a*this.frontDecceleration,0,this.maxSpeed)):(b=l(this.speed/this.maxReverseSpeed),this.speed=THREE.Math.clamp(this.speed+b*a*this.backAcceleration,this.maxReverseSpeed,0)));a*=this.speed;this.root.position.x+=Math.sin(this.bodyOrientation)*a;this.root.position.z+=Math.cos(this.bodyOrientation)*a;this.root.rotation.y=this.bodyOrientation}};