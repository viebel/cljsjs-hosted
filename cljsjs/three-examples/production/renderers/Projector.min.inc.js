THREE.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.renderOrder=this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(K){this.positionWorld.copy(K.positionWorld);this.positionScreen.copy(K.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.renderOrder=this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};
THREE.Projector=function(){function K(b){if(!1!==b.visible){if(b instanceof THREE.Light)v.lights.push(b);else if(b instanceof THREE.Mesh||b instanceof THREE.Line||b instanceof THREE.Points){if(!1===b.material.visible||!0===b.frustumCulled&&!1===S.intersectsObject(b))return;X(b)}else if(b instanceof THREE.Sprite){if(!1===b.material.visible||!0===b.frustumCulled&&!1===S.intersectsSprite(b))return;X(b)}b=b.children;for(var k=0,c=b.length;k<c;k++)K(b[k])}}function X(b){if(O===Y){var k=new THREE.RenderableObject;
Z.push(k);Y++;O++;A=k}else A=Z[O++];A.id=b.id;A.object=b;x.setFromMatrixPosition(b.matrixWorld);x.applyMatrix4(G);A.z=x.z;A.renderOrder=b.renderOrder;v.objects.push(A)}function T(b,k,c){var f=1/b.w;b.z*=f;if(-1<=b.z&&1>=b.z){if(P===aa){var t=new THREE.RenderableSprite;ba.push(t);aa++;P++;p=t}else p=ba[P++];p.id=k.id;p.x=b.x*f;p.y=b.y*f;p.z=b.z;p.renderOrder=k.renderOrder;p.object=k;p.rotation=k.rotation;p.scale.x=k.scale.x*Math.abs(p.x-(b.x+c.projectionMatrix.elements[0])/(b.w+c.projectionMatrix.elements[12]));
p.scale.y=k.scale.y*Math.abs(p.y-(b.y+c.projectionMatrix.elements[5])/(b.w+c.projectionMatrix.elements[13]));p.material=k.material;v.elements.push(p)}}function U(){if(L===ca){var b=new THREE.RenderableVertex;z.push(b);ca++;L++;return b}return z[L++]}function da(){if(Q===ea){var b=new THREE.RenderableFace;fa.push(b);ea++;Q++;return b}return fa[Q++]}function ga(){if(R===ha){var b=new THREE.RenderableLine;ia.push(b);ha++;R++;return b}return ia[R++]}function ja(b,k){return b.renderOrder!==k.renderOrder?
b.renderOrder-k.renderOrder:b.z!==k.z?k.z-b.z:b.id!==k.id?b.id-k.id:0}function ka(b,k){var c=0,f=1,t=b.z+b.w,h=k.z+k.w,e=-b.z+b.w,g=-k.z+k.w;if(0<=t&&0<=h&&0<=e&&0<=g)return!0;if(0>t&&0>h||0>e&&0>g)return!1;0>t?c=Math.max(c,t/(t-h)):0>h&&(f=Math.min(f,t/(t-h)));0>e?c=Math.max(c,e/(e-g)):0>g&&(f=Math.min(f,e/(e-g)));if(f<c)return!1;b.lerp(k,c);k.lerp(b,1-f);return!0}var A,O,Z=[],Y=0,V,L,z=[],ca=0,c,Q,fa=[],ea=0,f,R,ia=[],ha=0,p,P,ba=[],aa=0,v={objects:[],lights:[],elements:[]},x=new THREE.Vector3,
B=new THREE.Vector4,ma=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),na=new THREE.Box3,D=Array(3),la=new THREE.Matrix4,G=new THREE.Matrix4,E,F=new THREE.Matrix4,W=new THREE.Matrix3,S=new THREE.Frustum,I=new THREE.Vector4,J=new THREE.Vector4;this.projectVector=function(b,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");b.project(c)};this.unprojectVector=function(b,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");b.unproject(c)};
this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var q=new function(){function b(a){var b=a.positionWorld,d=a.positionScreen;b.copy(a.position).applyMatrix4(E);d.copy(b).applyMatrix4(G);b=1/d.w;d.x*=b;d.y*=b;d.z*=b;a.visible=-1<=d.x&&1>=d.x&&-1<=d.y&&1>=d.y&&-1<=d.z&&1>=d.z}function k(a,b,d){if(!0===a.visible||!0===b.visible||!0===d.visible)return!0;D[0]=a.positionScreen;D[1]=b.positionScreen;D[2]=d.positionScreen;return ma.intersectsBox(na.setFromPoints(D))}
function p(a,b,d){return 0>(d.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(d.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)}var q=[],t=[],h=[],e=null,g=null,l=new THREE.Matrix3;return{setObject:function(a){e=a;g=e.material;l.getNormalMatrix(e.matrixWorld);q.length=0;t.length=0;h.length=0},projectVertex:b,checkTriangleVisibility:k,checkBackfaceCulling:p,pushVertex:function(a,c,d){V=U();V.position.set(a,c,d);b(V)},pushNormal:function(a,
b,d){q.push(a,b,d)},pushColor:function(a,b,d){t.push(a,b,d)},pushUv:function(a,b){h.push(a,b)},pushLine:function(a,b){var d=z[a],c=z[b];d.positionScreen.copy(d.position).applyMatrix4(F);c.positionScreen.copy(c.position).applyMatrix4(F);!0===ka(d.positionScreen,c.positionScreen)&&(d.positionScreen.multiplyScalar(1/d.positionScreen.w),c.positionScreen.multiplyScalar(1/c.positionScreen.w),f=ga(),f.id=e.id,f.v1.copy(d),f.v2.copy(c),f.z=Math.max(d.positionScreen.z,c.positionScreen.z),f.renderOrder=e.renderOrder,
f.material=e.material,e.material.vertexColors===THREE.VertexColors&&(f.vertexColors[0].fromArray(t,3*a),f.vertexColors[1].fromArray(t,3*b)),v.elements.push(f))},pushTriangle:function(a,b,d){var f=z[a],n=z[b],r=z[d];if(!1!==k(f,n,r)&&(g.side===THREE.DoubleSide||!0===p(f,n,r))){c=da();c.id=e.id;c.v1.copy(f);c.v2.copy(n);c.v3.copy(r);c.z=(f.positionScreen.z+n.positionScreen.z+r.positionScreen.z)/3;c.renderOrder=e.renderOrder;c.normalModel.fromArray(q,3*a);c.normalModel.applyMatrix3(l).normalize();for(f=
0;3>f;f++)n=c.vertexNormalsModel[f],n.fromArray(q,3*arguments[f]),n.applyMatrix3(l).normalize(),c.uvs[f].fromArray(h,2*arguments[f]);c.vertexNormalsLength=3;c.material=e.material;v.elements.push(c)}}}};this.projectScene=function(b,k,p,A){P=R=Q=0;v.elements.length=0;!0===b.autoUpdate&&b.updateMatrixWorld();null===k.parent&&k.updateMatrixWorld();la.copy(k.matrixWorldInverse);G.multiplyMatrices(k.projectionMatrix,la);S.setFromMatrix(G);O=0;v.objects.length=0;v.lights.length=0;K(b);!0===p&&v.objects.sort(ja);
b=v.objects;p=0;for(var t=b.length;p<t;p++){var h=b[p].object,e=h.geometry;q.setObject(h);E=h.matrixWorld;L=0;if(h instanceof THREE.Mesh)if(e instanceof THREE.BufferGeometry){var g=e.attributes,h=e.groups;if(void 0!==g.position){for(var l=g.position.array,a=0,m=l.length;a<m;a+=3)q.pushVertex(l[a],l[a+1],l[a+2]);if(void 0!==g.normal)for(var d=g.normal.array,a=0,m=d.length;a<m;a+=3)q.pushNormal(d[a],d[a+1],d[a+2]);if(void 0!==g.uv)for(g=g.uv.array,a=0,m=g.length;a<m;a+=2)q.pushUv(g[a],g[a+1]);if(null!==
e.index)if(l=e.index.array,0<h.length)for(g=0;g<h.length;g++)for(m=h[g],a=m.start,m=m.start+m.count;a<m;a+=3)q.pushTriangle(l[a],l[a+1],l[a+2]);else for(a=0,m=l.length;a<m;a+=3)q.pushTriangle(l[a],l[a+1],l[a+2]);else for(a=0,m=l.length/3;a<m;a+=3)q.pushTriangle(a,a+1,a+2)}}else{if(e instanceof THREE.Geometry){var u=e.vertices,a=e.faces,m=e.faceVertexUvs[0];W.getNormalMatrix(E);for(var l=h.material,g=Array.isArray(l),n=0,r=u.length;n<r;n++){d=u[n];x.copy(d);if(!0===l.morphTargets)for(var H=e.morphTargets,
y=h.morphTargetInfluences,w=0,M=H.length;w<M;w++){var C=y[w];if(0!==C){var N=H[w].vertices[n];x.x+=(N.x-d.x)*C;x.y+=(N.y-d.y)*C;x.z+=(N.z-d.z)*C}}q.pushVertex(x.x,x.y,x.z)}u=0;for(n=a.length;u<n;u++)if(r=a[u],l=!0===g?h.material[r.materialIndex]:h.material,void 0!==l&&(y=l.side,e=z[r.a],d=z[r.b],H=z[r.c],!1!==q.checkTriangleVisibility(e,d,H))){w=q.checkBackfaceCulling(e,d,H);if(y!==THREE.DoubleSide){if(y===THREE.FrontSide&&!1===w)continue;if(y===THREE.BackSide&&!0===w)continue}c=da();c.id=h.id;c.v1.copy(e);
c.v2.copy(d);c.v3.copy(H);c.normalModel.copy(r.normal);!1!==w||y!==THREE.BackSide&&y!==THREE.DoubleSide||c.normalModel.negate();c.normalModel.applyMatrix3(W).normalize();M=r.vertexNormals;C=0;for(N=Math.min(M.length,3);C<N;C++){var D=c.vertexNormalsModel[C];D.copy(M[C]);!1!==w||y!==THREE.BackSide&&y!==THREE.DoubleSide||D.negate();D.applyMatrix3(W).normalize()}c.vertexNormalsLength=M.length;y=m[u];if(void 0!==y)for(w=0;3>w;w++)c.uvs[w].copy(y[w]);c.color=r.color;c.material=l;c.z=(e.positionScreen.z+
d.positionScreen.z+H.positionScreen.z)/3;c.renderOrder=h.renderOrder;v.elements.push(c)}}}else if(h instanceof THREE.Line)if(F.multiplyMatrices(G,E),e instanceof THREE.BufferGeometry){if(g=e.attributes,void 0!==g.position){l=g.position.array;a=0;for(m=l.length;a<m;a+=3)q.pushVertex(l[a],l[a+1],l[a+2]);if(void 0!==g.color)for(g=g.color.array,a=0,m=g.length;a<m;a+=3)q.pushColor(g[a],g[a+1],g[a+2]);if(null!==e.index)for(l=e.index.array,a=0,m=l.length;a<m;a+=2)q.pushLine(l[a],l[a+1]);else for(g=h instanceof
THREE.LineSegments?2:1,a=0,m=l.length/3-1;a<m;a+=g)q.pushLine(a,a+1)}}else{if(e instanceof THREE.Geometry&&(u=h.geometry.vertices,0!==u.length))for(e=U(),e.positionScreen.copy(u[0]).applyMatrix4(F),g=h instanceof THREE.LineSegments?2:1,n=1,r=u.length;n<r;n++)e=U(),e.positionScreen.copy(u[n]).applyMatrix4(F),0<(n+1)%g||(d=z[L-2],I.copy(e.positionScreen),J.copy(d.positionScreen),!0===ka(I,J)&&(I.multiplyScalar(1/I.w),J.multiplyScalar(1/J.w),f=ga(),f.id=h.id,f.v1.positionScreen.copy(I),f.v2.positionScreen.copy(J),
f.z=Math.max(I.z,J.z),f.renderOrder=h.renderOrder,f.material=h.material,h.material.vertexColors===THREE.VertexColors&&(f.vertexColors[0].copy(h.geometry.colors[n]),f.vertexColors[1].copy(h.geometry.colors[n-1])),v.elements.push(f)))}else if(h instanceof THREE.Points)if(F.multiplyMatrices(G,E),e instanceof THREE.Geometry)for(u=h.geometry.vertices,n=0,r=u.length;n<r;n++)d=u[n],B.set(d.x,d.y,d.z,1),B.applyMatrix4(F),T(B,h,k);else{if(e instanceof THREE.BufferGeometry&&(g=e.attributes,void 0!==g.position))for(l=
g.position.array,a=0,m=l.length;a<m;a+=3)B.set(l[a],l[a+1],l[a+2],1),B.applyMatrix4(F),T(B,h,k)}else h instanceof THREE.Sprite&&(B.set(E.elements[12],E.elements[13],E.elements[14],1),B.applyMatrix4(G),T(B,h,k))}!0===A&&v.elements.sort(ja);return v}};