THREE.SpriteCanvasMaterial=function(v){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(){};this.setValues(v)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var v=new THREE.SpriteCanvasMaterial;v.copy(this);v.color.copy(this.color);v.program=this.program;return v};
THREE.CanvasRenderer=function(v){function aa(h,d,p,f){J!==d&&(J=a.lineWidth=d);K!==p&&(K=a.lineCap=p);L!==f&&(L=a.lineJoin=f);M(h.getStyle());a.stroke();C.expandByScalar(2*d)}function ba(h){D(h.getStyle());a.fill()}function na(h){if(0===h.version||h instanceof THREE.CompressedTexture||h instanceof THREE.DataTexture)return{canvas:void 0,version:h.version};var d=h.image;if(!1===d.complete)return{canvas:void 0,version:0};var p=h.wrapS===THREE.RepeatWrapping||h.wrapS===THREE.MirroredRepeatWrapping,f=
h.wrapT===THREE.RepeatWrapping||h.wrapT===THREE.MirroredRepeatWrapping,b=h.wrapS===THREE.MirroredRepeatWrapping,g=h.wrapT===THREE.MirroredRepeatWrapping,c=document.createElement("canvas");c.width=d.width*(b?2:1);c.height=d.height*(g?2:1);var m=c.getContext("2d");m.setTransform(1,0,0,-1,0,d.height);m.drawImage(d,0,0);!0===b&&(m.setTransform(-1,0,0,-1,d.width,d.height),m.drawImage(d,-d.width,0));!0===g&&(m.setTransform(1,0,0,1,0,0),m.drawImage(d,0,d.height));!0===b&&!0===g&&(m.setTransform(-1,0,0,1,
d.width,0),m.drawImage(d,-d.width,d.height));d="no-repeat";!0===p&&!0===f?d="repeat":!0===p?d="repeat-x":!0===f&&(d="repeat-y");p=a.createPattern(c,d);if(h.onUpdate)h.onUpdate(h);return{canvas:p,version:h.version}}function oa(h,d,p,f,b,g,c,m,k,n,r,q,l){var e=T[l.id];if(void 0===e||e.version!==l.version)e=na(l),T[l.id]=e;if(void 0!==e.canvas){D(e.canvas);var e=l.offset.x/l.repeat.x,t=l.offset.y/l.repeat.y,u=l.image.width*l.repeat.x;l=l.image.height*l.repeat.y;c=(c+e)*u;m=(m+t)*l;p-=h;f-=d;b-=h;g-=
d;k=(k+e)*u-c;n=(n+t)*l-m;r=(r+e)*u-c;q=(q+t)*l-m;l=k*q-r*n;0!==l&&(e=1/l,l=(q*p-n*b)*e,n=(q*f-n*g)*e,p=(k*b-r*p)*e,f=(k*g-r*f)*e,h=h-l*c-p*m,d=d-n*c-f*m,a.save(),a.transform(l,n,p,f,h,d),a.fill(),a.restore())}else D("rgba( 0, 0, 0, 1)"),a.fill()}function ca(a,d,f){var e=d.x-a.x,b=d.y-a.y,g=e*e+b*b;0!==g&&(f/=Math.sqrt(g),e*=f,b*=f,d.x+=e,d.y+=b,a.x-=e,a.y-=b)}function N(h){da!==h&&(da=a.globalAlpha=h)}function O(h){ea!==h&&(h===THREE.NormalBlending?a.globalCompositeOperation="source-over":h===THREE.AdditiveBlending?
a.globalCompositeOperation="lighter":h===THREE.SubtractiveBlending?a.globalCompositeOperation="darker":h===THREE.MultiplyBlending&&(a.globalCompositeOperation="multiply"),ea=h)}function M(h){fa!==h&&(fa=a.strokeStyle=h)}function D(h){ga!==h&&(ga=a.fillStyle=h)}function pa(h){qa.length!==h.length&&(a.setLineDash(h),qa=h)}console.log("THREE.CanvasRenderer",THREE.REVISION);v=v||{};var P=this,ha,ia,Q,Fa=new THREE.Projector,A=void 0!==v.canvas?v.canvas:document.createElement("canvas"),F=A.width,E=A.height,
u=Math.floor(F/2),w=Math.floor(E/2),ra=0,sa=0,ta=F,ua=E,x=1,a=A.getContext("2d",{alpha:!0===v.alpha}),I=new THREE.Color(0),G=!0===v.alpha?0:1,da=1,ea=0,fa=null,ga=null,J=null,K=null,L=null,qa=[],e,t,B,U,V,W,X,Y,Z,y=new THREE.Color,ja=new THREE.Color,va=new THREE.Color,ka=new THREE.Color,T={},H,wa,xa,ya,za,Aa,Ba,R=new THREE.Box2,f=new THREE.Box2,C=new THREE.Box2,la=new THREE.Color,Ca=new THREE.Color,Da=new THREE.Color,ma=new THREE.Vector3,Ea=new THREE.Vector3,z=new THREE.Vector3,S=new THREE.Matrix3;
void 0===a.setLineDash&&(a.setLineDash=function(){});this.domElement=A;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.getContext=function(){return a};this.getContextAttributes=function(){return a.getContextAttributes()};this.getPixelRatio=function(){return x};this.setPixelRatio=function(a){void 0!==a&&(x=a)};this.setSize=function(a,d,e){F=a*x;E=d*x;A.width=F;A.height=E;u=Math.floor(F/2);w=Math.floor(E/2);!1!==e&&(A.style.width=a+"px",A.style.height=
d+"px");R.min.set(-u,-w);R.max.set(u,w);f.min.set(-u,-w);f.max.set(u,w);da=1;ea=0;L=K=J=ga=fa=null;this.setViewport(0,0,a,d)};this.setViewport=function(a,d,e,f){ra=a*x;sa=d*x;ta=e*x;ua=f*x};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(a,d){I.set(a);G=void 0!==d?d:1;f.min.set(-u,-w);f.max.set(u,w)};this.setClearColorHex=function(a,d){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,
d)};this.getClearColor=function(){return I};this.getClearAlpha=function(){return G};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===f.isEmpty()&&(f.intersect(R),f.expandByScalar(2),f.min.x+=u,f.min.y=-f.min.y+w,f.max.x+=u,f.max.y=-f.max.y+w,1>G&&a.clearRect(f.min.x|0,f.max.y|0,f.max.x-f.min.x|0,f.min.y-f.max.y|0),0<G&&(N(1),O(THREE.NormalBlending),D("rgba("+Math.floor(255*I.r)+","+Math.floor(255*I.g)+","+Math.floor(255*I.b)+","+G+")"),a.fillRect(f.min.x|0,f.max.y|0,f.max.x-f.min.x|
0,f.min.y-f.max.y|0)),f.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(h,d){if(void 0===d.isCamera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{var p=h.background;p&&p.isColor?(N(1),O(THREE.NormalBlending),D(p.getStyle()),a.fillRect(0,0,F,E)):!0===this.autoClear&&this.clear();P.info.render.vertices=0;P.info.render.faces=0;a.setTransform(ta/F,0,0,-ua/E,ra,E-sa);a.translate(u,
w);ha=Fa.projectScene(h,d,this.sortObjects,this.sortElements);ia=ha.elements;Q=ha.lights;S.getNormalMatrix(d.matrixWorldInverse);la.setRGB(0,0,0);Ca.setRGB(0,0,0);Da.setRGB(0,0,0);for(var p=0,v=Q.length;p<v;p++){var b=Q[p],g=b.color;b.isAmbientLight?la.add(g):b.isDirectionalLight?Ca.add(g):b.isPointLight&&Da.add(g)}p=0;for(v=ia.length;p<v;p++){var c=ia[p],m=c.material;if(void 0!==m&&0!==m.opacity){C.makeEmpty();if(c instanceof THREE.RenderableSprite){e=c;e.x*=u;e.y*=w;var b=e,k=c,g=m;N(g.opacity);
O(g.blending);var n=k.scale.x*u,k=k.scale.y*w,c=Math.sqrt(n*n+k*k);C.min.set(b.x-c,b.y-c);C.max.set(b.x+c,b.y+c);if(g.isSpriteMaterial){var r=g.map;if(null!==r){c=T[r.id];if(void 0===c||c.version!==r.version)c=na(r),T[r.id]=c;if(void 0!==c.canvas){D(c.canvas);var q=r.image,c=q.width*r.offset.x,m=q.height*r.offset.y,l=q.width*r.repeat.x,r=q.height*r.repeat.y,q=n/l,A=k/r;a.save();a.translate(b.x,b.y);0!==g.rotation&&a.rotate(g.rotation);a.translate(-n/2,-k/2);a.scale(q,A);a.translate(-c,-m);a.fillRect(c,
m,l,r);a.restore()}}else D(g.color.getStyle()),a.save(),a.translate(b.x,b.y),0!==g.rotation&&a.rotate(g.rotation),a.scale(n,-k),a.fillRect(-.5,-.5,1,1),a.restore()}else g.isSpriteCanvasMaterial?(M(g.color.getStyle()),D(g.color.getStyle()),a.save(),a.translate(b.x,b.y),0!==g.rotation&&a.rotate(g.rotation),a.scale(n,k),g.program(a),a.restore()):g.isPointsMaterial&&(D(g.color.getStyle()),a.save(),a.translate(b.x,b.y),0!==g.rotation&&a.rotate(g.rotation),a.scale(n*g.size,-k*g.size),a.fillRect(-.5,-.5,
1,1),a.restore())}else if(c instanceof THREE.RenderableLine){if(e=c.v1,t=c.v2,e.positionScreen.x*=u,e.positionScreen.y*=w,t.positionScreen.x*=u,t.positionScreen.y*=w,C.setFromPoints([e.positionScreen,t.positionScreen]),!0===R.intersectsBox(C)&&(b=e,g=t,n=c,k=m,N(k.opacity),O(k.blending),a.beginPath(),a.moveTo(b.positionScreen.x,b.positionScreen.y),a.lineTo(g.positionScreen.x,g.positionScreen.y),k.isLineBasicMaterial)){c=k.linewidth;J!==c&&(J=a.lineWidth=c);c=k.linecap;K!==c&&(K=a.lineCap=c);c=k.linejoin;
L!==c&&(L=a.lineJoin=c);if(k.vertexColors!==THREE.VertexColors)M(k.color.getStyle());else if(c=n.vertexColors[0].getStyle(),n=n.vertexColors[1].getStyle(),c===n)M(c);else{try{var x=a.createLinearGradient(b.positionScreen.x,b.positionScreen.y,g.positionScreen.x,g.positionScreen.y);x.addColorStop(0,c);x.addColorStop(1,n)}catch(I){x=c}M(x)}k.isLineDashedMaterial&&pa([k.dashSize,k.gapSize]);a.stroke();C.expandByScalar(2*k.linewidth);k.isLineDashedMaterial&&pa([])}}else if(c instanceof THREE.RenderableFace){e=
c.v1;t=c.v2;B=c.v3;if(-1>e.positionScreen.z||1<e.positionScreen.z)continue;if(-1>t.positionScreen.z||1<t.positionScreen.z)continue;if(-1>B.positionScreen.z||1<B.positionScreen.z)continue;e.positionScreen.x*=u;e.positionScreen.y*=w;t.positionScreen.x*=u;t.positionScreen.y*=w;B.positionScreen.x*=u;B.positionScreen.y*=w;0<m.overdraw&&(ca(e.positionScreen,t.positionScreen,m.overdraw),ca(t.positionScreen,B.positionScreen,m.overdraw),ca(B.positionScreen,e.positionScreen,m.overdraw));C.setFromPoints([e.positionScreen,
t.positionScreen,B.positionScreen]);if(!0===R.intersectsBox(C)){g=e;n=t;k=B;b=m;P.info.render.vertices+=3;P.info.render.faces++;N(b.opacity);O(b.blending);U=g.positionScreen.x;V=g.positionScreen.y;W=n.positionScreen.x;X=n.positionScreen.y;Y=k.positionScreen.x;Z=k.positionScreen.y;var m=U,l=V,r=W,q=X,A=Y,G=Z;a.beginPath();a.moveTo(m,l);a.lineTo(r,q);a.lineTo(A,G);a.closePath();if((b.isMeshLambertMaterial||b.isMeshPhongMaterial||b.isMeshStandardMaterial)&&null===b.map){ja.copy(b.color);va.copy(b.emissive);
b.vertexColors===THREE.FaceColors&&ja.multiply(c.color);y.copy(la);Ea.copy(g.positionWorld).add(n.positionWorld).add(k.positionWorld).divideScalar(3);g=Ea;n=c.normalModel;k=y;c=0;for(m=Q.length;c<m;c++)l=Q[c],ka.copy(l.color),l.isDirectionalLight?(r=ma.setFromMatrixPosition(l.matrixWorld).normalize(),q=n.dot(r),0>=q||(q*=l.intensity,k.add(ka.multiplyScalar(q)))):l.isPointLight&&(r=ma.setFromMatrixPosition(l.matrixWorld),q=n.dot(ma.subVectors(r,g).normalize()),0>=q||(q*=0==l.distance?1:1-Math.min(g.distanceTo(r)/
l.distance,1),0!=q&&(q*=l.intensity,k.add(ka.multiplyScalar(q)))));y.multiply(ja).add(va);!0===b.wireframe?aa(y,b.wireframeLinewidth,b.wireframeLinecap,b.wireframeLinejoin):ba(y)}else b.isMeshBasicMaterial||b.isMeshLambertMaterial||b.isMeshPhongMaterial||b.isMeshStandardMaterial?null!==b.map?b.map.mapping===THREE.UVMapping&&(H=c.uvs,oa(U,V,W,X,Y,Z,H[0].x,H[0].y,H[1].x,H[1].y,H[2].x,H[2].y,b.map)):null!==b.envMap?b.envMap.mapping===THREE.SphericalReflectionMapping&&(z.copy(c.vertexNormalsModel[0]).applyMatrix3(S),
wa=.5*z.x+.5,xa=.5*z.y+.5,z.copy(c.vertexNormalsModel[1]).applyMatrix3(S),ya=.5*z.x+.5,za=.5*z.y+.5,z.copy(c.vertexNormalsModel[2]).applyMatrix3(S),Aa=.5*z.x+.5,Ba=.5*z.y+.5,oa(U,V,W,X,Y,Z,wa,xa,ya,za,Aa,Ba,b.envMap)):(y.copy(b.color),b.vertexColors===THREE.FaceColors&&y.multiply(c.color),!0===b.wireframe?aa(y,b.wireframeLinewidth,b.wireframeLinecap,b.wireframeLinejoin):ba(y)):(b.isMeshNormalMaterial?(z.copy(c.normalModel).applyMatrix3(S),y.setRGB(z.x,z.y,z.z).multiplyScalar(.5).addScalar(.5)):y.setRGB(1,
1,1),!0===b.wireframe?aa(y,b.wireframeLinewidth,b.wireframeLinecap,b.wireframeLinejoin):ba(y))}}f.union(C)}}a.setTransform(1,0,0,1,0,0)}}};