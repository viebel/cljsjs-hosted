THREE.RaytracingRenderer=function(f){function y(a){a.postMessage({init:[n,p],worker:a.id,blockSize:h})}function v(a){if(!g.length)return q=!1,z.dispatchEvent({type:"complete"});var c=g.pop(),b=c%r*h,c=(c/r|0)*h;a.postMessage({render:!0,x:b,y:c,sceneId:l});m.fillStyle="#"+a.color;m.fillRect(b,c,h,h)}function C(a){if((a=a.material)&&!(a.uuid in t)){var c={},b;for(b in D)void 0!==a[b]&&(c[b]=a[b]);t[a.uuid]=c}}console.log("THREE.RaytracingRenderer",THREE.REVISION);f=f||{};var z=this,e=[],q=!1,d=document.createElement("canvas"),
m=d.getContext("2d",{alpha:!0===f.alpha}),n,p,E=new THREE.Color(0);this.domElement=d;this.autoClear=!0;var k=f.workers,h=f.blockSize||64;this.randomize=f.randomize;var g=[],F=0,l=0;console.log("%cSpinning off "+k+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;");this.setWorkers=function(a){for(k=a||navigator.hardwareConcurrency||4;e.length<k;)a=new Worker(f.workerPath),a.id=F++,a.onmessage=function(a){if((a=a.data)&&a.blockSize&&l==a.sceneId){var b=new ImageData(new Uint8ClampedArray(a.data),
a.blockSize,a.blockSize);m.putImageData(b,a.blockX,a.blockY);console.log("Worker "+this.id,a.time/1E3,(Date.now()-A)/1E3+" s");if(e.length>k)return e.splice(e.indexOf(this),1),this.terminate();v(this)}},a.color=(new THREE.Color).setHSL(Math.random(),.8,.8).getHexString(),e.push(a),y(a),q&&(a.postMessage({scene:w,camera:x,annex:t,sceneId:l}),v(a));if(!q)for(;e.length>k;)e.pop().terminate()};this.setWorkers(k);this.setClearColor=function(a,c){E.set(a)};this.setPixelRatio=function(){};this.setSize=function(a,
c){d.width=a;d.height=c;n=d.width;p=d.height;m.fillStyle="white";e.forEach(y)};this.setSize(d.width,d.height);this.clear=function(){};var u,r,B,t={},w,x,A,D={mirror:1,reflectivity:1,refractionRatio:1,glass:1};this.render=function(a,c){q=!0;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();w=a.toJSON();x=c.toJSON();++l;a.traverse(C);e.forEach(function(a){a.postMessage({scene:w,camera:x,annex:t,sceneId:l})});m.clearRect(0,0,n,p);A=Date.now();r=Math.ceil(n/h);B=Math.ceil(p/
h);u=r*B;g=[];for(var b=0;b<u;b++)g.push(b);if(z.randomize)for(b=0;b<u;b++){var d=Math.random()*u|0,f=g[d];g[d]=g[b];g[b]=f}e.forEach(v)}};Object.assign(THREE.RaytracingRenderer.prototype,THREE.EventDispatcher.prototype);