THREE.SoftwareRenderer=function(u){function v(a){for(var m=z*I*4,b=0;b<m;b+=4)L[b]=255*a.r|0,L[b+1]=255*a.g|0,L[b+2]=255*a.b|0,L[b+3]=da?0:255;P.fillStyle=da?"rgba(0, 0, 0, 0)":a.getStyle();P.fillRect(0,0,z,I)}function n(a,m){var b=0,g=0,h=255*a.color.r,d=255*a.color.g,f=255*a.color.b,c=new Uint8Array(768);if(m){for(;204>b;)c[g++]=Math.min(b*h/204,255),c[g++]=Math.min(b*d/204,255),c[g++]=Math.min(b*f/204,255),++b;for(;256>b;)c[g++]=Math.min(h+(b-204)*(255-h)/82,255),c[g++]=Math.min(d+(b-204)*(255-
d)/82,255),c[g++]=Math.min(f+(b-204)*(255-f)/82,255),++b}else for(;256>b;)c[g++]=Math.min(b*h/255,255),c[g++]=Math.min(b*d/255,255),c[g++]=Math.min(b*f/255,255),++b;return c}function N(a,m,b,g,h,d,f,c,l){f=4*b;c=U[l.map.id];if(c.data){var e=c.width,k=e-1;c=c.data;h=4*((d*e&k)*e+(h*e&k));if(l.transparent){d=c[h+1];var e=c[h+2],k=c[h+3]*l.opacity/255,p=a[f+1],D=a[f+2];a[f]=c[h]*k+a[f]*(1-k);a[f+1]=d*k+p*(1-k);a[f+2]=e*k+D*(1-k);a[f+3]=(l.opacity<<8)-1;255==a[f+3]&&(m[b]=g)}else a[f]=c[h],a[f+1]=c[h+
1],a[f+2]=c[h+2],a[f+3]=(l.opacity<<8)-1,m[b]=g}}function ac(a,m,b,g,h,d,f,c,l){c=4*b;var e=U[l.map.id];if(e.data){var k=e.width;f=3*(0<f?~~f:0);var p=k-1,e=e.data;h=4*((d*k&p)*k+(h*k&p));if(l.transparent){d=l.palette[f+1]*e[h+1];var k=l.palette[f+2]*e[h+2],p=e[h+3]*l.opacity/256,D=a[c+1],r=a[c+2];a[c]=l.palette[f]*e[h]*p+a[c]*(1-p);a[c+1]=d*p+D*(1-p);a[c+2]=k*p+r*(1-p);a[c+3]=(l.opacity<<8)-1;255==a[c+3]&&(m[b]=g)}else a[c]=l.palette[f]*e[h]>>8,a[c+1]=l.palette[f+1]*e[h+1]>>8,a[c+2]=l.palette[f+
2]*e[h+2]>>8,a[c+3]=(l.opacity<<8)-1,m[b]=g}}function mb(a){var m=a.id,b=ea[m];b&&a.map&&!U[a.map.id]&&delete ea[m];if(void 0===ea[m]||!0===a.needsUpdate){if(a instanceof THREE.MeshBasicMaterial||a instanceof THREE.MeshLambertMaterial||a instanceof THREE.MeshPhongMaterial||a instanceof THREE.SpriteMaterial)if(a instanceof THREE.MeshLambertMaterial?a.palette||(a.palette=n(a,!1)):a instanceof THREE.MeshPhongMaterial&&!a.palette&&(a.palette=n(a,!0)),a.map){b=new THREE.SoftwareRenderer.Texture;b.fromImage(a.map.image);
if(!b.data)return;U[a.map.id]=b;b=a instanceof THREE.MeshBasicMaterial||a instanceof THREE.SpriteMaterial?N:ac}else b=a.vertexColors===THREE.FaceColors?"var colorOffset \x3d offset * 4;\nbuffer[ colorOffset ] \x3d face.color.r * 255;\nbuffer[ colorOffset + 1 ] \x3d face.color.g * 255;\nbuffer[ colorOffset + 2 ] \x3d face.color.b * 255;\nbuffer[ colorOffset + 3 ] \x3d material.opacity * 255;\ndepthBuf[ offset ] \x3d depth;":"var colorOffset \x3d offset * 4;\nbuffer[ colorOffset ] \x3d material.color.r * 255;\nbuffer[ colorOffset + 1 ] \x3d material.color.g * 255;\nbuffer[ colorOffset + 2 ] \x3d material.color.b * 255;\nbuffer[ colorOffset + 3 ] \x3d material.opacity * 255;\ndepthBuf[ offset ] \x3d depth;",
b=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",b);else b=a instanceof THREE.LineBasicMaterial?new Function("buffer, depthBuf, offset, depth, color1, color2, material","var colorOffset \x3d offset * 4;\nbuffer[ colorOffset ] \x3d material.color.r * (color1.r+color2.r) * 0.5 * 255;\nbuffer[ colorOffset + 1 ] \x3d material.color.g * (color1.g+color2.g) * 0.5 * 255;\nbuffer[ colorOffset + 2 ] \x3d material.color.b * (color1.b+color2.b) * 0.5 * 255;\nbuffer[ colorOffset + 3 ] \x3d 255;\ndepthBuf[ offset ] \x3d depth;"):
new Function("buffer, depthBuf, offset, depth, u, v, n, face, material","var colorOffset \x3d offset * 4;\nbuffer[ colorOffset ] \x3d u * 255;\nbuffer[ colorOffset + 1 ] \x3d v * 255;\nbuffer[ colorOffset + 2 ] \x3d 0;\nbuffer[ colorOffset + 3 ] \x3d 255;\ndepthBuf[ offset ] \x3d depth;");ea[m]=b;a.needsUpdate=!1}return b}function fa(a,m,b,g,h,d,f,c,l){if(!(-1>a.z||1<a.z||-1>m.z||1<m.z||-1>b.z||1<b.z)){var e=a.x*Ja+Ka|0,k=m.x*Ja+Ka|0,p=b.x*Ja+Ka|0,D=a.y*La+Ma|0,r=m.y*La+Ma|0,n=b.y*La+Ma|0,q=c.vertexNormalsModel&&
c.vertexNormalsModel.length,t=g&&h&&d,u=Math.max(Math.sqrt((e-k)*(e-k)+(D-r)*(D-r)),Math.sqrt((k-p)*(k-p)+(r-n)*(r-n)),Math.sqrt((p-e)*(p-e)+(n-D)*(n-D)));if(!(c instanceof THREE.RenderableSprite)&&1600<u){var A={vertexNormalsModel:[],color:c.color},v,w,J;if(t){E===Na.length?(v=new THREE.Vector2,Na.push(v),++E,w=new THREE.Vector2,Na.push(w),++E,J=new THREE.Vector2,Na.push(J)):(v=Na[E],++E,w=Na[E],++E,J=Na[E]);++E;var B;B=m.w/a.w*(1+m.z)/(1+a.z);v.copy(g).multiplyScalar(B).add(h).multiplyScalar(1/
(B+1));B=b.w/m.w*(1+b.z)/(1+m.z);w.copy(h).multiplyScalar(B).add(d).multiplyScalar(1/(B+1));B=a.w/b.w*(1+a.z)/(1+b.z);J.copy(d).multiplyScalar(B).add(g).multiplyScalar(1/(B+1))}var x,y,C;F===Oa.length?(x=new THREE.Vector4,Oa.push(x),++F,y=new THREE.Vector4,Oa.push(y),++F,C=new THREE.Vector4,Oa.push(C)):(x=Oa[F],++F,y=Oa[F],++F,C=Oa[F]);++F;x.copy(a).add(m).multiplyScalar(.5);y.copy(m).add(b).multiplyScalar(.5);C.copy(b).add(a).multiplyScalar(.5);var ga,Q,ha;q&&(G===Pa.length?(ga=new THREE.Vector3,
Pa.push(ga),++G,Q=new THREE.Vector3,Pa.push(Q),++G,ha=new THREE.Vector3,Pa.push(ha)):(ga=Pa[G],++G,Q=Pa[G],++G,ha=Pa[G]),++G,ga.copy(c.vertexNormalsModel[0]).add(c.vertexNormalsModel[1]).normalize(),Q.copy(c.vertexNormalsModel[1]).add(c.vertexNormalsModel[2]).normalize(),ha.copy(c.vertexNormalsModel[2]).add(c.vertexNormalsModel[0]).normalize());q&&(A.vertexNormalsModel[0]=c.vertexNormalsModel[0],A.vertexNormalsModel[1]=ga,A.vertexNormalsModel[2]=ha);fa(a,x,C,g,v,J,f,A,l);q&&(A.vertexNormalsModel[0]=
c.vertexNormalsModel[1],A.vertexNormalsModel[1]=Q,A.vertexNormalsModel[2]=ga);fa(m,y,x,h,w,v,f,A,l);q&&(A.vertexNormalsModel[0]=ga,A.vertexNormalsModel[1]=Q,A.vertexNormalsModel[2]=ha);fa(x,y,C,v,w,J,f,A,l);q&&(A.vertexNormalsModel[0]=c.vertexNormalsModel[2],A.vertexNormalsModel[1]=ha,A.vertexNormalsModel[2]=Q);fa(b,C,y,d,J,w,f,A,l)}else{var P=a.z*Qa+Ra|0,ba=m.z*Qa+Ra|0,ca=b.z*Qa+Ra|0,t=!1,X,da,N,Ha,Ia,U;g&&h&&d&&(t=!0,X=g.x,da=1-g.y,N=h.x,Ha=1-h.y,Ia=d.x,U=1-d.y);var ea,cb,db,ua,mb,Eb;q&&(ea=c.vertexNormalsModel[0],
cb=c.vertexNormalsModel[1],db=c.vertexNormalsModel[2],ua=255*ea.z,mb=255*cb.z,Eb=255*db.z);var R=e-k,O=r-D,va=k-p,ma=n-r,V=p-e,S=D-n,Sa=Math.max(Math.min(e,k,p)+15>>4,0),Nb=Math.min(Math.max(e,k,p)+15>>4,z),nb=Math.max(Math.min(D,r,n)+15>>4,0),Fb=Math.min(Math.max(D,r,n)+15>>4,I);wa=Math.min(Sa,wa);xa=Math.max(Nb,xa);ya=Math.min(nb,ya);za=Math.max(Fb,za);var H=M,Sa=Sa&~(H-1),nb=nb&~(H-1),Ta=Sa<<4,Ua=nb<<4,Ib=O*(Ta-e)+R*(Ua-D),Jb=ma*(Ta-k)+va*(Ua-r),Kb=S*(Ta-p)+V*(Ua-n);(0<O||0==O&&0<R)&&Ib++;(0<ma||
0==ma&&0<va)&&Jb++;(0<S||0==S&&0<V)&&Kb++;var Ib=Ib-1>>4,Jb=Jb-1>>4,Kb=Kb-1>>4,Gb=P-ba,Hb=ca-P,Aa=1/(R*S-V*O),na=Aa*(Gb*S-Hb*O),oa=Aa*(Gb*V-R*Hb),Mb=P+(Ta-e)*na+(Ua-D)*oa|0,na=16*na|0,oa=16*oa|0,Va,Wa,pa,qa;if(t){var Rb=X-N,Sb=Ia-X,eb=Aa*(Rb*S-Sb*O),fb=Aa*(Rb*V-R*Sb),Tb=da-Ha,Ub=U-da;Va=Aa*(Tb*S-Ub*O);Wa=Aa*(Tb*V-R*Ub);pa=X+(Ta-e)*eb+(Ua-D)*fb;qa=da+(Ta-e)*Va+(Ua-D)*Wa;eb*=16;fb*=16;Va*=16;Wa*=16}var Xa,ra;if(q){var Vb=ua-mb,Wb=Eb-ua,gb=Aa*(Vb*S-Wb*O);Xa=Aa*(Vb*V-R*Wb);ra=ua+(Ta-e)*gb+(Ua-D)*Xa;gb*=
16;Xa*=16}var K=H-1,ob=0,hb=0,pb=0,ib=0,qb=0,jb=0,rb=0,sb=0;0<=R?hb-=K*R:ob-=K*R;0<=O?hb-=K*O:ob-=K*O;0<=va?ib-=K*va:pb-=K*va;0<=ma?ib-=K*ma:pb-=K*ma;0<=V?jb-=K*V:qb-=K*V;0<=S?jb-=K*S:qb-=K*S;0<=na?sb+=K*na:rb+=K*na;0<=oa?sb+=K*oa:rb+=K*oa;var Xb=z-H,Y=Ib,Z=Jb,ia=Kb,ja=Mb,aa=-H,tb=aa*O,ub=aa*ma,vb=aa*S,Lb=aa*na,wb,xb;t&&(wb=aa*eb,xb=aa*Va);var yb;q&&(yb=aa*gb);for(var ka=Sa,zb=nb;zb<Fb;zb+=H){for(;ka>=Sa&&ka<Nb&&Y>=hb&&Z>=ib&&ia>=jb;)ka+=aa,Y+=tb,Z+=ub,ia+=vb,ja+=Lb,t&&(pa+=wb,qa+=xb),q&&(ra+=yb);
aa=-aa;tb=-tb;ub=-ub;vb=-vb;Lb=-Lb;t&&(wb=-wb,xb=-xb);for(q&&(yb=-yb);;){ka+=aa;Y+=tb;Z+=ub;ia+=vb;ja+=Lb;t&&(pa+=wb,qa+=xb);q&&(ra+=yb);if(ka<Sa||ka>=Nb)break;if(Y<hb)if(0>tb)break;else continue;if(Z<ib)if(0>ub)break;else continue;if(ia<jb)if(0>vb)break;else continue;var Yb=ka>>Ya,Zb=zb>>Ya,Ab=Yb+Zb*sa;if(!(ta[Ab]<ja+rb)){var $b=W[Ab];$b&2&&Ob(Yb,Zb);W[Ab]=$b&-4;var la=ka+zb*z;if(Y>=ob&&Z>=pb&&ia>=qb){ta[Ab]=Math.min(ta[Ab],ja+sb);var Za=Y,$a=Z,ab=ja,Ba,Ca;t&&(Ba=pa,Ca=qa);var Da;q&&(Da=ra);for(var Bb=
0;Bb<H;Bb++){var kb=Za,lb=$a,bb=ab,Ea,Fa;t&&(Ea=Ba,Fa=Ca);var Ga;q&&(Ga=Da);for(var Cb=0;Cb<H;Cb++){var Db=bb;Db<T[la]&&f(L,T,la,Db,Ea,Fa,Ga,c,l);kb+=O;lb+=ma;bb+=na;t&&(Ea+=eb,Fa+=Va);q&&(Ga+=gb);la++}Za+=R;$a+=va;ab+=oa;t&&(Ba+=fb,Ca+=Wa);q&&(Da+=Xa);la+=Xb}}else{var Za=Y,$a=Z,Pb=ia,ab=ja;t&&(Ba=pa,Ca=qa);q&&(Da=ra);for(Bb=0;Bb<H;Bb++){var kb=Za,lb=$a,Qb=Pb,bb=ab;t&&(Ea=Ba,Fa=Ca);q&&(Ga=Da);for(Cb=0;Cb<H;Cb++)0<=(kb|lb|Qb)&&(Db=bb,Db<T[la]&&f(L,T,la,Db,Ea,Fa,Ga,c,l)),kb+=O,lb+=ma,Qb+=S,bb+=na,t&&
(Ea+=eb,Fa+=Va),q&&(Ga+=gb),la++;Za+=R;$a+=va;Pb+=V;ab+=oa;t&&(Ba+=fb,Ca+=Wa);q&&(Da+=Xa);la+=Xb}}}}Y+=H*R;Z+=H*va;ia+=H*V;ja+=H*oa;t&&(pa+=H*fb,qa+=H*Wa);q&&(ra+=H*Xa)}}}}function Ob(a,m){for(var b=a*M+m*M*z,g=4*b,h=z-M,d=4*h,f=0;f<M;f++){for(var c=0;c<M;c++)T[b++]=16777216,L[g++]=255*ba.r|0,L[g++]=255*ba.g|0,L[g++]=255*ba.b|0,L[g++]=da?0:255;b+=h;g+=d}}console.log("THREE.SoftwareRenderer",THREE.REVISION);u=u||{};var C=void 0!==u.canvas?u.canvas:document.createElement("canvas"),P=C.getContext("2d",
{alpha:!0===u.alpha}),da=u.alpha,ea={},U={},z,I,sa,X,Ja,La,Qa,Ka,Ma,Ra,ba=new THREE.Color(0),Ha,L,T,ca,ta,W,Ya=3,M=1<<Ya,Eb=!1,bc=new THREE.Vector3(0,0,1),Ia=new THREE.Vector3,wa=Infinity,ya=Infinity,xa=0,za=0,Fb=Infinity,Gb=Infinity,Hb=0,Mb=0,cc=new THREE.Projector,w=new THREE.Vector4,x=new THREE.Vector4,y=new THREE.Vector4,cb=new THREE.Vector2,db=new THREE.Vector2,ua=new THREE.Vector2,Oa=[],F=0,Pa=[],G=0,Na=[],E=0;this.domElement=C;this.autoClear=!0;this.setClearColor=function(a){ba.set(a);v(ba)};
this.setPixelRatio=function(){};this.setSize=function(a,m){sa=Math.floor(a/M);X=Math.floor(m/M);z=sa*M;I=X*M;Ja=16*z/2;La=-16*I/2;Qa=8388608;Ka=16*z/2+.5;Ma=16*I/2+.5;Ra=8388608.5;C.width=z;C.height=I;P.fillStyle=da?"rgba(0, 0, 0, 0)":ba.getStyle();P.fillRect(0,0,z,I);Ha=P.getImageData(0,0,z,I);L=Ha.data;T=new Int32Array(L.length/4);ca=sa*X;ta=new Int32Array(ca);W=new Uint8Array(ca);for(var b=0,g=T.length;b<g;b++)T[b]=16777216;for(b=0;b<ca;b++)W[b]=1;v(ba)};this.setSize(C.width,C.height);this.clear=
function(){ya=wa=Infinity;for(var a=E=G=F=za=xa=0;a<ca;a++)ta[a]=16777216,W[a]=W[a]&1?1:2};this.render=function(a,m){this.clear();var b=a.background;b&&b.isColor&&v(b);for(var b=cc.projectScene(a,m,!1,!1).elements,g=0,h=b.length;g<h;g++){var d=b[g],f=d.material,c=mb(f);if(c)if(d instanceof THREE.RenderableFace)d.uvs?fa(d.v1.positionScreen,d.v2.positionScreen,d.v3.positionScreen,d.uvs[0],d.uvs[1],d.uvs[2],c,d,f):fa(d.v1.positionScreen,d.v2.positionScreen,d.v3.positionScreen,null,null,null,c,d,f);else if(d instanceof
THREE.RenderableSprite){var l=.5*d.scale.x,e=.5*d.scale.y;w.copy(d);w.x-=l;w.y+=e;x.copy(d);x.x-=l;x.y-=e;y.copy(d);y.x+=l;y.y+=e;f.map?(cb.set(0,1),db.set(0,0),ua.set(1,1),fa(w,x,y,cb,db,ua,c,d,f)):fa(w,x,y,null,null,null,c,d,f);w.copy(d);w.x+=l;w.y+=e;x.copy(d);x.x-=l;x.y-=e;y.copy(d);y.x+=l;y.y-=e;f.map?(cb.set(1,1),db.set(0,0),ua.set(1,0),fa(w,x,y,cb,db,ua,c,d,f)):fa(w,x,y,null,null,null,c,d,f)}else if(d instanceof THREE.RenderableLine){c=mb(f);var k=d.v1.positionScreen,p=d.v2.positionScreen,
l=d.vertexColors[0],d=d.vertexColors[1];if(!Eb){Eb=!0;Ya=0;M=1<<Ya;e=C.height;sa=Math.floor(C.width/M);X=Math.floor(e/M);z=sa*M;I=X*M;Ja=16*z/2;La=-16*I/2;Qa=8388608;Ka=16*z/2+.5;Ma=16*I/2+.5;Ra=8388608.5;C.width=z;C.height=I;P.fillStyle=da?"rgba(0, 0, 0, 0)":ba.getStyle();P.fillRect(0,0,z,I);Ha=P.getImageData(0,0,z,I);L=Ha.data;T=new Int32Array(L.length/4);ca=sa*X;ta=new Int32Array(ca);W=new Uint8Array(ca);for(var e=0,n=T.length;e<n;e++)T[e]=16777216;for(e=0;e<ca;e++)W[e]=1;v(ba)}if(!(-1>k.z||1<
k.z||-1>p.z||1<p.z)){var e=Math.floor(.5*(f.linewidth-1)),r=k.x*Ja+Ka|0,n=p.x*Ja+Ka|0,u=k.y*La+Ma|0,q=p.y*La+Ma|0,k=k.z*Qa+Ra|0,p=p.z*Qa+Ra|0,t=r-n,E=u-q,A=k-p,F=Math.min(Math.max(r,n)+15>>4,z),G=Math.max(Math.min(u,q)+15>>4,0),J=Math.min(Math.max(u,q)+15>>4,I),u=Math.max(Math.min(k,p)+15>>4,0),k=Math.max(k,p)+15>>4;wa=Math.min(Math.max(Math.min(r,n)+15>>4,0),wa);xa=Math.max(F,xa);ya=Math.min(G,ya);za=Math.max(J,za);var r=Math.sqrt(E*E+t*t),t=t/r,E=E/r,A=A/r,B=J=G=F=void 0,N=void 0,J=void 0;Ia.set(t,
E,A);Ia.cross(bc);for(Ia.normalize();0<r;){for(var F=n+r*t,G=q+r*E,J=p+r*A,F=F+15>>4,G=G+15>>4,J=J+15>>4,U=-e;U<=e;++U)if(B=Math.floor(F+Ia.x*U),N=Math.floor(G+Ia.y*U),!(wa>=B||xa<=B||ya>=N||za<=N)){var ea=B>>Ya,ga=N>>Ya,Q=ea+ga*sa;if(!(ta[Q]<u)){ta[Q]=Math.min(ta[Q],k);var ha=W[Q];ha&2&&Ob(ea,ga);W[Q]=ha&-4;B+=N*z;J<T[B]&&c(L,T,B,J,l,d,f)}}--r}}}}for(g=b=0;g<X;g++)for(h=0;h<sa;h++)W[b]&2&&(Ob(h,g),W[b]=1),b++;b=Math.min(wa,Fb);g=Math.min(ya,Gb);h=Math.max(xa,Hb)-b;l=Math.max(za,Mb)-g;Infinity!==
b&&P.putImageData(Ha,0,0,b,g,h,l);Fb=wa;Gb=ya;Hb=xa;Mb=za}};THREE.SoftwareRenderer.Texture=function(){var u;this.fromImage=function(v){if(!(!v||0>=v.width||0>=v.height)){void 0===u&&(u=document.createElement("canvas"));var n=v.width>v.height?v.width:v.height,n=THREE.Math.ceilPowerOfTwo(n);if(u.width!=n||u.height!=n)u.width=n,u.height=n;var N=u.getContext("2d");N.clearRect(0,0,n,n);N.drawImage(v,0,0,n,n);this.data=N.getImageData(0,0,n,n).data;this.height=this.width=n;this.srcUrl=v.src}}};