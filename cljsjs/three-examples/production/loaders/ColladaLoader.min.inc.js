THREE.ColladaLoader=function(G){this.manager=void 0!==G?G:THREE.DefaultLoadingManager};
THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"Anonymous",load:function(G,S,E,t){var I=this,x=void 0===I.path?THREE.LoaderUtils.extractUrlBase(G):I.path;(new THREE.FileLoader(I.manager)).load(G,function(t){S(I.parse(t,x))},E,t)},setPath:function(G){this.path=G},options:{set convertUpAxis(G){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(G){this.crossOrigin=G},parse:function(G,
S){function E(a,b){for(var e=[],c=a.childNodes,d=0,f=c.length;d<f;d++){var g=c[d];g.nodeName===b&&e.push(g)}return e}function t(a){if(0===a.length)return[];a=a.trim().split(/\s+/);for(var b=Array(a.length),e=0,c=a.length;e<c;e++)b[e]=parseFloat(a[e]);return b}function I(a){if(0===a.length)return[];a=a.trim().split(/\s+/);for(var b=Array(a.length),e=0,c=a.length;e<c;e++)b[e]=parseInt(a[e]);return b}function x(a){return a.substring(1)}function F(a,b,e,c){a=E(a,b)[0];if(void 0!==a)for(e=E(a,e),a=0;a<
e.length;a++)c(e[a])}function H(a,b){for(var e in a)a[e].build=b(a[e])}function z(a,b){if(void 0!==a.build)return a.build;a.build=b(a);return a.build}function T(a){var b,e,c=[],d=a.channels,f=a.samplers;a=a.sources;for(var g in d)if(d.hasOwnProperty(g)){var k=d[g];b=f[k.sampler];e=a[b.inputs.INPUT];var l=a[b.inputs.OUTPUT],n=q.nodes[k.id];b=M(n.id);var h=n.transforms[k.sid],n=n.matrix.clone().transpose(),p=void 0,m=void 0,r=void 0,u=void 0,v=void 0,J=void 0,w={};switch(h){case "matrix":r=0;for(u=
e.array.length;r<u;r++)if(p=e.array[r],m=r*l.stride,void 0===w[p]&&(w[p]={}),!0===k.arraySyntax)w[p][k.indices[0]+4*k.indices[1]]=l.array[m];else for(v=0,J=l.stride;v<J;v++)w[p][v]=l.array[m+v];break;case "translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case "rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case "scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',
h)}k=qa(w,n);b=b.uuid;e=k;k=c;l=[];h=[];n=[];p=[];m=0;for(r=e.length;m<r;m++)u=e[m],v=u.time,C.fromArray(u.value).transpose(),C.decompose(Q,P,R),l.push(v),h.push(Q.x,Q.y,Q.z),n.push(P.x,P.y,P.z,P.w),p.push(R.x,R.y,R.z);0<h.length&&k.push(new THREE.VectorKeyframeTrack(b+".position",l,h));0<n.length&&k.push(new THREE.QuaternionKeyframeTrack(b+".quaternion",l,n));0<p.length&&k.push(new THREE.VectorKeyframeTrack(b+".scale",l,p))}return c}function qa(a,b){var e=[],c;for(c in a)e.push({time:parseFloat(c),
value:a[c]});e.sort(function(a,b){return a.time-b.time});for(c=0;16>c;c++)ra(e,c,b.elements[c]);return e}function ra(a,b,e){var c,d=!0,f,g;f=0;for(g=a.length;f<g;f++)c=a[f],void 0===c.value[b]?c.value[b]=null:d=!1;if(!0===d)for(f=0,g=a.length;f<g;f++)c=a[f],c.value[b]=e;else for(e=0,c=a.length;e<c;e++)if(d=a[e],null===d.value[b]){a:{for(f=e;0<=f;){g=a[f];if(null!==g.value[b]){f=g;break a}f--}f=null}a:{for(g=e;g<a.length;){var k=a[g];if(null!==k.value[b]){g=k;break a}g++}g=null}d.value[b]=null===f?
g.value[b]:null===g?f.value[b]:0===g.time-f.time?f.value[b]:(d.time-f.time)*(g.value[b]-f.value[b])/(g.time-f.time)+f.value[b]}}function ca(a){var b=[],e=a.name,c=a.end-a.start||-1;a=a.animations;for(var d=0,f=a.length;d<f;d++)for(var g=z(q.animations[a[d]],T),k=0,l=g.length;k<l;k++)b.push(g[k]);return new THREE.AnimationClip(e,c,b)}function da(a){var b={id:a.id},e=q.geometries[b.id];void 0!==a.skin&&(b.skin=sa(a.skin),e.sources.skinIndices=b.skin.indices,e.sources.skinWeights=b.skin.weights);return b}
function sa(a){function b(a,b){return b.weight-a.weight}var e={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},c=a.vertexWeights,d=c.vcount,f=c.v,g=c.inputs.JOINT.offset,k=c.inputs.WEIGHT.offset,l=a.sources[a.joints.inputs.JOINT],n=a.sources[a.joints.inputs.INV_BIND_MATRIX],h=a.sources[c.inputs.WEIGHT.id].array,p=0,m,r,c=0;for(r=d.length;c<r;c++){var u=d[c],v=[];for(m=0;m<u;m++)v.push({index:f[p+g],weight:h[f[p+k]]}),p+=2;v.sort(b);for(m=0;4>m;m++)u=v[m],void 0!==u?(e.indices.array.push(u.index),
e.weights.array.push(u.weight)):(e.indices.array.push(0),e.weights.array.push(0))}e.bindMatrix=(new THREE.Matrix4).fromArray(a.bindShapeMatrix).transpose();c=0;for(r=l.array.length;c<r;c++)a=l.array[c],d=(new THREE.Matrix4).fromArray(n.array,c*n.stride).transpose(),e.joints.push({name:a,boneInverse:d});return e}function U(a){return void 0!==a.build?a.build:a.init_from}function ea(a){for(var b={},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "color":b[d.nodeName]=
t(d.textContent);break;case "float":b[d.nodeName]=parseFloat(d.textContent);break;case "texture":for(var f=d.nodeName,g=d.getAttribute("texture"),k={technique:{}},l=0,n=d.childNodes.length;l<n;l++){var h=d.childNodes[l];if(1===h.nodeType)switch(h.nodeName){case "extra":for(var p=k,m=0,r=h.childNodes.length;m<r;m++){var u=h.childNodes[m];if(1===u.nodeType)switch(u.nodeName){case "technique":for(var v=p,q=0,w=u.childNodes.length;q<w;q++){var y=u.childNodes[q];if(1===y.nodeType)switch(y.nodeName){case "repeatU":case "repeatV":case "offsetU":case "offsetV":v.technique[y.nodeName]=
parseFloat(y.textContent);break;case "wrapU":case "wrapV":"TRUE"===y.textContent.toUpperCase()?v.technique[y.nodeName]=1:"FALSE"===y.textContent.toUpperCase()?v.technique[y.nodeName]=0:v.technique[y.nodeName]=parseInt(y.textContent)}}}}}}b[f]={id:g,extra:k}}}return b}function fa(a){return a}function ga(a){function b(a){var b=e.profile.samplers[a.id];void 0!==b?b=z(q.images[e.profile.surfaces[b.source].init_from],U):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),
b=z(q.images[a.id],U));if(void 0!==b)return b=ha.load(b),a=a.extra,void 0!==a&&void 0!==a.technique&&0===Object.keys(a.technique).length===!1?(a=a.technique,b.wrapS=a.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,b.wrapT=a.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,b.offset.set(a.offsetU||0,a.offsetV||0),b.repeat.set(a.repeatU||1,a.repeatV||1)):(b.wrapS=THREE.RepeatWrapping,b.wrapT=THREE.RepeatWrapping),b;console.error("THREE.ColladaLoader: Unable to load texture with ID:",a.id);
return null}var e=z(q.effects[a.url],fa),c=e.profile.technique,d=e.profile.extra,f;switch(c.type){case "phong":case "blinn":f=new THREE.MeshPhongMaterial;break;case "lambert":f=new THREE.MeshLambertMaterial;break;default:f=new THREE.MeshBasicMaterial}f.name=a.name;a=c.parameters;for(var g in a)switch(c=a[g],g){case "diffuse":c.color&&f.color.fromArray(c.color);c.texture&&(f.map=b(c.texture));break;case "specular":c.color&&f.specular&&f.specular.fromArray(c.color);c.texture&&(f.specularMap=b(c.texture));
break;case "shininess":c.float&&f.shininess&&(f.shininess=c.float);break;case "emission":c.color&&f.emissive&&f.emissive.fromArray(c.color)}g=a.transparent;a=a.transparency;void 0===a&&g&&(a={float:1});void 0===g&&a&&(g={opaque:"A_ONE",data:{color:[1,1,1,1]}});if(g&&a)if(g.data.texture)f.alphaMap=b(g.data.texture),f.transparent=!0;else{c=g.data.color;switch(g.opaque){case "A_ONE":f.opacity=c[3]*a.float;break;case "RGB_ZERO":f.opacity=1-c[0]*a.float;break;case "A_ZERO":f.opacity=1-c[3]*a.float;break;
case "RGB_ONE":f.opacity=c[0]*a.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',g.opaque)}1>f.opacity&&(f.transparent=!0)}void 0!==d&&void 0!==d.technique&&1===d.technique.double_sided&&(f.side=THREE.DoubleSide);return f}function ia(a){var b;switch(a.optics.technique){case "perspective":b=new THREE.PerspectiveCamera(a.optics.parameters.yfov,a.optics.parameters.aspect_ratio,a.optics.parameters.znear,a.optics.parameters.zfar);break;case "orthographic":b=
a.optics.parameters.ymag;var e=a.optics.parameters.xmag,c=a.optics.parameters.aspect_ratio,e=void 0===e?b*c:e;b=void 0===b?e/c:b;e*=.5;b*=.5;b=new THREE.OrthographicCamera(-e,e,b,-b,a.optics.parameters.znear,a.optics.parameters.zfar);break;default:b=new THREE.PerspectiveCamera}b.name=a.name;return b}function ja(a){var b;switch(a.technique){case "directional":b=new THREE.DirectionalLight;break;case "point":b=new THREE.PointLight;break;case "spot":b=new THREE.SpotLight;break;case "ambient":b=new THREE.AmbientLight}a.parameters.color&&
b.color.copy(a.parameters.color);a.parameters.distance&&(b.distance=a.parameters.distance);return b}function V(a){for(var b={array:[],stride:3},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "float_array":b.array=t(c.textContent);break;case "Name_array":c=c.textContent;if(0===c.length)c=[];else{for(var c=c.trim().split(/\s+/),d=Array(c.length),f=0,g=c.length;f<g;f++)d[f]=c[f];c=d}b.array=c;break;case "technique_common":c=E(c,"accessor")[0],void 0!==
c&&(b.stride=parseInt(c.getAttribute("stride")))}}return b}function ta(a){for(var b={type:a.nodeName,material:a.getAttribute("material"),count:parseInt(a.getAttribute("count")),inputs:{},stride:0,hasUV:!1},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "input":var f=x(d.getAttribute("source")),g=d.getAttribute("semantic"),d=parseInt(d.getAttribute("offset"));b.inputs[g]={id:f,offset:d};b.stride=Math.max(b.stride,d+1);"TEXCOORD"===g&&(b.hasUV=!0);
break;case "vcount":b.vcount=I(d.textContent);break;case "p":b.p=I(d.textContent)}}return b}function W(a){var b={},e=a.sources,c=a.vertices,d=a.primitives;if(0===d.length)return{};a={};for(var f=0;f<d.length;f++){var g=d[f];void 0===a[g.type]&&(a[g.type]=[]);a[g.type].push(g)}for(var k in a){for(var f=a[k],g=d=0,l=f.length;g<l;g++)!0===f[g].hasUV&&d++;0<d&&d<f.length&&(f.uvsNeedsFix=!0);for(var d=k,g=e,l=c,n={},h=[],p=0,m=[],r=0,u=[],v=0,q=[],w=0,y=[],X=[],L=new THREE.BufferGeometry,x=[],A=0,t=0,
z=0;z<f.length;z++){var B=f[z],E=B.inputs,D=1;B.vcount&&4===B.vcount[0]&&(D=2);t="lines"===B.type||"linestrips"===B.type?2*B.count:3*B.count*D;L.addGroup(A,t,z);A+=t;B.material&&x.push(B.material);for(var G in E)switch(D=E[G],G){case "VERTEX":for(var F in l)switch(t=l[F],F){case "POSITION":var C=h.length;K(B,g[t],D.offset,h);p=g[t].stride;g.skinWeights&&g.skinIndices&&(K(B,g.skinIndices,D.offset,y),K(B,g.skinWeights,D.offset,X));if(!1===B.hasUV&&!0===f.uvsNeedsFix)for(t=(h.length-C)/p,C=0;C<t;C++)u.push(0,
0);break;case "NORMAL":K(B,g[t],D.offset,m);r=g[t].stride;break;case "COLOR":K(B,g[t],D.offset,q);w=g[t].stride;break;case "TEXCOORD":K(B,g[t],D.offset,u);v=g[t].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',F)}break;case "NORMAL":K(B,g[D.id],D.offset,m);r=g[D.id].stride;break;case "COLOR":K(B,g[D.id],D.offset,q);w=g[D.id].stride;break;case "TEXCOORD":K(B,g[D.id],D.offset,u),v=g[D.id].stride}}0<h.length&&L.addAttribute("position",new THREE.Float32BufferAttribute(h,
p));0<m.length&&L.addAttribute("normal",new THREE.Float32BufferAttribute(m,r));0<q.length&&L.addAttribute("color",new THREE.Float32BufferAttribute(q,w));0<u.length&&L.addAttribute("uv",new THREE.Float32BufferAttribute(u,v));0<y.length&&L.addAttribute("skinIndex",new THREE.Float32BufferAttribute(y,4));0<X.length&&L.addAttribute("skinWeight",new THREE.Float32BufferAttribute(X,4));n.data=L;n.type=f[0].type;n.materialKeys=x;b[d]=n}return b}function K(a,b,e,c){function d(a){a=f[a+e]*h;for(var b=a+h;a<
b;a++)c.push(n[a])}var f=a.p,g=a.stride,k=a.vcount,l=0,n=b.array,h=b.stride;if(void 0!==a.vcount){b=a=0;for(var p=k.length;b<p;b++){var m=k[b];if(4===m){var r=a+0*g,u=a+1*g,v=a+2*g,q=a+3*g;d(r);d(u);d(q);d(u);d(v);d(q)}else 3===m?(r=a+0*g,u=a+1*g,v=a+2*g,d(r),d(u),d(v)):l=Math.max(l,m);a+=g*m}0<l&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(b=0,p=f.length;b<p;b+=g)d(b)}function ua(a){return void 0!==a.build?a.build:a}function ka(a){for(var b={sid:a.getAttribute("sid"),
name:a.getAttribute("name")||"",attachments:[],transforms:[]},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "attachment_full":b.attachments.push(va(c));break;case "matrix":case "translate":case "rotate":b.transforms.push(la(c))}}return b}function va(a){for(var b={joint:a.getAttribute("joint").split("/").pop(),transforms:[],links:[]},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "link":b.links.push(ka(c));
break;case "matrix":case "translate":case "rotate":b.transforms.push(la(c))}}return b}function la(a){var b={type:a.nodeName};a=t(a.textContent);switch(b.type){case "matrix":b.obj=new THREE.Matrix4;b.obj.fromArray(a).transpose();break;case "translate":b.obj=new THREE.Vector3;b.obj.fromArray(a);break;case "rotate":b.obj=new THREE.Vector3,b.obj.fromArray(a),b.angle=THREE.Math.degToRad(a[3])}return b}function wa(a){for(var b={target:a.getAttribute("target").split("/").pop()},e=0;e<a.childNodes.length;e++){var c=
a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "axis":c=c.getElementsByTagName("param")[0],b.axis=c.textContent,c=b.axis.split("inst_").pop().split("axis")[0],b.jointIndex=c.substr(0,c.length-1)}}return b}function xa(a){return void 0!==a.build?a.build:a}function Y(a){for(var b={name:a.getAttribute("name")||"",type:a.getAttribute("type"),id:a.getAttribute("id"),sid:a.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],
instanceNodes:[],transforms:{}},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "node":b.nodes.push(c.getAttribute("id"));Y(c);break;case "instance_camera":b.instanceCameras.push(x(c.getAttribute("url")));break;case "instance_controller":b.instanceControllers.push(ma(c));break;case "instance_light":b.instanceLights.push(x(c.getAttribute("url")));break;case "instance_geometry":b.instanceGeometries.push(ma(c));break;case "instance_node":b.instanceNodes.push(x(c.getAttribute("url")));
break;case "matrix":var d=t(c.textContent);b.matrix.multiply(C.fromArray(d).transpose());b.transforms[c.getAttribute("sid")]=c.nodeName;break;case "translate":d=t(c.textContent);N.fromArray(d);b.matrix.multiply(C.makeTranslation(N.x,N.y,N.z));b.transforms[c.getAttribute("sid")]=c.nodeName;break;case "rotate":var d=t(c.textContent),f=THREE.Math.degToRad(d[3]);b.matrix.multiply(C.makeRotationAxis(N.fromArray(d),f));b.transforms[c.getAttribute("sid")]=c.nodeName;break;case "scale":d=t(c.textContent);
b.matrix.scale(N.fromArray(d));b.transforms[c.getAttribute("sid")]=c.nodeName;break;case "extra":break;default:console.log(c)}}return q.nodes[b.id]=b}function ma(a){for(var b={id:x(a.getAttribute("url")),materials:{},skeletons:[]},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];switch(c.nodeName){case "bind_material":for(var c=c.getElementsByTagName("instance_material"),d=0;d<c.length;d++){var f=c[d],g=f.getAttribute("symbol"),f=f.getAttribute("target");b.materials[g]=x(f)}break;case "skeleton":b.skeletons.push(x(c.textContent))}}return b}
function na(a,b,e){a.traverse(function(a){if(!0===a.isBone){for(var d,f=0;f<b.length;f++){var g=b[f];if(g.name===a.name){d=g.boneInverse;break}}void 0===d&&(d=new THREE.Matrix4);e.push({bone:a,boneInverse:d,processed:!1})}})}function ya(a){for(var b=[],e=a.matrix,c=a.nodes,d=a.type,f=a.instanceCameras,g=a.instanceControllers,k=a.instanceLights,l=a.instanceGeometries,n=a.instanceNodes,h=0,p=c.length;h<p;h++)b.push(M(c[h]));h=0;for(p=f.length;h<p;h++){var m;m=f[h];var r=q.cameras[m];void 0!==r?m=z(r,
ia):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",m),m=null);null!==m&&b.push(m.clone())}h=0;for(p=g.length;h<p;h++){r=g[h];f=z(q.controllers[r.id],da);m=z(q.geometries[f.id],W);m=oa(m,r.materials);for(var u=r.skeletons,v=f.skin.joints,J=[],r=[],w=void 0,y=void 0,t=void 0,w=0;w<u.length;w++){var y=u[w],x;if(void 0!==q.nodes[y])x=M(y),na(x,v,J);else if(void 0!==q.visualScenes[y])for(t=q.visualScenes[y].children,y=0;y<t.length;y++)x=t[y],"JOINT"===x.type&&(x=M(x.id),na(x,v,J));
else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",y)}for(w=0;w<v.length;w++)for(y=0;y<J.length;y++)if(t=J[y],t.bone.name===v[w].name){r[w]=t;t.processed=!0;break}for(w=0;w<J.length;w++)t=J[w],!1===t.processed&&(r.push(t),t.processed=!0);u=[];v=[];for(w=0;w<r.length;w++)t=r[w],u.push(t.bone),v.push(t.boneInverse);r=new THREE.Skeleton(u,v);w=0;for(u=m.length;w<u;w++)v=m[w],v.isSkinnedMesh&&(v.bind(r,f.skin.bindMatrix),v.normalizeSkinWeights()),b.push(v)}h=0;for(p=
k.length;h<p;h++)g=k[h],f=q.lights[g],void 0!==f?g=z(f,ja):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",g),g=null),null!==g&&b.push(g.clone());h=0;for(p=l.length;h<p;h++)for(r=l[h],m=z(q.geometries[r.id],W),m=oa(m,r.materials),w=0,u=m.length;w<u;w++)b.push(m[w]);h=0;for(p=n.length;h<p;h++)b.push(M(n[h]).clone());if(0===c.length&&1===b.length)v=b[0];else for(v="JOINT"===d?new THREE.Bone:new THREE.Group,h=0;h<b.length;h++)v.add(b[h]);""===v.name&&(v.name="JOINT"===d?a.sid:a.name);
v.matrix.copy(e);v.matrix.decompose(v.position,v.quaternion,v.scale);return v}function oa(a,b){var e=[],c;for(c in a){var d=a[c],f,g=d.materialKeys;f=b;for(var k=[],l=0,n=g.length;l<n;l++)k.push(z(q.materials[f[g[l]]],ga));f=k;0===f.length&&("lines"===c||"linestrips"===c?f.push(new THREE.LineBasicMaterial):f.push(new THREE.MeshPhongMaterial));if(g=void 0!==d.data.attributes.skinIndex)for(k=0,l=f.length;k<l;k++)f[k].skinning=!0;f=1===f.length?f[0]:f;var h;switch(c){case "lines":h=new THREE.LineSegments(d.data,
f);break;case "linestrips":h=new THREE.Line(d.data,f);break;case "triangles":case "polylist":h=g?new THREE.SkinnedMesh(d.data,f):new THREE.Mesh(d.data,f)}e.push(h)}return e}function M(a){return z(q.nodes[a],ya)}function Z(a){var b=new THREE.Group;b.name=a.name;a=a.children;for(var e=0;e<a.length;e++)b.add(M(a[e].id));return b}var Q=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Quaternion,C=new THREE.Matrix4,N=new THREE.Vector3;console.time("THREE.ColladaLoader");if(0===G.length)return{scene:new THREE.Scene};
console.time("THREE.ColladaLoader: DOMParser");var O=(new DOMParser).parseFromString(G,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var A=E(O,"COLLADA")[0],O=A.getAttribute("version");console.log("THREE.ColladaLoader: File version",O);var O=function(a){var b;b=E(a,"unit")[0];b=void 0!==b&&!0===b.hasAttribute("meter")?parseFloat(b.getAttribute("meter")):1;a=E(a,"up_axis")[0];return{unit:b,upAxis:void 0!==a?a.textContent:"Y_UP"}}(E(A,"asset")[0]),ha=new THREE.TextureLoader(this.manager);
ha.setPath(S).setCrossOrigin(this.crossOrigin);var aa=[],pa={},za=0,q={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse");F(A,"library_animations","animation",function(a){for(var b={sources:{},samplers:{},channels:{}},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType){var f;switch(d.nodeName){case "source":f=d.getAttribute("id");
b.sources[f]=V(d);break;case "sampler":f=d.getAttribute("id");for(var g=b.samplers,k={inputs:{}},l=0,n=d.childNodes.length;l<n;l++){var h=d.childNodes[l];if(1===h.nodeType)switch(h.nodeName){case "input":var p=x(h.getAttribute("source")),h=h.getAttribute("semantic");k.inputs[h]=p}}g[f]=k;break;case "channel":f=d.getAttribute("target");var g=b.channels,k={},m=d.getAttribute("target").split("/"),l=m.shift(),n=m.shift(),p=-1!==n.indexOf("(");if(h=-1!==n.indexOf("."))m=n.split("."),n=m.shift(),k.member=
m.shift();else if(p){for(var m=n.split("("),n=m.shift(),r=0;r<m.length;r++)m[r]=parseInt(m[r].replace(/\)/,""));k.indices=m}k.id=l;k.sid=n;k.arraySyntax=p;k.memberSyntax=h;k.sampler=x(d.getAttribute("source"));g[f]=k;break;default:console.log(d)}}}q.animations[a.getAttribute("id")]=b});F(A,"library_animation_clips","animation_clip",function(a){for(var b={name:a.getAttribute("id")||"default",start:parseFloat(a.getAttribute("start")||0),end:parseFloat(a.getAttribute("end")||0),animations:[]},e=0,c=
a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "instance_animation":b.animations.push(x(d.getAttribute("url")))}}q.clips[a.getAttribute("id")]=b});F(A,"library_controllers","controller",function(a){for(var b={},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "skin":b.id=x(d.getAttribute("source"));for(var f={sources:{}},g=0,k=d.childNodes.length;g<k;g++){var l=d.childNodes[g];if(1===l.nodeType)switch(l.nodeName){case "bind_shape_matrix":f.bindShapeMatrix=
t(l.textContent);break;case "source":var n=l.getAttribute("id");f.sources[n]=V(l);break;case "joints":for(var n={inputs:{}},h=0,p=l.childNodes.length;h<p;h++){var m=l.childNodes[h];if(1===m.nodeType)switch(m.nodeName){case "input":var r=m.getAttribute("semantic"),m=x(m.getAttribute("source"));n.inputs[r]=m}}f.joints=n;break;case "vertex_weights":n={inputs:{}};h=0;for(p=l.childNodes.length;h<p;h++){var u=l.childNodes[h];if(1===u.nodeType)switch(u.nodeName){case "input":r=u.getAttribute("semantic");
m=x(u.getAttribute("source"));u=parseInt(u.getAttribute("offset"));n.inputs[r]={id:m,offset:u};break;case "vcount":n.vcount=I(u.textContent);break;case "v":n.v=I(u.textContent)}}f.vertexWeights=n}}b.skin=f;break;case "morph":b.id=x(d.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}q.controllers[a.getAttribute("id")]=b});F(A,"library_images","image",function(a){var b={init_from:E(a,"init_from")[0].textContent};q.images[a.getAttribute("id")]=b});
F(A,"library_effects","effect",function(a){for(var b={},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "profile_COMMON":for(var f={surfaces:{},samplers:{}},g=0,k=d.childNodes.length;g<k;g++){var l=d.childNodes[g];if(1===l.nodeType)switch(l.nodeName){case "newparam":for(var n=f,h=l.getAttribute("sid"),p=0,m=l.childNodes.length;p<m;p++){var r=l.childNodes[p];if(1===r.nodeType)switch(r.nodeName){case "surface":for(var u=n.surfaces,v={},t=0,w=r.childNodes.length;t<
w;t++){var y=r.childNodes[t];if(1===y.nodeType)switch(y.nodeName){case "init_from":v.init_from=y.textContent}}u[h]=v;break;case "sampler2D":u=n.samplers;v={};t=0;for(w=r.childNodes.length;t<w;t++)if(y=r.childNodes[t],1===y.nodeType)switch(y.nodeName){case "source":v.source=y.textContent}u[h]=v}}break;case "technique":n={};h=0;for(p=l.childNodes.length;h<p;h++)if(m=l.childNodes[h],1===m.nodeType)switch(m.nodeName){case "constant":case "lambert":case "blinn":case "phong":n.type=m.nodeName;u={};r=0;
for(v=m.childNodes.length;r<v;r++)if(t=m.childNodes[r],1===t.nodeType)switch(t.nodeName){case "emission":case "diffuse":case "specular":case "shininess":case "transparency":u[t.nodeName]=ea(t);break;case "transparent":u[t.nodeName]={opaque:t.getAttribute("opaque"),data:ea(t)}}n.parameters=u}f.technique=n;break;case "extra":n={};h=0;for(p=l.childNodes.length;h<p;h++)if(m=l.childNodes[h],1===m.nodeType)switch(m.nodeName){case "technique":u={};r=0;for(v=m.childNodes.length;r<v;r++)if(t=m.childNodes[r],
1===t.nodeType)switch(t.nodeName){case "double_sided":u[t.nodeName]=parseInt(t.textContent)}n.technique=u}f.extra=n}}b.profile=f}}q.effects[a.getAttribute("id")]=b});F(A,"library_materials","material",function(a){for(var b={name:a.getAttribute("name")},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "instance_effect":b.url=x(d.getAttribute("url"))}}q.materials[a.getAttribute("id")]=b});F(A,"library_cameras","camera",function(a){for(var b={name:a.getAttribute("name")},
e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "optics":a:{for(var f=0;f<d.childNodes.length;f++){var g=d.childNodes[f];switch(g.nodeName){case "technique_common":d=g;f={};for(g=0;g<d.childNodes.length;g++){var k=d.childNodes[g];switch(k.nodeName){case "perspective":case "orthographic":f.technique=k.nodeName;for(var l={},n=0;n<k.childNodes.length;n++){var h=k.childNodes[n];switch(h.nodeName){case "xfov":case "yfov":case "xmag":case "ymag":case "znear":case "zfar":case "aspect_ratio":l[h.nodeName]=
parseFloat(h.textContent)}}f.parameters=l}}d=f;break a}}d={}}b.optics=d}}q.cameras[a.getAttribute("id")]=b});F(A,"library_lights","light",function(a){for(var b={},e=0,c=a.childNodes.length;e<c;e++){var d=a.childNodes[e];if(1===d.nodeType)switch(d.nodeName){case "technique_common":for(var b=d,d={},f=0,g=b.childNodes.length;f<g;f++){var k=b.childNodes[f];if(1===k.nodeType)switch(k.nodeName){case "directional":case "point":case "spot":case "ambient":d.technique=k.nodeName;for(var l={},n=0,h=k.childNodes.length;n<
h;n++){var p=k.childNodes[n];if(1===p.nodeType)switch(p.nodeName){case "color":p=t(p.textContent);l.color=(new THREE.Color).fromArray(p);break;case "falloff_angle":l.falloffAngle=parseFloat(p.textContent);break;case "quadratic_attenuation":p=parseFloat(p.textContent),l.distance=p?Math.sqrt(1/p):0}}d.parameters=l}}b=d}}q.lights[a.getAttribute("id")]=b});F(A,"library_geometries","geometry",function(a){var b={name:a.getAttribute("name"),sources:{},vertices:{},primitives:[]},e=E(a,"mesh")[0];if(void 0!==
e){for(var c=0;c<e.childNodes.length;c++){var d=e.childNodes[c];if(1===d.nodeType){var f=d.getAttribute("id");switch(d.nodeName){case "source":b.sources[f]=V(d);break;case "vertices":for(var f={},g=0;g<d.childNodes.length;g++){var k=d.childNodes[g];1===k.nodeType&&(f[k.getAttribute("semantic")]=x(k.getAttribute("source")))}b.vertices=f;break;case "polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",d.nodeName);break;case "lines":case "linestrips":case "polylist":case "triangles":b.primitives.push(ta(d));
break;default:console.log(d)}}}q.geometries[a.getAttribute("id")]=b}});F(A,"library_nodes","node",Y);F(A,"library_visual_scenes","visual_scene",function(a){for(var b={name:a.getAttribute("name"),children:[]},e=a.getElementsByTagName("node"),c=0;c<e.length;c++){var d=e[c];!1===d.hasAttribute("id")&&d.setAttribute("id","three_default_"+za++)}e=E(a,"node");for(c=0;c<e.length;c++)b.children.push(Y(e[c]));q.visualScenes[a.getAttribute("id")]=b});F(A,"library_kinematics_models","kinematics_model",function(a){for(var b=
{name:a.getAttribute("name")||"",joints:{},links:[]},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "technique_common":for(var d=b,f=0;f<c.childNodes.length;f++){var g=c.childNodes[f];if(1===g.nodeType)switch(g.nodeName){case "joint":for(var k=d.joints,l=g.getAttribute("sid"),n=void 0,h=0;h<g.childNodes.length;h++){var p=g.childNodes[h];if(1===p.nodeType)switch(p.nodeName){case "prismatic":case "revolute":for(var n=p,p=void 0,p={sid:n.getAttribute("sid"),
name:n.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:n.nodeName,static:!1,zeroPosition:0,middlePosition:0},m=0;m<n.childNodes.length;m++){var r=n.childNodes[m];if(1===r.nodeType)switch(r.nodeName){case "axis":var u=t(r.textContent);p.axis.fromArray(u);break;case "limits":u=r.getElementsByTagName("max")[0],r=r.getElementsByTagName("min")[0],p.limits.max=parseFloat(u.textContent),p.limits.min=parseFloat(r.textContent)}}p.limits.min>=p.limits.max&&(p.static=!0);p.middlePosition=
(p.limits.min+p.limits.max)/2;n=p}}k[l]=n;break;case "link":d.links.push(ka(g))}}}}q.kinematicsModels[a.getAttribute("id")]=b});F(A,"scene","instance_kinematics_scene",function(a){for(var b={bindJointAxis:[]},e=0;e<a.childNodes.length;e++){var c=a.childNodes[e];if(1===c.nodeType)switch(c.nodeName){case "bind_joint_axis":b.bindJointAxis.push(wa(c))}}q.kinematicsScenes[x(a.getAttribute("url"))]=b});console.timeEnd("THREE.ColladaLoader: Parse");console.time("THREE.ColladaLoader: Build");H(q.animations,
T);H(q.clips,ca);H(q.controllers,da);H(q.images,U);H(q.effects,fa);H(q.materials,ga);H(q.cameras,ia);H(q.lights,ja);H(q.geometries,W);H(q.visualScenes,Z);console.timeEnd("THREE.ColladaLoader: Build");(function(){var a=q.clips;if(0===Object.keys(a).length===!0){if(0===Object.keys(q.animations).length===!1){var a=[],b;for(b in q.animations)for(var e=z(q.animations[b],T),c=0,d=e.length;c<d;c++)a.push(e[c]);aa.push(new THREE.AnimationClip("default",-1,a))}}else for(b in a)aa.push(z(q.clips[b],ca))})();
(function(){function a(a,b){var c=b.getAttribute("name"),e=d.joints[a];f.traverse(function(d){if(d.name===c){for(var f=[],n=A.querySelector('[id\x3d"'+b.id+'"]'),k=0;k<n.childNodes.length;k++){var l=n.childNodes[k];if(1===l.nodeType)switch(l.nodeName){case "matrix":var q=t(l.textContent),x=(new THREE.Matrix4).fromArray(q).transpose();f.push({sid:l.getAttribute("sid"),type:l.nodeName,obj:x});break;case "translate":case "scale":q=t(l.textContent);x=(new THREE.Vector3).fromArray(q);f.push({sid:l.getAttribute("sid"),
type:l.nodeName,obj:x});break;case "rotate":q=t(l.textContent),x=(new THREE.Vector3).fromArray(q),q=THREE.Math.degToRad(q[3]),f.push({sid:l.getAttribute("sid"),type:l.nodeName,obj:x,angle:q})}}g[a]={object:d,transforms:f,joint:e,position:e.zeroPosition}}})}var b=Object.keys(q.kinematicsModels)[0],e=Object.keys(q.kinematicsScenes)[0],c=Object.keys(q.visualScenes)[0];if(void 0!==b&&void 0!==e){for(var d=z(q.kinematicsModels[b],ua),b=z(q.kinematicsScenes[e],xa),f=z(q.visualScenes[c],Z),c=b.bindJointAxis,
g={},b=0,e=c.length;b<e;b++){var k=c[b],l=A.querySelector('[sid\x3d"'+k.target+'"]');l&&a(k.jointIndex,l.parentElement)}var n=new THREE.Matrix4;pa={joints:d&&d.joints,getJointValue:function(a){var b=g[a];if(b)return b.position;console.warn("THREE.ColladaLoader: Joint "+a+" doesn't exist.")},setJointValue:function(a,b){var c=g[a];if(c){var d=c.joint;if(b>d.limits.max||b<d.limits.min)console.warn("THREE.ColladaLoader: Joint "+a+" value "+b+" outside of limits (min: "+d.limits.min+", max: "+d.limits.max+
").");else if(d.static)console.warn("THREE.ColladaLoader: Joint "+a+" is static.");else{var e=c.object,f=d.axis,c=c.transforms;C.identity();for(var l=0;l<c.length;l++){var k=c[l];if(k.sid&&-1!==k.sid.indexOf(a))switch(d.type){case "revolute":C.multiply(n.makeRotationAxis(f,THREE.Math.degToRad(b)));break;case "prismatic":C.multiply(n.makeTranslation(f.x*b,f.y*b,f.z*b));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+d.type)}else switch(k.type){case "matrix":C.multiply(k.obj);
break;case "translate":C.multiply(n.makeTranslation(k.obj.x,k.obj.y,k.obj.z));break;case "scale":C.scale(k.obj);break;case "rotate":C.multiply(n.makeRotationAxis(k.obj,k.angle))}}e.matrix.copy(C);e.matrix.decompose(e.position,e.quaternion,e.scale);g[a].position=b}}else console.log("THREE.ColladaLoader: "+a+" does not exist.")}}}})();var ba=function(a){a=E(a,"instance_visual_scene")[0];a=x(a.getAttribute("url"));return z(q.visualScenes[a],Z)}(E(A,"scene")[0]);"Z_UP"===O.upAxis&&ba.quaternion.setFromEuler(new THREE.Euler(-Math.PI/
2,0,0));ba.scale.multiplyScalar(O.unit);console.timeEnd("THREE.ColladaLoader");return{animations:aa,kinematics:pa,library:q,scene:ba}}};