THREE.GLTFLoader=function(){function G(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.dracoLoader=null}function T(){var a={};return{get:function(b){return a[b]},add:function(b,d){a[b]=d},remove:function(b){delete a[b]},removeAll:function(){a={}}}}function U(a){this.name=n.KHR_LIGHTS;this.lights={};a=(a.extensions&&a.extensions[n.KHR_LIGHTS]||{}).lights||{};for(var b in a){var d=a[b],e,c=(new THREE.Color).fromArray(d.color);switch(d.type){case "directional":e=new THREE.DirectionalLight(c);
e.position.set(0,0,1);break;case "point":e=new THREE.PointLight(c);break;case "spot":e=new THREE.SpotLight(c);e.position.set(0,0,1);break;case "ambient":e=new THREE.AmbientLight(c)}e&&(void 0!==d.constantAttenuation&&(e.intensity=d.constantAttenuation),void 0!==d.linearAttenuation&&(e.distance=1/d.linearAttenuation),void 0!==d.quadraticAttenuation&&(e.decay=d.quadraticAttenuation),void 0!==d.fallOffAngle&&(e.angle=d.fallOffAngle),void 0!==d.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),
e.name=d.name||"light_"+b,this.lights[b]=e)}}function E(a){this.name=n.KHR_MATERIALS_UNLIT}function V(a){this.name=n.KHR_BINARY_GLTF;this.body=this.content=null;var b=new DataView(a,0,z);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:b.getUint32(4,!0),length:b.getUint32(8,!0)};if(this.header.magic!==J)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(2>this.header.version)throw Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");
for(var b=new DataView(a,z),d=0;d<b.byteLength;){var e=b.getUint32(d,!0),d=d+4,c=b.getUint32(d,!0),d=d+4;c===K.JSON?(c=new Uint8Array(a,z+d,e),this.content=THREE.LoaderUtils.decodeText(c)):c===K.BIN&&(c=z+d,this.body=a.slice(c,c+e));d+=e}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.");}function L(a){if(!a)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION;this.dracoLoader=a}function W(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,
specularGlossinessParams:"color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap displacementMap displacementScale displacementBias specularMap specular glossinessMap glossiness alphaMap envMap envMapIntensity refractionRatio".split(" "),getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(a,b,d){b=b.extensions[this.name];var e=THREE.ShaderLib.standard,c=THREE.UniformsUtils.clone(e.uniforms),g=e.fragmentShader.replace("#include \x3cspecularmap_fragment\x3e",
"").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include \x3croughnessmap_pars_fragment\x3e","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include \x3cmetalnessmap_pars_fragment\x3e","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include \x3croughnessmap_fragment\x3e","vec3 specularFactor \x3d specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular \x3d texture2D( specularMap, vUv );\n\ttexelSpecular \x3d sRGBToLinear( texelSpecular );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *\x3d texelSpecular.rgb;\n#endif").replace("#include \x3cmetalnessmap_fragment\x3e",
"float glossinessFactor \x3d glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness \x3d texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *\x3d texelGlossiness.a;\n#endif").replace("#include \x3clights_physical_fragment\x3e","PhysicalMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb;\nmaterial.specularRoughness \x3d clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\nmaterial.specularColor \x3d specularFactor.rgb;");
delete c.roughness;delete c.metalness;delete c.roughnessMap;delete c.metalnessMap;c.specular={value:(new THREE.Color).setHex(1118481)};c.glossiness={value:.5};c.specularMap={value:null};c.glossinessMap={value:null};a.vertexShader=e.vertexShader;a.fragmentShader=g;a.uniforms=c;a.defines={STANDARD:""};a.color=new THREE.Color(1,1,1);a.opacity=1;e=[];Array.isArray(b.diffuseFactor)&&(c=b.diffuseFactor,a.color.fromArray(c),a.opacity=c[3]);void 0!==b.diffuseTexture&&e.push(d.assignTexture(a,"map",b.diffuseTexture.index));
a.emissive=new THREE.Color(0,0,0);a.glossiness=void 0!==b.glossinessFactor?b.glossinessFactor:1;a.specular=new THREE.Color(1,1,1);Array.isArray(b.specularFactor)&&a.specular.fromArray(b.specularFactor);void 0!==b.specularGlossinessTexture&&(b=b.specularGlossinessTexture.index,e.push(d.assignTexture(a,"glossinessMap",b)),e.push(d.assignTexture(a,"specularMap",b)));return Promise.all(e)},createMaterial:function(a){var b=new THREE.ShaderMaterial({defines:a.defines,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,
uniforms:a.uniforms,fog:!0,lights:!0,opacity:a.opacity,transparent:a.transparent});b.isGLTFSpecularGlossinessMaterial=!0;b.color=a.color;b.map=void 0===a.map?null:a.map;b.lightMap=null;b.lightMapIntensity=1;b.aoMap=void 0===a.aoMap?null:a.aoMap;b.aoMapIntensity=1;b.emissive=a.emissive;b.emissiveIntensity=1;b.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap;b.bumpMap=void 0===a.bumpMap?null:a.bumpMap;b.bumpScale=1;b.normalMap=void 0===a.normalMap?null:a.normalMap;a.normalScale&&(b.normalScale=
a.normalScale);b.displacementMap=null;b.displacementScale=1;b.displacementBias=0;b.specularMap=void 0===a.specularMap?null:a.specularMap;b.specular=a.specular;b.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap;b.glossiness=a.glossiness;b.alphaMap=null;b.envMap=void 0===a.envMap?null:a.envMap;b.envMapIntensity=1;b.refractionRatio=.98;b.extensions.derivatives=!0;return b},cloneMaterial:function(a){var b=a.clone();b.isGLTFSpecularGlossinessMaterial=!0;for(var d=this.specularGlossinessParams,
e=0,c=d.length;e<c;e++)b[d[e]]=a[d[e]];return b},refreshUniforms:function(a,b,d,e,c,g){if(!0===c.isGLTFSpecularGlossinessMaterial){a=c.uniforms;b=c.defines;a.opacity.value=c.opacity;a.diffuse.value.copy(c.color);a.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);a.map.value=c.map;a.specularMap.value=c.specularMap;a.alphaMap.value=c.alphaMap;a.lightMap.value=c.lightMap;a.lightMapIntensity.value=c.lightMapIntensity;a.aoMap.value=c.aoMap;a.aoMapIntensity.value=c.aoMapIntensity;var f;
c.map?f=c.map:c.specularMap?f=c.specularMap:c.displacementMap?f=c.displacementMap:c.normalMap?f=c.normalMap:c.bumpMap?f=c.bumpMap:c.glossinessMap?f=c.glossinessMap:c.alphaMap?f=c.alphaMap:c.emissiveMap&&(f=c.emissiveMap);void 0!==f&&(f.isWebGLRenderTarget&&(f=f.texture),void 0!==f.matrix?(!0===f.matrixAutoUpdate&&(d=f.offset,e=f.repeat,g=f.center,f.matrix.setUvTransform(d.x,d.y,e.x,e.y,f.rotation,g.x,g.y)),a.uvTransform.value.copy(f.matrix)):(d=f.offset,e=f.repeat,a.offsetRepeat.value.set(d.x,d.y,
e.x,e.y)));a.envMap.value=c.envMap;a.envMapIntensity.value=c.envMapIntensity;a.flipEnvMap.value=c.envMap&&c.envMap.isCubeTexture?-1:1;a.refractionRatio.value=c.refractionRatio;a.specular.value.copy(c.specular);a.glossiness.value=c.glossiness;a.glossinessMap.value=c.glossinessMap;a.emissiveMap.value=c.emissiveMap;a.bumpMap.value=c.bumpMap;a.normalMap.value=c.normalMap;a.displacementMap.value=c.displacementMap;a.displacementScale.value=c.displacementScale;a.displacementBias.value=c.displacementBias;
null!==a.glossinessMap.value&&void 0===b.USE_GLOSSINESSMAP&&(b.USE_GLOSSINESSMAP="",b.USE_ROUGHNESSMAP="");null===a.glossinessMap.value&&void 0!==b.USE_GLOSSINESSMAP&&(delete b.USE_GLOSSINESSMAP,delete b.USE_ROUGHNESSMAP)}}}}function C(a,b,d,e){THREE.Interpolant.call(this,a,b,d,e)}function M(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function X(a,b){if(a.indices!==b.indices)return!1;var d=a.attributes||{},e=b.attributes||
{},c=Object.keys(d),g=Object.keys(e);if(c.length!==g.length)return!1;for(var g=0,f=c.length;g<f;g++){var l=c[g];if(d[l]!==e[l])return!1}return!0}function Y(a,b){for(var d=0,e=a.length;d<e;d++){var c=a[d];if(X(c.primitive,b))return c.promise}return null}function I(a){if(a.isInterleavedBufferAttribute){for(var b=a.count,d=a.itemSize,e=a.array.slice(0,b*d),c=0;c<b;++c)e[c]=a.getX(c),2<=d&&(e[c+1]=a.getY(c)),3<=d&&(e[c+2]=a.getZ(c)),4<=d&&(e[c+3]=a.getW(c));return new THREE.BufferAttribute(e,d,a.normalized)}return a.clone()}
function q(a,b,d){this.json=a||{};this.extensions=b||{};this.options=d||{};this.cache=new T;this.primitiveCache=[];this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}function N(a,b,d){var e=b.attributes,c;for(c in e){var g=F[c],f=d[e[c]];g&&(g in a.attributes||a.addAttribute(g,f))}void 0===b.indices||a.index||a.setIndex(d[b.indices])}
G.prototype={constructor:G,crossOrigin:"Anonymous",load:function(a,b,d,e){var c=this,g=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(a),f=new THREE.FileLoader(c.manager);f.setResponseType("arraybuffer");f.load(a,function(a){try{c.parse(a,g,b,e)}catch(d){if(void 0!==e)e(d);else throw d;}},d,e)},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this},setDRACOLoader:function(a){this.dracoLoader=a;return this},parse:function(a,b,d,e){var c=
{};if("string"!==typeof a)if(THREE.LoaderUtils.decodeText(new Uint8Array(a,0,4))===J){try{c[n.KHR_BINARY_GLTF]=new V(a)}catch(g){e&&e(g);return}a=c[n.KHR_BINARY_GLTF].content}else a=THREE.LoaderUtils.decodeText(new Uint8Array(a));a=JSON.parse(a);void 0===a.asset||2>a.asset.version[0]?e&&e(Error("THREE.GLTFLoader: Unsupported asset. glTF versions \x3e\x3d2.0 are supported. Use LegacyGLTFLoader instead.")):(a.extensionsUsed&&(0<=a.extensionsUsed.indexOf(n.KHR_LIGHTS)&&(c[n.KHR_LIGHTS]=new U(a)),0<=
a.extensionsUsed.indexOf(n.KHR_MATERIALS_UNLIT)&&(c[n.KHR_MATERIALS_UNLIT]=new E(a)),0<=a.extensionsUsed.indexOf(n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)&&(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new W),0<=a.extensionsUsed.indexOf(n.KHR_DRACO_MESH_COMPRESSION)&&(c[n.KHR_DRACO_MESH_COMPRESSION]=new L(this.dracoLoader))),console.time("GLTFLoader"),(new q(a,c,{path:b||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager})).parse(function(a,c,b,e,r){console.timeEnd("GLTFLoader");d({scene:a,
scenes:c,cameras:b,animations:e,asset:r})},e))}};var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit"};E.prototype.getMaterialType=function(a){return THREE.MeshBasicMaterial};E.prototype.extendParams=function(a,b,d){var e=[];a.color=new THREE.Color(1,1,1);a.opacity=1;if(b=b.pbrMetallicRoughness){if(Array.isArray(b.baseColorFactor)){var c=
b.baseColorFactor;a.color.fromArray(c);a.opacity=c[3]}void 0!==b.baseColorTexture&&e.push(d.assignTexture(a,"map",b.baseColorTexture.index))}return Promise.all(e)};var J="glTF",z=12,K={JSON:1313821514,BIN:5130562};L.prototype.decodePrimitive=function(a,b){var d=this.dracoLoader,e=a.extensions[this.name].bufferView,c=a.extensions[this.name].attributes,g={},f;for(f in c)f in F&&(g[F[f]]=c[f]);return b.getDependency("bufferView",e).then(function(a){return new Promise(function(c){d.decodeDracoFile(a,
c,g)})})};C.prototype=Object.create(THREE.Interpolant.prototype);C.prototype.constructor=C;C.prototype.interpolate_=function(a,b,d,e){var c=this.resultBuffer,g=this.sampleValues,f=this.valueSize,l=2*f,h=3*f;e-=b;var r=(d-b)/e;b=r*r;d=b*r;a*=h;var h=a-h,m=2*d-3*b+1,r=d-2*b+r,k=-2*d+3*b;b=d-b;for(d=0;d!==f;d++)c[d]=m*g[h+d+f]+r*g[h+d+l]*e+k*g[a+d+f]+b*g[a+d]*e;return c};var O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},P={9728:THREE.NearestFilter,
9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},Q={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},R={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},Z={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},
S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},aa={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};q.prototype.parse=
function(a,b){var d=this.json;this.cache.removeAll();this.markDefs();this.getMultiDependencies(["scene","animation","camera"]).then(function(b){var c=b.scenes||[];a(c[d.scene||0],c,b.cameras||[],b.animations||[],d.asset)}).catch(b)};q.prototype.markDefs=function(){for(var a=this.json.nodes||[],b=this.json.skins||[],d=this.json.meshes||[],e={},c={},g=0,f=b.length;g<f;g++)for(var l=b[g].joints,h=0,r=l.length;h<r;h++)a[l[h]].isBone=!0;b=0;for(g=a.length;b<g;b++)f=a[b],void 0!==f.mesh&&(void 0===e[f.mesh]&&
(e[f.mesh]=c[f.mesh]=0),e[f.mesh]++,void 0!==f.skin&&(d[f.mesh].isSkinnedMesh=!0));this.json.meshReferences=e;this.json.meshUses=c};q.prototype.getDependency=function(a,b){var d=a+":"+b,e=this.cache.get(d);e||(e=this["load"+a.charAt(0).toUpperCase()+a.slice(1)](b),this.cache.add(d,e));return e};q.prototype.getDependencies=function(a){var b=this.cache.get(a);if(!b){var d=this,b=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(b,c){return d.getDependency(a,c)}));this.cache.add(a,b)}return b};
q.prototype.getMultiDependencies=function(a){for(var b={},d=[],e=0,c=a.length;e<c;e++){var g=a[e],f=this.getDependencies(g),f=f.then(function(a,c){b[a]=c}.bind(this,g+("mesh"===g?"es":"s")));d.push(f)}return Promise.all(d).then(function(){return b})};q.prototype.loadBuffer=function(a){var b=this.json.buffers[a],d=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===a)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);
var e=this.options;return new Promise(function(a,g){d.load(M(b.uri,e.path),a,void 0,function(){g(Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})})};q.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var e=b.byteOffset||0;return a.slice(e,e+(b.byteLength||0))})};q.prototype.loadAccessor=function(a){var b=this,d=this.json,e=this.json.accessors[a];if(void 0===e.bufferView&&void 0===e.sparse)return null;
a=[];void 0!==e.bufferView?a.push(this.getDependency("bufferView",e.bufferView)):a.push(null);void 0!==e.sparse&&(a.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",e.sparse.values.bufferView)));return Promise.all(a).then(function(a){var g=a[0],f=S[e.type],l=O[e.componentType],h=l.BYTES_PER_ELEMENT,r=e.byteOffset||0,m=d.bufferViews[e.bufferView].byteStride,k=!0===e.normalized,p;if(m&&m!==h*f){var n="InterleavedBuffer:"+e.bufferView+":"+e.componentType;
p=b.cache.get(n);p||(p=new l(g),p=new THREE.InterleavedBuffer(p,m/h),b.cache.add(n,p));h=new THREE.InterleavedBufferAttribute(p,f,r/h,k)}else p=null===g?new l(e.count*f):new l(g,r,e.count*f),h=new THREE.BufferAttribute(p,f,k);if(void 0!==e.sparse)for(m=e.sparse.values.byteOffset||0,r=new O[e.sparse.indices.componentType](a[1],e.sparse.indices.byteOffset||0,e.sparse.count*S.SCALAR),a=new l(a[2],m,e.sparse.count*f),null!==g&&h.setArray(h.array.slice()),g=0,l=r.length;g<l;g++)if(m=r[g],h.setX(m,a[g*
f]),2<=f&&h.setY(m,a[g*f+1]),3<=f&&h.setZ(m,a[g*f+2]),4<=f&&h.setW(m,a[g*f+3]),5<=f)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.");return h})};q.prototype.loadTexture=function(a){var b=this.json,d=this.options,e=this.textureLoader,c=window.URL||window.webkitURL,g=b.textures[a],f=b.images[g.source],l=f.uri,h=!1;void 0!==f.bufferView&&(l=this.getDependency("bufferView",f.bufferView).then(function(a){h=!0;a=new Blob([a],{type:f.mimeType});return l=c.createObjectURL(a)}));
return Promise.resolve(l).then(function(a){var b=THREE.Loader.Handlers.get(a)||e;return new Promise(function(c,e){b.load(M(a,d.path),c,void 0,e)})}).then(function(a){!0===h&&c.revokeObjectURL(l);a.flipY=!1;void 0!==g.name&&(a.name=g.name);a.format=void 0!==g.format?R[g.format]:THREE.RGBAFormat;void 0!==g.internalFormat&&a.format!==R[g.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format.");
a.type=void 0!==g.type?Z[g.type]:THREE.UnsignedByteType;var d=(b.samplers||{})[g.sampler]||{};a.magFilter=P[d.magFilter]||THREE.LinearFilter;a.minFilter=P[d.minFilter]||THREE.LinearMipMapLinearFilter;a.wrapS=Q[d.wrapS]||THREE.RepeatWrapping;a.wrapT=Q[d.wrapT]||THREE.RepeatWrapping;return a})};q.prototype.assignTexture=function(a,b,d){return this.getDependency("texture",d).then(function(d){a[b]=d})};q.prototype.loadMaterial=function(a){var b=this.extensions,d=this.json.materials[a],e,c={},g=d.extensions||
{};a=[];if(g[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS])g=b[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],e=g.getMaterialType(d),a.push(g.extendParams(c,d,this));else if(g[n.KHR_MATERIALS_UNLIT])g=b[n.KHR_MATERIALS_UNLIT],e=g.getMaterialType(d),a.push(g.extendParams(c,d,this));else if(void 0!==d.pbrMetallicRoughness){e=THREE.MeshStandardMaterial;g=d.pbrMetallicRoughness;c.color=new THREE.Color(1,1,1);c.opacity=1;if(Array.isArray(g.baseColorFactor)){var f=g.baseColorFactor;c.color.fromArray(f);c.opacity=
f[3]}void 0!==g.baseColorTexture&&a.push(this.assignTexture(c,"map",g.baseColorTexture.index));c.metalness=void 0!==g.metallicFactor?g.metallicFactor:1;c.roughness=void 0!==g.roughnessFactor?g.roughnessFactor:1;void 0!==g.metallicRoughnessTexture&&(g=g.metallicRoughnessTexture.index,a.push(this.assignTexture(c,"metalnessMap",g)),a.push(this.assignTexture(c,"roughnessMap",g)))}else e=THREE.MeshPhongMaterial;!0===d.doubleSided&&(c.side=THREE.DoubleSide);g=d.alphaMode||"OPAQUE";"BLEND"===g?c.transparent=
!0:(c.transparent=!1,"MASK"===g&&(c.alphaTest=void 0!==d.alphaCutoff?d.alphaCutoff:.5));void 0!==d.normalTexture&&e!==THREE.MeshBasicMaterial&&(a.push(this.assignTexture(c,"normalMap",d.normalTexture.index)),c.normalScale=new THREE.Vector2(1,1),void 0!==d.normalTexture.scale&&c.normalScale.set(d.normalTexture.scale,d.normalTexture.scale));void 0!==d.occlusionTexture&&e!==THREE.MeshBasicMaterial&&(a.push(this.assignTexture(c,"aoMap",d.occlusionTexture.index)),void 0!==d.occlusionTexture.strength&&
(c.aoMapIntensity=d.occlusionTexture.strength));void 0!==d.emissiveFactor&&e!==THREE.MeshBasicMaterial&&(c.emissive=(new THREE.Color).fromArray(d.emissiveFactor));void 0!==d.emissiveTexture&&e!==THREE.MeshBasicMaterial&&a.push(this.assignTexture(c,"emissiveMap",d.emissiveTexture.index));return Promise.all(a).then(function(){var a;a=e===THREE.ShaderMaterial?b[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new e(c);void 0!==d.name&&(a.name=d.name);a.normalScale&&(a.normalScale.x=-a.normalScale.x);
a.map&&(a.map.encoding=THREE.sRGBEncoding);a.emissiveMap&&(a.emissiveMap.encoding=THREE.sRGBEncoding);d.extras&&(a.userData=d.extras);return a})};q.prototype.loadGeometries=function(a){var b=this,d=this.extensions,e=this.primitiveCache;return this.getDependencies("accessor").then(function(c){for(var g=[],f=[],l=0,h=a.length;l<h;l++){var r=a[l],m=Y(e,r);m?f.push(m.then(function(a){g.push(a)})):r.extensions&&r.extensions[n.KHR_DRACO_MESH_COMPRESSION]?(m=d[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,
b).then(function(a){N(a,r,c);g.push(a);return a}),e.push({primitive:r,promise:m}),f.push(m)):(m=new THREE.BufferGeometry,N(m,r,c),e.push({primitive:r,promise:Promise.resolve(m)}),g.push(m))}return Promise.all(f).then(function(){return g})})};q.prototype.loadMesh=function(a){var b=this,d=this.extensions,e=this.json.meshes[a];return this.getMultiDependencies(["accessor","material"]).then(function(c){var g=new THREE.Group,f=e.primitives;return b.loadGeometries(f).then(function(l){for(var h=0,r=f.length;h<
r;h++){var m=f[h],k=l[h],p=void 0===m.material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):c.materials[m.material];p.aoMap&&void 0===k.attributes.uv2&&void 0!==k.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),k.addAttribute("uv2",new THREE.BufferAttribute(k.attributes.uv.array,2)));var v=void 0!==k.attributes.color,t=void 0===k.attributes.normal,q=!0===e.isSkinnedMesh,w=void 0!==
m.targets;if(v||t||q||w)p=p.isGLTFSpecularGlossinessMaterial?d[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(p):p.clone();v&&(p.vertexColors=THREE.VertexColors,p.needsUpdate=!0);t&&(p.flatShading=!0);if(4===m.mode||5===m.mode||6===m.mode||void 0===m.mode)q?(k=new THREE.SkinnedMesh(k,p),p.skinning=!0):k=new THREE.Mesh(k,p),5===m.mode?k.drawMode=THREE.TriangleStripDrawMode:6===m.mode&&(k.drawMode=THREE.TriangleFanDrawMode);else if(1===m.mode||3===m.mode||2===m.mode)v="LineBasicMaterial:"+p.uuid,
t=b.cache.get(v),t||(t=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(t,p),t.color.copy(p.color),t.lights=!1,b.cache.add(v,t)),p=t,k=1===m.mode?new THREE.LineSegments(k,p):3===m.mode?new THREE.Line(k,p):new THREE.LineLoop(k,p);else if(0===m.mode)v="PointsMaterial:"+p.uuid,t=b.cache.get(v),t||(t=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(t,p),t.color.copy(p.color),t.map=p.map,t.lights=!1,b.cache.add(v,t)),p=t,k=new THREE.Points(k,p);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+
m.mode);k.name=e.name||"mesh_"+a;if(w){var w=k,v=e,t=c.accessors,q=w.geometry,y=w.material,C=m.targets,z=q.morphAttributes;z.position=[];z.normal=[];y.morphTargets=!0;for(var x=0,H=C.length;x<H;x++){var D=C[x],G="morphTarget"+x,A,B;if(void 0!==D.POSITION){A=I(t[D.POSITION]);for(var E=q.attributes.position,u=0,F=A.count;u<F;u++)A.setXYZ(u,A.getX(u)+E.getX(u),A.getY(u)+E.getY(u),A.getZ(u)+E.getZ(u))}else q.attributes.position&&(A=I(q.attributes.position));void 0!==A&&(A.name=G,z.position.push(A));if(void 0!==
D.NORMAL)for(y.morphNormals=!0,B=I(t[D.NORMAL]),D=q.attributes.normal,u=0,F=B.count;u<F;u++)B.setXYZ(u,B.getX(u)+D.getX(u),B.getY(u)+D.getY(u),B.getZ(u)+D.getZ(u));else void 0!==q.attributes.normal&&(B=I(q.attributes.normal));void 0!==B&&(B.name=G,z.normal.push(B))}w.updateMorphTargets();if(void 0!==v.weights)for(x=0,H=v.weights.length;x<H;x++)w.morphTargetInfluences[x]=v.weights[x];if(v.extras&&Array.isArray(v.extras.targetNames))for(x=0,H=v.extras.targetNames.length;x<H;x++)w.morphTargetDictionary[v.extras.targetNames[x]]=
x}void 0!==e.extras&&(k.userData=e.extras);void 0!==m.extras&&(k.geometry.userData=m.extras);!0===p.isGLTFSpecularGlossinessMaterial&&(k.onBeforeRender=d[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms);if(1<f.length)k.name+="_"+h,g.add(k);else return k}return g})})};q.prototype.loadCamera=function(a){var b;a=this.json.cameras[a];var d=a[a.type];if(d)return"perspective"===a.type?(b=d.aspectRatio||1,b=new THREE.PerspectiveCamera(THREE.Math.radToDeg(d.yfov*b),b,d.znear||1,d.zfar||2E6)):"orthographic"===
a.type&&(b=new THREE.OrthographicCamera(d.xmag/-2,d.xmag/2,d.ymag/2,d.ymag/-2,d.znear,d.zfar)),void 0!==a.name&&(b.name=a.name),a.extras&&(b.userData=a.extras),Promise.resolve(b);console.warn("THREE.GLTFLoader: Missing camera parameters.")};q.prototype.loadSkin=function(a){a=this.json.skins[a];var b={joints:a.joints};return void 0===a.inverseBindMatrices?Promise.resolve(b):this.getDependency("accessor",a.inverseBindMatrices).then(function(a){b.inverseBindMatrices=a;return b})};q.prototype.loadAnimation=
function(a){var b=this.json.animations[a];return this.getMultiDependencies(["accessor","node"]).then(function(d){for(var e=[],c=0,g=b.channels.length;c<g;c++){var f=b.channels[c],l=b.samplers[f.sampler];if(l){var f=f.target,h=void 0!==f.node?f.node:f.id,r=d.accessors[void 0!==b.parameters?b.parameters[l.input]:l.input],m=d.accessors[void 0!==b.parameters?b.parameters[l.output]:l.output],k=d.nodes[h];if(k){k.updateMatrix();k.matrixAutoUpdate=!0;switch(y[f.path]){case y.weights:h=THREE.NumberKeyframeTrack;
break;case y.rotation:h=THREE.QuaternionKeyframeTrack;break;default:h=THREE.VectorKeyframeTrack}var p=k.name?k.name:k.uuid,n=void 0!==l.interpolation?aa[l.interpolation]:THREE.InterpolateLinear,t=[];y[f.path]===y.weights?k.traverse(function(a){!0===a.isMesh&&!0===a.material.morphTargets&&t.push(a.name?a.name:a.uuid)}):t.push(p);k=0;for(p=t.length;k<p;k++){var q=new h(t[k]+"."+y[f.path],THREE.AnimationUtils.arraySlice(r.array,0),THREE.AnimationUtils.arraySlice(m.array,0),n);"CUBICSPLINE"===l.interpolation&&
(q.createInterpolant=function(a){return new C(this.times,this.values,this.getValueSize()/3,a)},q.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0);e.push(q)}}}}h=void 0!==b.name?b.name:"animation_"+a;return new THREE.AnimationClip(h,void 0,e)})};q.prototype.loadNode=function(a){var b=this.extensions,d=this.json.meshReferences,e=this.json.meshUses,c=this.json.nodes[a];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(a){if(!0===c.isBone)a=new THREE.Bone;else if(void 0!==
c.mesh){var f=a.meshes[c.mesh];a=f.clone();if(!0===f.isGroup)for(var l=0,h=f.children.length;l<h;l++){var r=f.children[l];r.material&&!0===r.material.isGLTFSpecularGlossinessMaterial&&(a.children[l].onBeforeRender=r.onBeforeRender)}else f.material&&!0===f.material.isGLTFSpecularGlossinessMaterial&&(a.onBeforeRender=f.onBeforeRender);1<d[c.mesh]&&(a.name+="_instance_"+e[c.mesh]++)}else a=void 0!==c.camera?a.cameras[c.camera]:c.extensions&&c.extensions[n.KHR_LIGHTS]&&void 0!==c.extensions[n.KHR_LIGHTS].light?
b[n.KHR_LIGHTS].lights[c.extensions[n.KHR_LIGHTS].light]:new THREE.Object3D;void 0!==c.name&&(a.name=THREE.PropertyBinding.sanitizeNodeName(c.name));c.extras&&(a.userData=c.extras);void 0!==c.matrix?(f=new THREE.Matrix4,f.fromArray(c.matrix),a.applyMatrix(f)):(void 0!==c.translation&&a.position.fromArray(c.translation),void 0!==c.rotation&&a.quaternion.fromArray(c.rotation),void 0!==c.scale&&a.scale.fromArray(c.scale));return a})};q.prototype.loadScene=function(){function a(b,d,e,c,g){var f=c[b],
l=e.nodes[b];if(void 0!==l.skin){var h=!0===f.isGroup?f.children:[f];b=0;for(var n=h.length;b<n;b++){for(var m=h[b],k=g[l.skin],p=[],q=[],t=0,z=k.joints.length;t<z;t++){var w=k.joints[t],y=c[w];y?(p.push(y),w=new THREE.Matrix4,void 0!==k.inverseBindMatrices&&w.fromArray(k.inverseBindMatrices.array,16*t),q.push(w)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',w)}m.bind(new THREE.Skeleton(p,q),m.matrixWorld)}}d.add(f);if(l.children)for(d=l.children,b=0,n=d.length;b<n;b++)a(d[b],f,
e,c,g)}return function(b){var d=this.json,e=this.extensions,c=this.json.scenes[b];return this.getMultiDependencies(["node","skin"]).then(function(b){var f=new THREE.Scene;void 0!==c.name&&(f.name=c.name);c.extras&&(f.userData=c.extras);for(var l=c.nodes||[],h=0,q=l.length;h<q;h++)a(l[h],f,d,b.nodes,b.skins);c.extensions&&c.extensions[n.KHR_LIGHTS]&&void 0!==c.extensions[n.KHR_LIGHTS].light&&f.add(e[n.KHR_LIGHTS].lights[c.extensions[n.KHR_LIGHTS].light]);return f})}}();return G}();