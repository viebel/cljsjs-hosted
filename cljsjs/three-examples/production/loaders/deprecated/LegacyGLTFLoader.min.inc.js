THREE.LegacyGLTFLoader=function(){function x(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}function N(){var a={};return{get:function(d){return a[d]},add:function(d,f){a[d]=f},remove:function(d){delete a[d]},removeAll:function(){a={}},update:function(d,f){for(var c in a){var e=a[c];e.update&&e.update(d,f)}}}}function G(a,d){var f={},c=a.material.uniforms,e;for(e in c){var b=c[e];if(b.semantic){var g=b.node,h=a;g&&(h=d[g]);f[e]={semantic:b.semantic,sourceNode:h,targetNode:a,uniform:b}}}this.boundUniforms=
f;this._m4=new THREE.Matrix4}function O(a){this.name=t.KHR_MATERIALS_COMMON;this.lights={};a=(a.extensions&&a.extensions[t.KHR_MATERIALS_COMMON]||{}).lights||{};for(var d in a){var f=a[d],c,e=f[f.type],e=(new THREE.Color).fromArray(e.color);switch(f.type){case "directional":c=new THREE.DirectionalLight(e);c.position.set(0,0,1);break;case "point":c=new THREE.PointLight(e);break;case "spot":c=new THREE.SpotLight(e);c.position.set(0,0,1);break;case "ambient":c=new THREE.AmbientLight(e)}c&&(this.lights[d]=
c)}}function H(a){this.name=t.KHR_BINARY_GLTF;var d=new DataView(a,0,B),d={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:d.getUint32(4,!0),length:d.getUint32(8,!0),contentLength:d.getUint32(12,!0),contentFormat:d.getUint32(16,!0)},f;for(f in C){var c=C[f];if(d[f]!==c)throw Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',f,c);}f=new Uint8Array(a,B,d.contentLength);this.header=d;this.content=THREE.LoaderUtils.decodeText(f);this.body=a.slice(B+d.contentLength,
d.length)}function p(a,d,f){if(!a)return Promise.resolve();var c,e=[];if("[object Array]"===Object.prototype.toString.call(a)){c=[];for(var b=a.length,g=0;g<b;g++){var h=d.call(f||this,a[g],g);h&&(e.push(h),h instanceof Promise?h.then(function(b,a){c[b]=a}.bind(this,g)):c[g]=h)}}else for(b in c={},a)a.hasOwnProperty(b)&&(h=d.call(f||this,a[b],b))&&(e.push(h),h instanceof Promise?h.then(function(b,a){c[b]=a}.bind(this,b)):c[b]=h);return Promise.all(e).then(function(){return c})}function D(a,d){return"string"!==
typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)?a:(d||"")+a}function P(a,d){var f={},c;for(c in d.attributes){var e=d.attributes[c],b=d.parameters[e],g=b.semantic;f[c]={type:b.type,semantic:g}}var b=d.parameters,h=d.attributes,l={};for(c in f)e=h[c],f=b[e],(g=f.semantic)&&(l[c]=f);for(e in l)switch(b=l[e],g=b.semantic,c=new RegExp("\\b"+e+"\\b","g"),g){case "POSITION":a=a.replace(c,"position");break;case "NORMAL":a=a.replace(c,"normal");break;case "TEXCOORD_0":case "TEXCOORD0":case "TEXCOORD":a=
a.replace(c,"uv");break;case "TEXCOORD_1":a=a.replace(c,"uv2");break;case "COLOR_0":case "COLOR0":case "COLOR":a=a.replace(c,"color");break;case "WEIGHT":a=a.replace(c,"skinWeight");break;case "JOINT":a=a.replace(c,"skinIndex")}return a}function I(a){this.isDeferredShaderMaterial=!0;this.params=a}function q(a,d,f){this.json=a||{};this.extensions=d||{};this.options=f||{};this.cache=new N}x.prototype={constructor:x,crossOrigin:"Anonymous",load:function(a,d,f,c){var e=this,b=this.path&&"string"===typeof this.path?
this.path:THREE.LoaderUtils.extractUrlBase(a),g=new THREE.FileLoader(e.manager);g.setResponseType("arraybuffer");g.load(a,function(c){e.parse(c,b,d)},f,c)},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a},parse:function(a,d,f){var c={};THREE.LoaderUtils.decodeText(new Uint8Array(a,0,4))===C.magic?(c[t.KHR_BINARY_GLTF]=new H(a),a=c[t.KHR_BINARY_GLTF].content):a=THREE.LoaderUtils.decodeText(new Uint8Array(a));a=JSON.parse(a);a.extensionsUsed&&0<=a.extensionsUsed.indexOf(t.KHR_MATERIALS_COMMON)&&
(c[t.KHR_MATERIALS_COMMON]=new O(a));console.time("LegacyGLTFLoader");(new q(a,c,{path:d||this.path,crossOrigin:this.crossOrigin})).parse(function(c,b,a,d){console.timeEnd("LegacyGLTFLoader");f({scene:c,scenes:b,cameras:a,animations:d})})}};x.Shaders={update:function(){console.warn("THREE.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}};G.prototype.update=function(a,d){var f=this.boundUniforms,c;for(c in f){var e=f[c];switch(e.semantic){case "MODELVIEW":var b=e.uniform.value;
b.multiplyMatrices(d.matrixWorldInverse,e.sourceNode.matrixWorld);break;case "MODELVIEWINVERSETRANSPOSE":b=e.uniform.value;this._m4.multiplyMatrices(d.matrixWorldInverse,e.sourceNode.matrixWorld);b.getNormalMatrix(this._m4);break;case "PROJECTION":b=e.uniform.value;b.copy(d.projectionMatrix);break;case "JOINTMATRIX":for(var b=e.uniform.value,g=0;g<b.length;g++)b[g].getInverse(e.sourceNode.matrixWorld).multiply(e.targetNode.skeleton.bones[g].matrixWorld).multiply(e.targetNode.skeleton.boneInverses[g]).multiply(e.targetNode.bindMatrix);
break;default:console.warn("Unhandled shader semantic: "+e.semantic)}}};x.Animations={update:function(){console.warn("THREE.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.")}};var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"},C={magic:"glTF",version:1,contentFormat:0},B=20;H.prototype.loadShader=function(a,d){var f=new Uint8Array(d[a.extensions[t.KHR_BINARY_GLTF].bufferView]);return THREE.LoaderUtils.decodeText(f)};var v={FLOAT:5126,
FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},E={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},Q={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},J={9728:THREE.NearestFilter,9729:THREE.LinearFilter,
9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},K={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},L={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},R={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},
S={1028:THREE.BackSide,1029:THREE.FrontSide},T={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},M={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},y={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,
773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},U={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F={scale:"scale",translation:"position",rotation:"quaternion"},V={LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},W={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};I.prototype.create=function(){var a=THREE.UniformsUtils.clone(this.params.uniforms),
d;for(d in this.params.uniforms){var f=this.params.uniforms[d];f.value instanceof THREE.Texture&&(a[d].value=f.value,a[d].value.needsUpdate=!0);a[d].semantic=f.semantic;a[d].node=f.node}this.params.uniforms=a;return new THREE.RawShaderMaterial(this.params)};q.prototype._withDependencies=function(a){for(var d={},f=0;f<a.length;f++){var c=a[f],e="load"+c.charAt(0).toUpperCase()+c.slice(1),b=this.cache.get(c);void 0!==b?d[c]=b:this[e]&&(e=this[e](),this.cache.add(c,e),d[c]=e)}return p(d,function(c){return c})};
q.prototype.parse=function(a){var d=this.json;this.cache.removeAll();this._withDependencies(["scenes","cameras","animations"]).then(function(f){var c=[],e;for(e in f.scenes)c.push(f.scenes[e]);var b=void 0!==d.scene?f.scenes[d.scene]:c[0],g=[];for(e in f.cameras)g.push(f.cameras[e]);var h=[];for(e in f.animations)h.push(f.animations[e]);a(b,c,g,h)})};q.prototype.loadShaders=function(){var a=this.json,d=this.extensions,f=this.options;return this._withDependencies(["bufferViews"]).then(function(c){return p(a.shaders,
function(a){return a.extensions&&a.extensions[t.KHR_BINARY_GLTF]?d[t.KHR_BINARY_GLTF].loadShader(a,c.bufferViews):new Promise(function(c){var d=new THREE.FileLoader;d.setResponseType("text");d.load(D(a.uri,f.path),function(a){c(a)})})})})};q.prototype.loadBuffers=function(){var a=this.extensions,d=this.options;return p(this.json.buffers,function(f,c){if("binary_glTF"===c)return a[t.KHR_BINARY_GLTF].body;if("arraybuffer"===f.type||void 0===f.type)return new Promise(function(c){var a=new THREE.FileLoader;
a.setResponseType("arraybuffer");a.load(D(f.uri,d.path),function(a){c(a)})});console.warn("THREE.LegacyGLTFLoader: "+f.type+" buffer type is not supported")})};q.prototype.loadBufferViews=function(){var a=this.json;return this._withDependencies(["buffers"]).then(function(d){return p(a.bufferViews,function(a){return d.buffers[a.buffer].slice(a.byteOffset,a.byteOffset+(void 0!==a.byteLength?a.byteLength:0))})})};q.prototype.loadAccessors=function(){var a=this.json;return this._withDependencies(["bufferViews"]).then(function(d){return p(a.accessors,
function(a){var c=d.bufferViews[a.bufferView],e=U[a.type],b=Q[a.componentType],g=b.BYTES_PER_ELEMENT;if(a.byteStride&&a.byteStride!==g*e)return c=new b(c),c=new THREE.InterleavedBuffer(c,a.byteStride/g),new THREE.InterleavedBufferAttribute(c,e,a.byteOffset/g);c=new b(c,a.byteOffset,a.count*e);return new THREE.BufferAttribute(c,e)})})};q.prototype.loadTextures=function(){var a=this.json,d=this.options;return this._withDependencies(["bufferViews"]).then(function(f){return p(a.textures,function(c){if(c.source)return new Promise(function(e){var b=
a.images[c.source],g=b.uri,h=!1;b.extensions&&b.extensions[t.KHR_BINARY_GLTF]&&(b=b.extensions[t.KHR_BINARY_GLTF],b=new Blob([f.bufferViews[b.bufferView]],{type:b.mimeType}),g=URL.createObjectURL(b),h=!0);b=THREE.Loader.Handlers.get(g);null===b&&(b=new THREE.TextureLoader);b.setCrossOrigin(d.crossOrigin);b.load(D(g,d.path),function(b){h&&URL.revokeObjectURL(g);b.flipY=!1;void 0!==c.name&&(b.name=c.name);b.format=void 0!==c.format?L[c.format]:THREE.RGBAFormat;void 0!==c.internalFormat&&b.format!==
L[c.internalFormat]&&console.warn("THREE.LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format.");b.type=void 0!==c.type?R[c.type]:THREE.UnsignedByteType;if(c.sampler){var d=a.samplers[c.sampler];b.magFilter=J[d.magFilter]||THREE.LinearFilter;b.minFilter=J[d.minFilter]||THREE.NearestMipMapLinearFilter;b.wrapS=K[d.wrapS]||THREE.RepeatWrapping;b.wrapT=K[d.wrapT]||THREE.RepeatWrapping}e(b)},
void 0,function(){h&&URL.revokeObjectURL(g);e()})})})})};q.prototype.loadMaterials=function(){var a=this.json;return this._withDependencies(["shaders","textures"]).then(function(d){return p(a.materials,function(f){var c,e={},b={},g;f.extensions&&f.extensions[t.KHR_MATERIALS_COMMON]&&(g=f.extensions[t.KHR_MATERIALS_COMMON]);if(g){var h=["ambient","emission","transparent","transparency","doubleSided"];switch(g.technique){case "BLINN":case "PHONG":c=THREE.MeshPhongMaterial;h.push("diffuse","specular",
"shininess");break;case "LAMBERT":c=THREE.MeshLambertMaterial;h.push("diffuse");break;default:c=THREE.MeshBasicMaterial}h.forEach(function(a){void 0!==g.values[a]&&(e[a]=g.values[a])});if(g.doubleSided||e.doubleSided)b.side=THREE.DoubleSide;if(g.transparent||e.transparent)b.transparent=!0,b.opacity=void 0!==e.transparency?e.transparency:1}else if(void 0===f.technique)c=THREE.MeshPhongMaterial,Object.assign(e,f.values);else{c=I;h=a.techniques[f.technique];b.uniforms={};var l=a.programs[h.program];
if(l){b.fragmentShader=d.shaders[l.fragmentShader];b.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",l.fragmentShader),c=THREE.MeshPhongMaterial);var k=d.shaders[l.vertexShader];k||(console.warn("ERROR: Missing vertex shader definition:",l.vertexShader),c=THREE.MeshPhongMaterial);b.vertexShader=P(k,h);var l=h.uniforms,m;for(m in l){var q=l[m],k=h.parameters[q],n=k.type;if(E[n]){var p=k.count,r;void 0!==f.values&&(r=f.values[q]);var u=new E[n],X=k.semantic,w=k.node;switch(n){case v.FLOAT:u=
k.value;"transparency"==q&&(b.transparent=!0);void 0!==r&&(u=r);break;case v.FLOAT_VEC2:case v.FLOAT_VEC3:case v.FLOAT_VEC4:case v.FLOAT_MAT3:k&&k.value&&u.fromArray(k.value);r&&u.fromArray(r);break;case v.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case v.FLOAT_MAT4:if(p)for(u=Array(p),q=0;q<p;q++)u[q]=new E[n];k&&k.value&&u.fromArray(k.value);r&&u.fromArray(r);break;case v.SAMPLER_2D:u=void 0!==r?d.textures[r]:void 0!==k.value?d.textures[k.value]:null}b.uniforms[m]=
{value:u,semantic:X,node:w}}else throw Error("Unknown shader uniform param type: "+n);}m=h.states||{};h=m.enable||[];m=m.functions||{};k=l=r=!1;n=0;for(p=h.length;n<p;n++)switch(u=h[n],W[u]){case "CULL_FACE":r=!0;break;case "DEPTH_TEST":l=!0;break;case "BLEND":k=!0;break;case "SCISSOR_TEST":case "POLYGON_OFFSET_FILL":case "SAMPLE_ALPHA_TO_COVERAGE":break;default:throw Error("Unknown technique.states.enable: "+u);}b.side=r?void 0!==m.cullFace?S[m.cullFace]:THREE.FrontSide:THREE.DoubleSide;b.depthTest=
l;b.depthFunc=void 0!==m.depthFunc?T[m.depthFunc]:THREE.LessDepth;b.depthWrite=void 0!==m.depthMask?m.depthMask[0]:!0;b.blending=k?THREE.CustomBlending:THREE.NoBlending;b.transparent=k;h=m.blendEquationSeparate;void 0!==h?(b.blendEquation=M[h[0]],b.blendEquationAlpha=M[h[1]]):(b.blendEquation=THREE.AddEquation,b.blendEquationAlpha=THREE.AddEquation);h=m.blendFuncSeparate;void 0!==h?(b.blendSrc=y[h[0]],b.blendDst=y[h[1]],b.blendSrcAlpha=y[h[2]],b.blendDstAlpha=y[h[3]]):(b.blendSrc=THREE.OneFactor,
b.blendDst=THREE.ZeroFactor,b.blendSrcAlpha=THREE.OneFactor,b.blendDstAlpha=THREE.ZeroFactor)}}Array.isArray(e.diffuse)?b.color=(new THREE.Color).fromArray(e.diffuse):"string"===typeof e.diffuse&&(b.map=d.textures[e.diffuse]);delete b.diffuse;"string"===typeof e.reflective&&(b.envMap=d.textures[e.reflective]);"string"===typeof e.bump&&(b.bumpMap=d.textures[e.bump]);Array.isArray(e.emission)?c===THREE.MeshBasicMaterial?b.color=(new THREE.Color).fromArray(e.emission):b.emissive=(new THREE.Color).fromArray(e.emission):
"string"===typeof e.emission&&(c===THREE.MeshBasicMaterial?b.map=d.textures[e.emission]:b.emissiveMap=d.textures[e.emission]);Array.isArray(e.specular)?b.specular=(new THREE.Color).fromArray(e.specular):"string"===typeof e.specular&&(b.specularMap=d.textures[e.specular]);void 0!==e.shininess&&(b.shininess=e.shininess);c=new c(b);void 0!==f.name&&(c.name=f.name);return c})})};q.prototype.loadMeshes=function(){var a=this.json;return this._withDependencies(["accessors","materials"]).then(function(d){return p(a.meshes,
function(f){var c=new THREE.Group;void 0!==f.name&&(c.name=f.name);f.extras&&(c.userData=f.extras);f=f.primitives||[];for(var e in f){var b=f[e];if(b.mode===v.TRIANGLES||void 0===b.mode){var g=new THREE.BufferGeometry,h=b.attributes,l;for(l in h){var k=h[l];if(!k)return;k=d.accessors[k];switch(l){case "POSITION":g.addAttribute("position",k);break;case "NORMAL":g.addAttribute("normal",k);break;case "TEXCOORD_0":case "TEXCOORD0":case "TEXCOORD":g.addAttribute("uv",k);break;case "TEXCOORD_1":g.addAttribute("uv2",
k);break;case "COLOR_0":case "COLOR0":case "COLOR":g.addAttribute("color",k);break;case "WEIGHT":g.addAttribute("skinWeight",k);break;case "JOINT":g.addAttribute("skinIndex",k);break;default:if(b.material){var m=a.materials[b.material];if(m.technique){var m=a.techniques[m.technique].parameters||{},q;for(q in m)m[q].semantic===l&&g.addAttribute(q,k)}}}}b.indices&&g.setIndex(d.accessors[b.indices]);m=void 0!==d.materials?d.materials[b.material]:new THREE.MeshPhongMaterial({color:0,emissive:8947848,
specular:0,shininess:0,transparent:!1,depthTest:!0,side:THREE.FrontSide});g=new THREE.Mesh(g,m);g.castShadow=!0;g.name="0"===e?c.name:c.name+e;b.extras&&(g.userData=b.extras);c.add(g)}else if(b.mode===v.LINES){g=new THREE.BufferGeometry;h=b.attributes;for(l in h){k=h[l];if(!k)return;k=d.accessors[k];switch(l){case "POSITION":g.addAttribute("position",k);break;case "COLOR_0":case "COLOR0":case "COLOR":g.addAttribute("color",k)}}m=d.materials[b.material];b.indices?(g.setIndex(d.accessors[b.indices]),
g=new THREE.LineSegments(g,m)):g=new THREE.Line(g,m);g.name="0"===e?c.name:c.name+e;b.extras&&(g.userData=b.extras);c.add(g)}else console.warn("Only triangular and line primitives are supported")}return c})})};q.prototype.loadCameras=function(){return p(this.json.cameras,function(a){if("perspective"==a.type&&a.perspective){var d=void 0!==a.perspective.aspectRatio?a.perspective.aspectRatio:1,d=new THREE.PerspectiveCamera(THREE.Math.radToDeg(a.perspective.yfov*d),d,a.perspective.znear||1,a.perspective.zfar||
2E6);void 0!==a.name&&(d.name=a.name);a.extras&&(d.userData=a.extras);return d}if("orthographic"==a.type&&a.orthographic)return d=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,a.orthographic.znear,a.orthographic.zfar),void 0!==a.name&&(d.name=a.name),a.extras&&(d.userData=a.extras),d})};q.prototype.loadSkins=function(){var a=this.json;return this._withDependencies(["accessors"]).then(function(d){return p(a.skins,function(a){var c=
new THREE.Matrix4;void 0!==a.bindShapeMatrix&&c.fromArray(a.bindShapeMatrix);return{bindShapeMatrix:c,jointNames:a.jointNames,inverseBindMatrices:d.accessors[a.inverseBindMatrices]}})})};q.prototype.loadAnimations=function(){var a=this.json;return this._withDependencies(["accessors","nodes"]).then(function(d){return p(a.animations,function(a,c){var e=[],b;for(b in a.channels){var g=a.channels[b],h=a.samplers[g.sampler];if(h){var g=g.target,l=g.id,k=d.accessors[void 0!==a.parameters?a.parameters[h.input]:
h.input],m=d.accessors[void 0!==a.parameters?a.parameters[h.output]:h.output];if(l=d.nodes[l])l.updateMatrix(),l.matrixAutoUpdate=!0,h=void 0!==h.interpolation?V[h.interpolation]:THREE.InterpolateLinear,e.push(new (F[g.path]===F.rotation?THREE.QuaternionKeyframeTrack:THREE.VectorKeyframeTrack)((l.name?l.name:l.uuid)+"."+F[g.path],THREE.AnimationUtils.arraySlice(k.array,0),THREE.AnimationUtils.arraySlice(m.array,0),h))}}l=void 0!==a.name?a.name:"animation_"+c;return new THREE.AnimationClip(l,void 0,
e)})})};q.prototype.loadNodes=function(){var a=this.json,d=this.extensions,f=this;return p(a.nodes,function(a){var d=new THREE.Matrix4,b;a.jointName?(b=new THREE.Bone,b.name=void 0!==a.name?a.name:a.jointName,b.jointName=a.jointName):(b=new THREE.Object3D,void 0!==a.name&&(b.name=a.name));a.extras&&(b.userData=a.extras);void 0!==a.matrix?(d.fromArray(a.matrix),b.applyMatrix(d)):(void 0!==a.translation&&b.position.fromArray(a.translation),void 0!==a.rotation&&b.quaternion.fromArray(a.rotation),void 0!==
a.scale&&b.scale.fromArray(a.scale));return b}).then(function(c){return f._withDependencies(["meshes","skins","cameras"]).then(function(e){return p(c,function(b,f){var h=a.nodes[f];if(void 0!==h.meshes)for(var l in h.meshes){var k=h.meshes[l],m=e.meshes[k];if(void 0===m)console.warn("LegacyGLTFLoader: Couldn't find node \""+k+'".');else for(var q in m.children){var n=m.children[q],p=n.material,r=n.geometry,u=n.userData,v=n.name,w;p.isDeferredShaderMaterial?p=w=p.create():w=p;switch(n.type){case "LineSegments":n=
new THREE.LineSegments(r,w);break;case "LineLoop":n=new THREE.LineLoop(r,w);break;case "Line":n=new THREE.Line(r,w);break;default:n=new THREE.Mesh(r,w)}n.castShadow=!0;n.userData=u;n.name=v;var z;h.skin&&(z=e.skins[h.skin]);if(z){k=function(a){for(var b=Object.keys(c),d=0,e=b.length;d<e;d++){var f=c[b[d]];if(f.jointName===a)return f}return null};n=r;w=p;w.skinning=!0;n=new THREE.SkinnedMesh(n,w);n.castShadow=!0;n.userData=u;n.name=v;p=[];u=[];v=0;for(r=z.jointNames.length;v<r;v++){var A=z.jointNames[v],
x=k(A);x?(p.push(x),A=z.inverseBindMatrices.array,A=(new THREE.Matrix4).fromArray(A,16*v),u.push(A)):console.warn("WARNING: joint: '"+A+"' could not be found")}n.bind(new THREE.Skeleton(p,u),z.bindShapeMatrix);var y=function(b,d,e){b=b[e];if(void 0!==b){e=0;for(var f=b.length;e<f;e++){var g=b[e],h=c[g],g=a.nodes[g];void 0!==h&&!0===h.isBone&&void 0!==g&&(d.add(h),y(g,h,"children"))}}};y(h,n,"skeletons")}b.add(n)}}void 0!==h.camera&&b.add(e.cameras[h.camera]);h.extensions&&h.extensions[t.KHR_MATERIALS_COMMON]&&
h.extensions[t.KHR_MATERIALS_COMMON].light&&b.add(d[t.KHR_MATERIALS_COMMON].lights[h.extensions[t.KHR_MATERIALS_COMMON].light]);return b})})})};q.prototype.loadScenes=function(){function a(f,c,e){var b=e[f];c.add(b);f=d.nodes[f];if(f.children){f=f.children;c=0;for(var g=f.length;c<g;c++)a(f[c],b,e)}}var d=this.json;return this._withDependencies(["nodes"]).then(function(f){return p(d.scenes,function(c){var d=new THREE.Scene;void 0!==c.name&&(d.name=c.name);c.extras&&(d.userData=c.extras);c=c.nodes||
[];for(var b=0,g=c.length;b<g;b++)a(c[b],d,f.nodes);d.traverse(function(a){a.material&&a.material.isRawShaderMaterial&&(a.gltfShader=new G(a,f.nodes),a.onBeforeRender=function(a,b,c){this.gltfShader.update(b,c)})});return d})})};return x}();