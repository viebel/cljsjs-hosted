(function(){function U(a){var b=new Map;"Connections"in a&&a.Connections.connections.forEach(function(a){var d=a[0],e=a[1];a=a[2];b.has(d)||b.set(d,{parents:[],children:[]});var f={ID:e,relationship:a};b.get(d).parents.push(f);b.has(e)||b.set(e,{parents:[],children:[]});d={ID:d,relationship:a};b.get(e).children.push(d)});return b}function V(a,b,c,d,e){var f={};b.BumpFactor&&(f.bumpScale=b.BumpFactor.value);b.Diffuse?f.color=(new THREE.Color).fromArray(b.Diffuse.value):b.DiffuseColor&&"Color"===b.DiffuseColor.type&&
(f.color=(new THREE.Color).fromArray(b.DiffuseColor.value));b.DisplacementFactor&&(f.displacementScale=b.DisplacementFactor.value);b.ReflectionFactor&&(f.reflectivity=b.ReflectionFactor.value);b.Specular?f.specular=(new THREE.Color).fromArray(b.Specular.value):b.SpecularColor&&"Color"===b.SpecularColor.type&&(f.emissive=(new THREE.Color).fromArray(b.SpecularColor.value));b.Shininess&&(f.shininess=b.Shininess.value);b.Emissive?f.emissive=(new THREE.Color).fromArray(b.Emissive.value):b.EmissiveColor&&
"Color"===b.EmissiveColor.type&&(f.emissive=(new THREE.Color).fromArray(b.EmissiveColor.value));b.EmissiveFactor&&(f.emissiveIntensity=parseFloat(b.EmissiveFactor.value));b.Opacity&&(f.opacity=parseFloat(b.Opacity.value));1>f.opacity&&(f.transparent=!0);e.get(d).children.forEach(function(b){var d=b.relationship;switch(d){case "Bump":f.bumpMap=c.get(b.ID);break;case "DiffuseColor":f.map=v(a,c,b.ID,e);break;case "DisplacementColor":f.displacementMap=v(a,c,b.ID,e);break;case "EmissiveColor":f.emissiveMap=
v(a,c,b.ID,e);break;case "NormalMap":f.normalMap=v(a,c,b.ID,e);break;case "ReflectionColor":f.envMap=v(a,c,b.ID,e);f.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case "SpecularColor":f.specularMap=v(a,c,b.ID,e);break;case "TransparentColor":f.alphaMap=v(a,c,b.ID,e);f.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",d)}});return f}function v(a,b,c,d){"LayeredTexture"in a.Objects&&c in a.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),
c=d.get(c).children[0].ID);return b.get(c)}function W(a,b){var c=[];a.children.forEach(function(a){var e=b[a.ID];"Cluster"===e.attrType&&(a={ID:a.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(e.Transform.a),transformLink:(new THREE.Matrix4).fromArray(e.TransformLink.a),linkMode:e.Mode},"Indexes"in e&&(a.indices=e.Indexes.a,a.weights=e.Weights.a),c.push(a))});return{rawBones:c,bones:[]}}function X(a,b,c,d){var e=b.parents.map(function(b){return a.Objects.Model[b.ID]});if(0!==e.length){var f=
b.children.reduce(function(a,b){void 0!==d[b.ID]&&(a=d[b.ID]);return a},null),g=new THREE.Matrix4,e=e[0];if("GeometricRotation"in e){var h=e.GeometricRotation.value.map(THREE.Math.degToRad);h[3]="ZYX";g.makeRotationFromEuler((new THREE.Euler).fromArray(h))}"GeometricTranslation"in e&&g.setPosition((new THREE.Vector3).fromArray(e.GeometricTranslation.value));"GeometricScaling"in e&&g.scale((new THREE.Vector3).fromArray(e.GeometricScaling.value));return Y(a,b,c,f,g)}}function Y(a,b,c,d,e){var f=c.Vertices.a,
g=c.PolygonVertexIndex.a,h=[],m=[],k=[],l=[],n=[],q=[],r=[];if(c.LayerElementColor)var J=Z(c.LayerElementColor[0]);if(c.LayerElementMaterial)var w=aa(c.LayerElementMaterial[0]);if(c.LayerElementNormal)var x=ba(c.LayerElementNormal[0]);if(c.LayerElementUV){var K=[];for(a=0;c.LayerElementUV[a];)K.push(ca(c.LayerElementUV[a])),a++}var v={};null!==d&&d.rawBones.forEach(function(a,b){a.indices.forEach(function(c,d){void 0===v[c]&&(v[c]=[]);v[c].push({id:b,weight:a.weights[d]})})});var A=0,F=0,H=!1,B=[],
C=[],D=[],E=[],y=[],z=[];g.forEach(function(a,b){var c=!1;0>a&&(a^=-1,g[b]=a,c=!0);var e=[],t=[];B.push(3*a,3*a+1,3*a+2);if(J){var u=L[J.mappingType][J.referenceType](b,A,a,J);D.push(u[0],u[1],u[2])}if(d){void 0!==v[a]&&v[a].forEach(function(a){t.push(a.weight);e.push(a.id)});if(4<t.length){H||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),H=!0);var G=[0,0,0,0],I=[0,0,0,0];t.forEach(function(a,b){var c=a,d=e[b];I.forEach(function(a,
b,e){c>a&&(e[b]=c,c=a,a=G[b],G[b]=d,d=a)})});e=G;t=I}for(;4>t.length;)t.push(0),e.push(0);for(var p=0;4>p;++p)y.push(t[p]),z.push(e[p])}x&&(u=L[x.mappingType][x.referenceType](b,A,a,x),C.push(u[0],u[1],u[2]));if(w&&"AllSame"!==w.mappingType)var M=L[w.mappingType][w.referenceType](b,A,a,w)[0];K&&K.forEach(function(c,d){var e=L[c.mappingType][c.referenceType](b,A,a,c);void 0===E[d]&&(E[d]=[]);E[d].push(e[0]);E[d].push(e[1])});F++;if(c){for(p=2;p<F;p++)h.push(f[B[0]]),h.push(f[B[1]]),h.push(f[B[2]]),
h.push(f[B[3*(p-1)]]),h.push(f[B[3*(p-1)+1]]),h.push(f[B[3*(p-1)+2]]),h.push(f[B[3*p]]),h.push(f[B[3*p+1]]),h.push(f[B[3*p+2]]),d&&(q.push(y[0]),q.push(y[1]),q.push(y[2]),q.push(y[3]),q.push(y[4*(p-1)]),q.push(y[4*(p-1)+1]),q.push(y[4*(p-1)+2]),q.push(y[4*(p-1)+3]),q.push(y[4*p]),q.push(y[4*p+1]),q.push(y[4*p+2]),q.push(y[4*p+3]),r.push(z[0]),r.push(z[1]),r.push(z[2]),r.push(z[3]),r.push(z[4*(p-1)]),r.push(z[4*(p-1)+1]),r.push(z[4*(p-1)+2]),r.push(z[4*(p-1)+3]),r.push(z[4*p]),r.push(z[4*p+1]),r.push(z[4*
p+2]),r.push(z[4*p+3])),J&&(k.push(D[0]),k.push(D[1]),k.push(D[2]),k.push(D[3*(p-1)]),k.push(D[3*(p-1)+1]),k.push(D[3*(p-1)+2]),k.push(D[3*p]),k.push(D[3*p+1]),k.push(D[3*p+2])),w&&"AllSame"!==w.mappingType&&(n.push(M),n.push(M),n.push(M)),x&&(m.push(C[0]),m.push(C[1]),m.push(C[2]),m.push(C[3*(p-1)]),m.push(C[3*(p-1)+1]),m.push(C[3*(p-1)+2]),m.push(C[3*p]),m.push(C[3*p+1]),m.push(C[3*p+2])),K&&K.forEach(function(a,b){void 0===l[b]&&(l[b]=[]);l[b].push(E[b][0]);l[b].push(E[b][1]);l[b].push(E[b][2*
(p-1)]);l[b].push(E[b][2*(p-1)+1]);l[b].push(E[b][2*p]);l[b].push(E[b][2*p+1])});A++;F=0;B=[];C=[];D=[];E=[];y=[];z=[]}});var t=new THREE.BufferGeometry;t.name=c.name;c=new THREE.Float32BufferAttribute(h,3);e.applyToBufferAttribute(c);t.addAttribute("position",c);0<k.length&&t.addAttribute("color",new THREE.Float32BufferAttribute(k,3));d&&(t.addAttribute("skinIndex",new THREE.Float32BufferAttribute(r,4)),t.addAttribute("skinWeight",new THREE.Float32BufferAttribute(q,4)),t.FBX_Deformer=d);0<m.length&&
(c=new THREE.Float32BufferAttribute(m,3),(new THREE.Matrix3).getNormalMatrix(e).applyToBufferAttribute(c),t.addAttribute("normal",c));l.forEach(function(a,b){var c="uv"+(b+1).toString();0===b&&(c="uv");t.addAttribute(c,new THREE.Float32BufferAttribute(l[b],2))});if(w&&"AllSame"!==w.mappingType){var G=n[0],u=0;n.forEach(function(a,b){a!==G&&(t.addGroup(u,b-u,G),G=a,u=b)});0<t.groups.length&&(e=t.groups[t.groups.length-1],e=e.start+e.count,e!==n.length&&t.addGroup(e,n.length-e,G));0===t.groups.length&&
t.addGroup(0,n.length,n[0])}return t}function ba(a){var b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.Normals.a,e=[];"IndexToDirect"===c&&("NormalIndex"in a?e=a.NormalIndex.a:"NormalsIndex"in a&&(e=a.NormalsIndex.a));return{dataSize:3,buffer:d,indices:e,mappingType:b,referenceType:c}}function ca(a){var b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.UV.a,e=[];"IndexToDirect"===c&&(e=a.UVIndex.a);return{dataSize:2,buffer:d,indices:e,mappingType:b,referenceType:c}}function Z(a){var b=
a.MappingInformationType,c=a.ReferenceInformationType,d=a.Colors.a,e=[];"IndexToDirect"===c&&(e=a.ColorIndex.a);return{dataSize:4,buffer:d,indices:e,mappingType:b,referenceType:c}}function aa(a){var b=a.MappingInformationType,c=a.ReferenceInformationType;if("NoMappingInformation"===b)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:c};a=a.Materials.a;for(var d=[],e=0;e<a.length;++e)d.push(e);return{dataSize:1,buffer:a,indices:d,mappingType:b,referenceType:c}}function da(a){if(void 0===
THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var b=parseInt(a.Order);if(isNaN(b))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",a.Order,a.id),new THREE.BufferGeometry;for(var b=b-1,c=a.KnotVector.a,d=[],e=a.Points.a,f=0,g=e.length;f<g;f+=4)d.push((new THREE.Vector4).fromArray(e,f));var h,m;if("Closed"===a.Form)d.push(d[0]);
else if("Periodic"===a.Form)for(h=b,m=c.length-1-h,f=0;f<b;++f)d.push(d[f]);a=(new THREE.NURBSCurve(b,c,d,h,m)).getPoints(7*d.length);var k=new Float32Array(3*a.length);a.forEach(function(a,b){a.toArray(k,3*b)});a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(k,3));return a}function ea(a,b,c,d,e){var f=new THREE.Group,g=fa(a,c,d,e,b),h=a.Objects.Model;g.forEach(function(c){ga(a,c,h[c.ID],b,f);b.get(c.ID).parents.forEach(function(a){a=g.get(a.ID);void 0!==a&&a.add(c)});
null===c.parent&&f.add(c)});ha(a,c,d,g,b);ia(a,b,f);ja(a,f);return f}function fa(a,b,c,d,e){var f=new Map,g=a.Objects.Model,h;for(h in g){var m=parseInt(h),k=g[h],l=e.get(m),n=ka(l,b,m,k.attrName);if(!n){switch(k.attrType){case "Camera":n=la(a,l);break;case "Light":n=ma(a,l);break;case "Mesh":n=na(a,l,c,d);break;case "NurbsCurve":n=oa(l,c);break;default:n=new THREE.Group}n.name=THREE.PropertyBinding.sanitizeNodeName(k.attrName);n.ID=m}l=n;if("RotationOrder"in k){var q="XYZ XZY YZX ZXY YXZ ZYX SphericXYZ".split(" "),
r=parseInt(k.RotationOrder.value,10);0<r&&6>r?console.warn("THREE.FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",q[r]):6===r&&console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}"Lcl_Translation"in k&&l.position.fromArray(k.Lcl_Translation.value);"Lcl_Rotation"in k&&(q=k.Lcl_Rotation.value.map(THREE.Math.degToRad),q.push("ZYX"),l.quaternion.setFromEuler((new THREE.Euler).fromArray(q)));
"Lcl_Scaling"in k&&l.scale.fromArray(k.Lcl_Scaling.value);"PreRotation"in k&&(k=k.PreRotation.value.map(THREE.Math.degToRad),k[3]="ZYX",k=(new THREE.Euler).fromArray(k),k=(new THREE.Quaternion).setFromEuler(k),l.quaternion.premultiply(k));f.set(m,n)}return f}function ka(a,b,c,d){var e=null;a.parents.forEach(function(a){for(var g in b){var h=b[g];h.rawBones.forEach(function(b,g){if(b.ID===a.ID){var l=e;e=new THREE.Bone;e.matrixWorld.copy(b.transformLink);e.name=THREE.PropertyBinding.sanitizeNodeName(d);
e.ID=c;h.bones[g]=e;null!==l&&e.add(l)}})}});return e}function la(a,b){var c,d;b.children.forEach(function(b){b=a.Objects.NodeAttribute[b.ID];void 0!==b&&(d=b)});if(void 0===d)c=new THREE.Object3D;else{c=0;void 0!==d.CameraProjectionType&&1===d.CameraProjectionType.value&&(c=1);var e=1;void 0!==d.NearPlane&&(e=d.NearPlane.value/1E3);var f=1E3;void 0!==d.FarPlane&&(f=d.FarPlane.value/1E3);var g=window.innerWidth,h=window.innerHeight;void 0!==d.AspectWidth&&void 0!==d.AspectHeight&&(g=d.AspectWidth.value,
h=d.AspectHeight.value);var m=g/h,k=45;void 0!==d.FieldOfView&&(k=d.FieldOfView.value);var l=d.FocalLength?d.FocalLength.value:null;switch(c){case 0:c=new THREE.PerspectiveCamera(k,m,e,f);null!==l&&c.setFocalLength(l);break;case 1:c=new THREE.OrthographicCamera(-g/2,g/2,h/2,-h/2,e,f);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+c+"."),c=new THREE.Object3D}}return c}function ma(a,b){var c,d;b.children.forEach(function(b){b=a.Objects.NodeAttribute[b.ID];void 0!==b&&(d=b)});if(void 0===
d)c=new THREE.Object3D;else{var e;e=void 0===d.LightType?0:d.LightType.value;c=16777215;void 0!==d.Color&&(c=(new THREE.Color).fromArray(d.Color.value));var f=void 0===d.Intensity?1:d.Intensity.value/100;void 0!==d.CastLightOnObject&&0===d.CastLightOnObject.value&&(f=0);var g=0;void 0!==d.FarAttenuationEnd&&(g=void 0!==d.EnableFarAttenuation&&0===d.EnableFarAttenuation.value?0:d.FarAttenuationEnd.value);switch(e){case 0:c=new THREE.PointLight(c,f,g,1);break;case 1:c=new THREE.DirectionalLight(c,f);
break;case 2:e=Math.PI/3;void 0!==d.InnerAngle&&(e=THREE.Math.degToRad(d.InnerAngle.value));var h=0;void 0!==d.OuterAngle&&(h=THREE.Math.degToRad(d.OuterAngle.value),h=Math.max(h,1));c=new THREE.SpotLight(c,f,g,e,h,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+d.LightType.value+", defaulting to a THREE.PointLight."),c=new THREE.PointLight(c,f)}void 0!==d.CastShadows&&1===d.CastShadows.value&&(c.castShadow=!0)}return c}function na(a,b,c,d){var e=null;a=null;var f=[];b.children.forEach(function(a){c.has(a.ID)&&
(e=c.get(a.ID));d.has(a.ID)&&f.push(d.get(a.ID))});1<f.length?a=f:0<f.length?a=f[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),f.push(a));"color"in e.attributes&&f.forEach(function(a){a.vertexColors=THREE.VertexColors});e.FBX_Deformer?(f.forEach(function(a){a.skinning=!0}),b=new THREE.SkinnedMesh(e,a)):b=new THREE.Mesh(e,a);return b}function oa(a,b){var c=a.children.reduce(function(a,c){b.has(c.ID)&&(a=b.get(c.ID));return a},null),d=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(c,
d)}function ja(a,b){if("GlobalSettings"in a&&"AmbientColor"in a.GlobalSettings){var c=a.GlobalSettings.AmbientColor.value,d=c[0],e=c[1],c=c[2];if(0!==d||0!==e||0!==c)d=new THREE.Color(d,e,c),b.add(new THREE.AmbientLight(d,1))}}function ga(a,b,c,d,e){"LookAtProperty"in c&&d.get(b.ID).children.forEach(function(c){"LookAtProperty"===c.relationship&&(c=a.Objects.Model[c.ID],"Lcl_Translation"in c&&(c=c.Lcl_Translation.value,void 0!==b.target?(b.target.position.fromArray(c),e.add(b.target)):b.lookAt((new THREE.Vector3).fromArray(c))))})}
function ha(a,b,c,d,e){var f=pa(a),g;for(g in b){var h=b[g];e.get(parseInt(h.ID)).parents.forEach(function(a){c.has(a.ID)&&e.get(a.ID).parents.forEach(function(a){d.has(a.ID)&&d.get(a.ID).bind(new THREE.Skeleton(h.bones),f[a.ID])})})}}function pa(a){var b={};if("Pose"in a.Objects){a=a.Objects.Pose;for(var c in a)if("BindPose"===a[c].attrType){var d=a[c].PoseNode;Array.isArray(d)?d.forEach(function(a){b[a.Node]=(new THREE.Matrix4).fromArray(a.Matrix.a)}):b[d.Node]=(new THREE.Matrix4).fromArray(d.Matrix.a)}}return b}
function qa(a,b,c){var d=a.Objects.AnimationLayer,e=new Map,f;for(f in d){var g=[],d=b.get(parseInt(f));void 0!==d&&(d.children.forEach(function(d,e){if(c.has(d.ID)){var f=c.get(d.ID);if(void 0!==f.curves.x||void 0!==f.curves.y||void 0!==f.curves.z){if(void 0===g[e]){var l;b.get(d.ID).parents.forEach(function(a){void 0!==a.relationship&&(l=a.ID)});var n=a.Objects.Model[l.toString()],q={modelName:THREE.PropertyBinding.sanitizeNodeName(n.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,
1,1]};"Lcl_Translation"in n&&(q.initialPosition=n.Lcl_Translation.value);"Lcl_Rotation"in n&&(q.initialRotation=n.Lcl_Rotation.value);"Lcl_Scaling"in n&&(q.initialScale=n.Lcl_Scaling.value);"PreRotation"in n&&(q.preRotations=n.PreRotation.value);g[e]=q}g[e][f.attr]=f}}}),e.set(parseInt(f),g))}return e}function ia(a,b,c){c.animations=[];if(void 0===a.Objects.AnimationCurve)b=void 0;else{var d=a.Objects.AnimationCurveNode,e=new Map,f;for(f in d){var g=d[f];null!==g.attrName.match(/S|R|T/)&&(g={id:g.id,
attr:g.attrName,curves:{}},e.set(g.id,g))}var d=a.Objects.AnimationCurve,h;for(h in d){f={id:d[h].id,times:d[h].KeyTime.a.map(ra),values:d[h].KeyValueFloat.a};var m=b.get(f.id);if(void 0!==m){var g=m.parents[0].ID,m=m.parents[0].relationship,k="";if(m.match(/X/))k="x";else if(m.match(/Y/))k="y";else if(m.match(/Z/))k="z";else continue;e.get(g).curves[k]=f}}e=qa(a,b,e);a=a.Objects.AnimationStack;h={};for(var l in a)d=b.get(parseInt(l)).children,1<d.length&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers."),
d=e.get(d[0].ID),h[l]={name:a[l].attrName,layer:d};b=h}if(void 0!==b)for(var n in b)l=sa(b[n]),c.animations.push(l)}function sa(a){var b=[];a.layer.forEach(function(a){b=b.concat(ta(a))});return new THREE.AnimationClip(a.name,-1,b)}function ta(a){var b=[];if(void 0!==a.T&&0<Object.keys(a.T.curves).length){var c=N(a.modelName,a.T.curves,a.initialPosition,"position");void 0!==c&&b.push(c)}if(void 0!==a.R&&0<Object.keys(a.R.curves).length){var c=a.modelName,d=a.R.curves,e=a.initialRotation,f=a.preRotations;
void 0!==d.x&&(d.x.values=d.x.values.map(THREE.Math.degToRad));void 0!==d.y&&(d.y.values=d.y.values.map(THREE.Math.degToRad));void 0!==d.z&&(d.z.values=d.z.values.map(THREE.Math.degToRad));var g=O(d),d=P(g,d,e);void 0!==f&&(f=f.map(THREE.Math.degToRad),f.push("ZYX"),f=(new THREE.Euler).fromArray(f),f=(new THREE.Quaternion).setFromEuler(f));for(var e=new THREE.Quaternion,h=new THREE.Euler,m=[],k=0;k<d.length;k+=3)h.set(d[k],d[k+1],d[k+2],"ZYX"),e.setFromEuler(h),void 0!==f&&e.premultiply(f),e.toArray(m,
k/3*4);c=new THREE.QuaternionKeyframeTrack(c+".quaternion",g,m);void 0!==c&&b.push(c)}void 0!==a.S&&0<Object.keys(a.S.curves).length&&(a=N(a.modelName,a.S.curves,a.initialScale,"scale"),void 0!==a&&b.push(a));return b}function N(a,b,c,d){var e=O(b);b=P(e,b,c);return new THREE.VectorKeyframeTrack(a+"."+d,e,b)}function P(a,b,c){var d=[],e=-1,f=-1,g=-1;a.forEach(function(a){b.x&&(e=b.x.times.indexOf(a));b.y&&(f=b.y.times.indexOf(a));b.z&&(g=b.z.times.indexOf(a));-1!==e?(a=b.x.values[e],d.push(a),c[0]=
a):d.push(c[0]);-1!==f?(a=b.y.values[f],d.push(a),c[1]=a):d.push(c[1]);-1!==g?(a=b.z.values[g],d.push(a),c[2]=a):d.push(c[2])});return d}function O(a){var b=[];void 0!==a.x&&(b=b.concat(a.x.times));void 0!==a.y&&(b=b.concat(a.y.times));void 0!==a.z&&(b=b.concat(a.z.times));return b=b.sort(function(a,b){return a-b}).filter(function(a,b,e){return e.indexOf(a)==b})}function Q(){}function R(){}function H(a,b){this.dv=new DataView(a);this.offset=0;this.littleEndian=void 0!==b?b:!0}function u(){}function S(a){if(a=
a.match(/FBXVersion: (\d+)/))return parseInt(a[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.");}function ra(a){return a/46186158E3}function I(a){return a.split(",").map(function(a){return parseFloat(a)})}function T(a,b,c){void 0===b&&(b=0);void 0===c&&(c=a.byteLength);return THREE.LoaderUtils.decodeText(new Uint8Array(a,b,c))}function ua(a,b){for(var c=0,d=a.length,e=b.length;c<e;c++,d++)a[d]=b[c]}function A(a,b,c,d){for(var e=0;c<d;c++,e++)a[e]=b[c];return a}
THREE.FBXLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.FBXLoader.prototype,{load:function(a,b,c,d){var e=this,f=THREE.LoaderUtils.extractUrlBase(a),g=new THREE.FileLoader(this.manager);g.setResponseType("arraybuffer");g.load(a,function(c){try{var g=e.parse(c,f);b(g)}catch(k){window.setTimeout(function(){d&&d(k);e.manager.itemError(a)},0)}},c,d)},parse:function(a,b){var c;if(21<=a.byteLength&&"Kaydara FBX Binary  \x00"===T(a,0,21))c=(new R).parse(a);
else{c=T(a);var d;a:{d=c;for(var e="Kaydara\\FBX\\Binary\\\\".split(""),f=0,g=0;g<e.length;++g){var h=d[0];d=d.slice(f+1);f++;if(h===e[g]){d=!1;break a}}d=!0}if(!d)throw Error("THREE.FBXLoader: Unknown format.");if(7E3>S(c))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+S(c));c=(new Q).parse(c)}d=U(c);e={};f={};if("Video"in c.Objects){var g=c.Objects.Video,m;for(m in g){var h=g[m],k=parseInt(m);e[k]=h.Filename;if("Content"in h){var l="string"===typeof h.Content&&""!==h.Content;
if(h.Content instanceof ArrayBuffer&&0<h.Content.byteLength||l){a:{var n=g[m],l=n.Content,n=n.RelativeFilename||n.Filename,q=n.slice(n.lastIndexOf(".")+1).toLowerCase(),n=void 0;switch(q){case "bmp":n="image/bmp";break;case "jpg":case "jpeg":n="image/jpeg";break;case "png":n="image/png";break;case "tif":n="image/tiff";break;default:console.warn('FBXLoader: Image type "'+q+'" is not supported.');l=void 0;break a}"string"===typeof l?l="data:"+n+";base64,"+l:(l=new Uint8Array(l),l=window.URL.createObjectURL(new Blob([l],
{type:n})))}f[h.Filename]=l}}}}for(k in e)m=e[k],e[k]=void 0!==f[m]?f[m]:e[k].split("\\").pop();f=c;m=(new THREE.TextureLoader(this.manager)).setPath(b);k=new Map;if("Texture"in f.Objects){var f=f.Objects.Texture,r;for(r in f){var g=f[r],l=m,h=e,q=void 0,n=l.path,u=d.get(g.id).children;void 0!==u&&0<u.length&&void 0!==h[u[0].ID]&&(q=h[u[0].ID],0!==q.indexOf("blob:")&&0!==q.indexOf("data:")||l.setPath(void 0));h=l.load(q);l.setPath(n);h.ID=g.id;h.name=g.attrName;l=g.WrapModeU;n=g.WrapModeV;n=void 0!==
n?n.value:0;h.wrapS=0===(void 0!==l?l.value:0)?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;h.wrapT=0===n?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;"Scaling"in g&&(g=g.Scaling.value,h.repeat.x=g[0],h.repeat.y=g[1]);g=h;k.set(parseInt(r),g)}}e=c;r=new Map;if("Material"in e.Objects){m=e.Objects.Material;for(var w in m){h=e;l=m[w];n=k;q=d;u=l.id;f=l.attrName;g=l.ShadingModel;"object"===typeof g&&(g=g.value);if(q.has(u)){h=V(h,l,n,u,q);l=void 0;switch(g.toLowerCase()){case "phong":l=new THREE.MeshPhongMaterial;
break;case "lambert":l=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',g),l=new THREE.MeshPhongMaterial({color:3342591})}l.setValues(h);l.name=f;f=l}else f=null;null!==f&&r.set(parseInt(w),f)}}w={};if("Deformer"in c.Objects){var e=c.Objects.Deformer,x;for(x in e)"Skin"===e[x].attrType&&(k=d.get(parseInt(x)),m=W(k,e),m.ID=x,1<k.parents.length&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),
m.geometryID=k.parents[0].ID,w[x]=m)}x=c;e=new Map;if("Geometry"in x.Objects){var k=x.Objects.Geometry,v;for(v in k){m=d.get(parseInt(v));a:{f=k[v];switch(f.attrType){case "Mesh":m=X(x,m,f,w);break a;case "NurbsCurve":m=da(f);break a}m=void 0}e.set(parseInt(v),m)}}return ea(c,d,w,e,r)}});var F=[],L={ByPolygonVertex:{Direct:function(a,b,c,d){return A(F,d.buffer,a*d.dataSize,a*d.dataSize+d.dataSize)},IndexToDirect:function(a,b,c,d){a=d.indices[a];return A(F,d.buffer,a*d.dataSize,a*d.dataSize+d.dataSize)}},
ByPolygon:{Direct:function(a,b,c,d){return A(F,d.buffer,b*d.dataSize,b*d.dataSize+d.dataSize)},IndexToDirect:function(a,b,c,d){a=d.indices[b];return A(F,d.buffer,a*d.dataSize,a*d.dataSize+d.dataSize)}},ByVertice:{Direct:function(a,b,c,d){return A(F,d.buffer,c*d.dataSize,c*d.dataSize+d.dataSize)}},AllSame:{IndexToDirect:function(a,b,c,d){return A(F,d.buffer,d.indices[0]*d.dataSize,d.indices[0]*d.dataSize+d.dataSize)}}};Object.assign(Q.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-
2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();--this.currentIndent},setCurrentProp:function(a,b){this.currentProp=a;this.currentPropName=b},parse:function(a){this.currentIndent=0;this.allNodes=new u;this.nodeStack=[];this.currentProp=[];this.currentPropName="";var b=this,c=a.split("\n");c.forEach(function(a,e){var f=
a.match(/^[\s\t]*;/),g=a.match(/^[\s\t]*$/);if(!f&&!g){var f=a.match("^\\t{"+b.currentIndent+"}(\\w+):(.*){",""),g=a.match("^\\t{"+b.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=a.match("^\\t{"+(b.currentIndent-1)+"}}");f?b.parseNodeBegin(a,f):g?b.parseNodeProperty(a,g,c[++e]):h?b.popStack():a.match(/^[^\s\t}]/)&&b.parseNodePropertyContinued(a)}});return this.allNodes},parseNodeBegin:function(a,b){var c=b[1].trim().replace(/^"/,"").replace(/"$/,""),d=b[2].split(",").map(function(a){return a.trim().replace(/^"/,
"").replace(/"$/,"")}),e={name:c},d=this.parseNodeAttr(d),f=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(c,e):c in f?("PoseNode"===c?f.PoseNode.push(e):void 0!==f[c].id&&(f[c]={},f[c][f[c].id]=f[c]),""!==d.id&&(f[c][d.id]=e)):"number"===typeof d.id?(f[c]={},f[c][d.id]=e):"Properties70"!==c&&(f[c]="PoseNode"===c?[e]:e);"number"===typeof d.id&&(e.id=d.id);""!==d.name&&(e.attrName=d.name);""!==d.type&&(e.attrType=d.type);this.pushStack(e)},parseNodeAttr:function(a){var b=a[0];""!==
a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0]));var c="",d="";1<a.length&&(c=a[1].replace(/^(\w+)::/,""),d=a[2]);return{id:b,name:c,type:d}},parseNodeProperty:function(a,b,c){var d=b[1].replace(/^"/,"").replace(/"$/,"").trim();b=b[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===d&&","===b&&(b=c.replace(/"/g,"").replace(/,$/,"").trim());c=this.getCurrentNode();if("Properties70"===c.name)this.parseNodeSpecialProperty(a,d,b);else{if("C"===d){d=b.split(",").slice(1);a=parseInt(d[0]);var e=parseInt(d[1]),
f=b.split(",").slice(3),f=f.map(function(a){return a.trim().replace(/^"/,"")}),d="connections";b=[a,e];ua(b,f);void 0===c[d]&&(c[d]=[])}"Node"===d&&(c.id=b);d in c&&Array.isArray(c[d])?c[d].push(b):"a"!==d?c[d]=b:c.a=b;this.setCurrentProp(c,d);"a"===d&&","!==b.slice(-1)&&(c.a=I(b))}},parseNodePropertyContinued:function(a){var b=this.getCurrentNode();b.a+=a;","!==a.slice(-1)&&(b.a=I(b.a))},parseNodeSpecialProperty:function(a,b,c){var d=c.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,
"_")});a=d[0];b=d[1];c=d[2];var e=d[3],d=d[4];switch(b){case "int":case "enum":case "bool":case "ULongLong":case "double":case "Number":case "FieldOfView":d=parseFloat(d);break;case "Color":case "ColorRGB":case "Vector3D":case "Lcl_Translation":case "Lcl_Rotation":case "Lcl_Scaling":d=I(d)}this.getPrevNode()[a]={type:b,type2:c,flag:e,value:d};this.setCurrentProp(this.getPrevNode(),a)}});Object.assign(R.prototype,{parse:function(a){a=new H(a);a.skip(23);var b=a.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+
b);for(var c=new u;!this.endOfContent(a);){var d=this.parseNode(a,b);null!==d&&c.add(d.name,d)}return c},endOfContent:function(a){return 0===a.size()%16?(a.getOffset()+160+16&-16)>=a.size():a.getOffset()+160+16>=a.size()},parseNode:function(a,b){var c={},d=7500<=b?a.getUint64():a.getUint32(),e=7500<=b?a.getUint64():a.getUint32();7500<=b?a.getUint64():a.getUint32();var f=a.getUint8(),f=a.getString(f);if(0===d)return null;for(var g=[],h=0;h<e;h++)g.push(this.parseProperty(a));var h=0<g.length?g[0]:
"",m=1<g.length?g[1]:"",k=2<g.length?g[2]:"";for(c.singleProperty=1===e&&a.getOffset()===d?!0:!1;d>a.getOffset();)e=this.parseNode(a,b),null!==e&&this.parseSubNode(f,c,e);c.propertyList=g;"number"===typeof h&&(c.id=h);""!==m&&(c.attrName=m);""!==k&&(c.attrType=k);""!==f&&(c.name=f);return c},parseSubNode:function(a,b,c){if(!0===c.singleProperty)a=c.propertyList[0],Array.isArray(a)?(b[c.name]=c,c.a=a):b[c.name]=a;else if("Connections"===a&&"C"===c.name){var d=[];c.propertyList.forEach(function(a,b){0!==
b&&d.push(a)});void 0===b.connections&&(b.connections=[]);b.connections.push(d)}else if("Properties70"===c.name)Object.keys(c).forEach(function(a){b[a]=c[a]});else if("Properties70"===a&&"P"===c.name){a=c.propertyList[0];var e=c.propertyList[1],f=c.propertyList[2],g=c.propertyList[3],h;0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_"));0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_"));h="Color"===e||"ColorRGB"===e||"Vector"===e||"Vector3D"===e||0===e.indexOf("Lcl_")?[c.propertyList[4],c.propertyList[5],
c.propertyList[6]]:c.propertyList[4];b[a]={type:e,type2:f,flag:g,value:h}}else void 0===b[c.name]?"number"===typeof c.id?(b[c.name]={},b[c.name][c.id]=c):b[c.name]=c:"PoseNode"===c.name?(Array.isArray(b[c.name])||(b[c.name]=[b[c.name]]),b[c.name].push(c)):void 0===b[c.name][c.id]&&(b[c.name][c.id]=c)},parseProperty:function(a){var b=a.getString(1);switch(b){case "C":return a.getBoolean();case "D":return a.getFloat64();case "F":return a.getFloat32();case "I":return a.getInt32();case "L":return a.getInt64();
case "R":return b=a.getUint32(),a.getArrayBuffer(b);case "S":return b=a.getUint32(),a.getString(b);case "Y":return a.getInt16();case "b":case "c":case "d":case "f":case "i":case "l":var c=a.getUint32(),d=a.getUint32(),e=a.getUint32();if(0===d)switch(b){case "b":case "c":return a.getBooleanArray(c);case "d":return a.getFloat64Array(c);case "f":return a.getFloat32Array(c);case "i":return a.getInt32Array(c);case "l":return a.getInt64Array(c)}void 0===window.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");
a=new Zlib.Inflate(new Uint8Array(a.getArrayBuffer(e)));a=new H(a.decompress().buffer);switch(b){case "b":case "c":return a.getBooleanArray(c);case "d":return a.getFloat64Array(c);case "f":return a.getFloat32Array(c);case "i":return a.getInt32Array(c);case "l":return a.getInt64Array(c)}default:throw Error("THREE.FBXLoader: Unknown property type "+b);}}});Object.assign(H.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(a){this.offset+=
a},getBoolean:function(){return 1===(this.getUint8()&1)},getBooleanArray:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getBoolean());return b},getUint8:function(){var a=this.dv.getUint8(this.offset);this.offset+=1;return a},getInt16:function(){var a=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return a},getInt32:function(){var a=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return a},getInt32Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getInt32());return b},
getUint32:function(){var a=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return a},getInt64:function(){var a,b;this.littleEndian?(a=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),a=this.getUint32());return b&2147483648?(b=~b&4294967295,a=~a&4294967295,4294967295===a&&(b=b+1&4294967295),-(4294967296*b+(a+1&4294967295))):4294967296*b+a},getInt64Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getInt64());return b},getUint64:function(){var a,b;this.littleEndian?(a=this.getUint32(),
b=this.getUint32()):(b=this.getUint32(),a=this.getUint32());return 4294967296*b+a},getFloat32:function(){var a=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return a},getFloat32Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getFloat32());return b},getFloat64:function(){var a=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return a},getFloat64Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getFloat64());return b},getArrayBuffer:function(a){var b=this.dv.buffer.slice(this.offset,
this.offset+a);this.offset+=a;return b},getString:function(a){for(var b=new Uint8Array(a),c=0;c<a;c++)b[c]=this.getUint8();a=b.indexOf(0);0<=a&&(b=b.slice(0,a));return THREE.LoaderUtils.decodeText(b)}});Object.assign(u.prototype,{add:function(a,b){this[a]=b}})})();