THREE.MD2Character=function(){function h(a,b){for(var d=new THREE.TextureLoader,f=[],e=0;e<b.length;e++)f[e]=d.load(a+b[e],g),f[e].mapping=THREE.UVMapping,f[e].name=b[e];return f}function k(a,b){var d=new THREE.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),f=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,map:b,morphTargets:!0,morphNormals:!0}),e=new THREE.Mesh(a,f);e.rotation.y=-Math.PI/2;e.castShadow=!0;e.receiveShadow=!0;e.materialTexture=f;e.materialWireframe=
d;return e}function g(){--b.loadCounter;if(0===b.loadCounter)b.onLoadComplete()}var b=this;this.scale=1;this.animationFPS=6;this.root=new THREE.Object3D;this.meshWeapon=this.meshBody=null;this.skinsBody=[];this.skinsWeapon=[];this.weapons=[];this.mixer=this.activeAnimation=null;this.onLoadComplete=function(){};this.loadCounter=0;this.loadParts=function(a){this.loadCounter=2*a.weapons.length+a.skins.length+1;for(var c=[],d=0;d<a.weapons.length;d++)c[d]=a.weapons[d][1];this.skinsBody=h(a.baseUrl+"skins/",
a.skins);this.skinsWeapon=h(a.baseUrl+"skins/",c);c=new THREE.MD2Loader;c.load(a.baseUrl+a.body,function(a){a.computeBoundingBox();b.root.position.y=-b.scale*a.boundingBox.min.y;a=k(a,b.skinsBody[0]);a.scale.set(b.scale,b.scale,b.scale);b.root.add(a);b.meshBody=a;b.meshBody.clipOffset=0;b.activeAnimationClipName=a.geometry.animations[0].name;b.mixer=new THREE.AnimationMixer(a);g()});for(var f=function(a,d){return function(c){c=k(c,b.skinsWeapon[a]);c.scale.set(b.scale,b.scale,b.scale);c.visible=!1;
c.name=d;b.root.add(c);b.weapons[a]=c;b.meshWeapon=c;g()}},d=0;d<a.weapons.length;d++)c.load(a.baseUrl+a.weapons[d][0],f(d,a.weapons[d][0]))};this.setPlaybackRate=function(a){this.mixer.timeScale=0!==a?1/a:0};this.setWireframe=function(a){a?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=
this.meshWeapon.materialTexture))};this.setSkin=function(a){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[a])};this.setWeapon=function(a){for(var c=0;c<this.weapons.length;c++)this.weapons[c].visible=!1;if(a=this.weapons[a])a.visible=!0,this.meshWeapon=a,b.syncWeaponAnimation()};this.setAnimation=function(a){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var c=this.mixer.clipAction(a,
this.meshBody);c&&(this.meshBody.activeAction=c.play())}b.activeClipName=a;b.syncWeaponAnimation()};this.syncWeaponAnimation=function(){var a=b.activeClipName;b.meshWeapon&&(this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null),a=this.mixer.clipAction(a,this.meshWeapon))&&(this.meshWeapon.activeAction=a.syncWith(this.meshBody.activeAction).play())};this.update=function(a){this.mixer&&this.mixer.update(a)}};