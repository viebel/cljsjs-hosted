THREE.VolumeSlice=function(a,e,k){var b=this;this.volume=a;e=e||0;Object.defineProperty(this,"index",{get:function(){return e},set:function(a){e=a;b.geometryNeedsUpdate=!0;return e}});this.axis=k||"z";this.canvas=document.createElement("canvas");this.canvasBuffer=document.createElement("canvas");this.updateGeometry();a=new THREE.Texture(this.canvas);a.minFilter=THREE.LinearFilter;a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping;a=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide,transparent:!0});
this.mesh=new THREE.Mesh(this.geometry,a);this.geometryNeedsUpdate=!0;this.repaint()};
THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var a=this.iLength,e=this.jLength,k=this.sliceAccess,b=this.volume,r=this.canvasBuffer,m=this.ctxBuffer,n=m.getImageData(0,0,a,e),g=n.data,p=b.data,c=b.upperThreshold,t=b.lowerThreshold,q=b.windowLow,u=b.windowHigh,f=0;if("label"===b.dataType)for(b=0;b<e;b++)for(var h=0;h<a;h++)c=p[k(h,b)],c=c>=this.colorMap.length?c%this.colorMap.length+1:c,c=this.colorMap[c],g[4*f]=c>>24&
255,g[4*f+1]=c>>16&255,g[4*f+2]=c>>8&255,g[4*f+3]=c&255,f++;else for(b=0;b<e;b++)for(h=0;h<a;h++){var d=p[k(h,b)],l=255,l=c>=d?t<=d?l:0:0,d=Math.floor(255*(d-q)/(u-q)),d=255<d?255:0>d?0:d|0;g[4*f]=d;g[4*f+1]=d;g[4*f+2]=d;g[4*f+3]=l;f++}m.putImageData(n,0,0);this.ctx.drawImage(r,0,0,a,e,0,0,this.canvas.width,this.canvas.height);this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var a=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=a.sliceAccess;this.jLength=
a.jLength;this.iLength=a.iLength;this.matrix=a.matrix;this.canvas.width=a.planeWidth;this.canvas.height=a.planeHeight;this.canvasBuffer.width=this.iLength;this.canvasBuffer.height=this.jLength;this.ctx=this.canvas.getContext("2d");this.ctxBuffer=this.canvasBuffer.getContext("2d");this.geometry=new THREE.PlaneGeometry(a.planeWidth,a.planeHeight);this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new THREE.Matrix4).identity(),this.mesh.applyMatrix(this.matrix));this.geometryNeedsUpdate=
!1}};