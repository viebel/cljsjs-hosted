THREE.TimelinerController=function(a,b,c){this._scene=a;this._trackInfo=b;this._onUpdate=c;this._mixer=new THREE.AnimationMixer(a);this._action=this._clip=null;this._tracks={};this._propRefs={};this._channelNames=[]};
THREE.TimelinerController.prototype={constructor:THREE.TimelinerController,init:function(a){a=[];for(var b=this._trackInfo,c=0,d=b.length;c!==d;++c){var e=b[c];a.push(this._addTrack(e.type,e.propertyPath,e.initialValue,e.interpolation))}this._clip=new THREE.AnimationClip("editclip",0,a);this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(a){this._action.time=a;this._mixer.update(0);this._onUpdate()},setDuration:function(a){this._clip.duration=a},getChannelNames:function(){return this._channelNames},
getChannelKeyTimes:function(a){return this._tracks[a].times},setKeyframe:function(a,b){var c=this._tracks[a],d=c.times,e=Timeliner.binarySearch(d,b),f=c.values,c=c.getValueSize(),g=e*c;if(0>e){for(var e=~e,g=e*c,k=f.length+c,h=d.length+1-1;h!==e;--h)d[h]=d[h-1];h=k-1;for(k=g+c-1;h!==k;--h)f[h]=f[h-c]}d[e]=b;this._propRefs[a].getValue(f,g)},delKeyframe:function(a,b){var c=this._tracks[a],d=c.times,e=Timeliner.binarySearch(d,b);if(1<d.length&&0<=e){for(var f=d.length-1,g=c.values,c=c.getValueSize(),
k=g.length-c,h=e;h!==f;++h)d[h]=d[h+1];d.pop();for(d=e*c;d!==k;++d)g[d]=g[d+c];g.length=k}},moveKeyframe:function(a,b,c,d){a=this._tracks[a];var e=a.times,f=Timeliner.binarySearch(e,b);if(0<=f){var g=d?e.length:f+1;for(b=e[f-1]<=b||!d&&b>=e[f+1];f!==g;)e[f++]+=c;b&&this._sort(a)}},serialize:function(){for(var a={duration:this._clip.duration,channels:{}},b=this._channelNames,c=this._tracks,d=a.channels,e=0,f=b.length;e!==f;++e){var g=b[e],k=c[g];d[g]={times:k.times,values:k.values}}return a},deserialize:function(a){var b=
this._channelNames,c=this._tracks,d=a.channels;this.setDuration(a.duration);a=0;for(var e=b.length;a!==e;++a){var f=b[a],g=c[f],f=d[f];this._setArray(g.times,f.times);this._setArray(g.values,f.values)}this.setDisplayTime(this._mixer.time)},_sort:function(a){var b=a.times,c=THREE.AnimationUtils.getKeyframeOrder(b);this._setArray(b,THREE.AnimationUtils.sortedArray(b,1,c));b=a.values;a=a.getValueSize();this._setArray(b,THREE.AnimationUtils.sortedArray(b,a,c))},_setArray:function(a,b){a.length=0;a.push.apply(a,
b)},_addTrack:function(a,b,c,d){a=new a(b,[0],c,d);a.times=Array.prototype.slice.call(a.times);a.values=Array.prototype.slice.call(a.values);this._channelNames.push(b);this._tracks[b]=a;this._propRefs[b]=new THREE.PropertyBinding(this._scene,b);return a}};