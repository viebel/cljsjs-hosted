THREE.Lut=function(a,h){this.lut=[];this.map=THREE.ColorMapKeywords[a];this.n=h;this.mapname=a;for(var c=1/this.n,b=0;1>=b;b+=c)for(var d=0;d<this.map.length-1;d++)if(b>=this.map[d][0]&&b<this.map[d+1][0]){var e=this.map[d][0],l=this.map[d+1][0],m=(new THREE.Color(16777215)).setHex(this.map[d][1]),n=(new THREE.Color(16777215)).setHex(this.map[d+1][1]),e=m.lerp(n,(b-e)/(l-e));this.lut.push(e)}return this.set(this)};
THREE.Lut.prototype={constructor:THREE.Lut,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(a){a instanceof THREE.Lut&&this.copy(a);return this},setMin:function(a){this.minV=a;return this},setMax:function(a){this.maxV=a;return this},changeNumberOfColors:function(a){this.n=a;return new THREE.Lut(this.mapname,this.n)},changeColorMap:function(a){this.mapname=a;return new THREE.Lut(this.mapname,this.n)},copy:function(a){this.lut=a.lut;this.mapname=a.mapname;this.map=a.map;
this.n=a.n;this.minV=a.minV;this.maxV=a.maxV;return this},getColor:function(a){a<=this.minV?a=this.minV:a>=this.maxV&&(a=this.maxV);a=(a-this.minV)/(this.maxV-this.minV);a=Math.round(a*this.n);a==this.n?--a:a;return this.lut[a]},addColorMap:function(a,h){THREE.ColorMapKeywords[a]=h},setLegendOn:function(a){void 0===a&&(a={});this.legend={};this.legend.layout=a.hasOwnProperty("layout")?a.layout:"vertical";this.legend.position=a.hasOwnProperty("position")?a.position:{x:21.5,y:8,z:5};this.legend.dimensions=
a.hasOwnProperty("dimensions")?a.dimensions:{width:.5,height:3};this.legend.canvas=document.createElement("canvas");this.legend.canvas.setAttribute("id","legend");this.legend.canvas.setAttribute("hidden",!0);document.body.appendChild(this.legend.canvas);this.legend.ctx=this.legend.canvas.getContext("2d");this.legend.canvas.setAttribute("width",1);this.legend.canvas.setAttribute("height",this.n);this.legend.texture=new THREE.Texture(this.legend.canvas);a=this.legend.ctx.getImageData(0,0,1,this.n);
var h=a.data;this.map=THREE.ColorMapKeywords[this.mapname];for(var c=0,b=1/this.n,d=1;0<=d;d-=b)for(var e=this.map.length-1;0<=e;e--)if(d<this.map[e][0]&&d>=this.map[e-1][0]){var l=this.map[e-1][0],m=this.map[e][0],n=(new THREE.Color(16777215)).setHex(this.map[e-1][1]),r=(new THREE.Color(16777215)).setHex(this.map[e][1]),l=n.lerp(r,(d-l)/(m-l));h[4*c]=Math.round(255*l.r);h[4*c+1]=Math.round(255*l.g);h[4*c+2]=Math.round(255*l.b);h[4*c+3]=255;c+=1}this.legend.ctx.putImageData(a,0,0);this.legend.texture.needsUpdate=
!0;this.legend.legendGeometry=new THREE.PlaneBufferGeometry(this.legend.dimensions.width,this.legend.dimensions.height);this.legend.legendMaterial=new THREE.MeshBasicMaterial({map:this.legend.texture,side:THREE.DoubleSide});this.legend.mesh=new THREE.Mesh(this.legend.legendGeometry,this.legend.legendMaterial);"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90);this.legend.mesh.position.copy(this.legend.position);return this.legend.mesh},setLegendOff:function(){return this.legend=
null},setLegendLayout:function(a){if(!this.legend||this.legend.layout==a||"horizontal"!=a&&"vertical"!=a)return!1;this.layout=a;"horizontal"==a&&(this.legend.mesh.rotation.z=Math.PI/180*90);"vertical"==a&&(this.legend.mesh.rotation.z=Math.PI/180*-90);return this.legend.mesh},setLegendPosition:function(a){this.legend.position=new THREE.Vector3(a.x,a.y,a.z);return this.legend},setLegendLabels:function(a,h){if(!this.legend)return!1;"function"===typeof a&&(h=a);void 0===a&&(a={});this.legend.labels={};
this.legend.labels.fontsize=a.hasOwnProperty("fontsize")?a.fontsize:24;this.legend.labels.fontface=a.hasOwnProperty("fontface")?a.fontface:"Arial";this.legend.labels.title=a.hasOwnProperty("title")?a.title:"";this.legend.labels.um=a.hasOwnProperty("um")?" [ "+a.um+" ]":"";this.legend.labels.ticks=a.hasOwnProperty("ticks")?a.ticks:0;this.legend.labels.decimal=a.hasOwnProperty("decimal")?a.decimal:2;this.legend.labels.notation=a.hasOwnProperty("notation")?a.notation:"standard";var c=document.createElement("canvas"),
b=c.getContext("2d");b.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface;b.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString());b.fillStyle="rgba(255,100,100,0.8)";b.strokeStyle="rgba(255,0,0,1)";b.lineWidth=4;b.fillStyle="rgba( 0, 0, 0, 1.0 )";b.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);c=new THREE.CanvasTexture(c);c.minFilter=THREE.LinearFilter;c=new THREE.SpriteMaterial({map:c});
c=new THREE.Sprite(c);c.scale.set(2,1,1);"vertical"==this.legend.layout&&c.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z);"horizontal"==this.legend.layout&&c.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z);if(0<this.legend.labels.ticks){var d={},e={};if("vertical"==this.legend.layout)var l=this.legend.position.y+.36*this.legend.dimensions.height,
m=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var n=this.legend.position.x+.75*this.legend.dimensions.height,r=this.legend.position.x-1.2*this.legend.dimensions.width;for(b=0;b<this.legend.labels.ticks;b++){var f=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*b+this.minV,f=h?h(f):"scientific"==this.legend.labels.notation?f.toExponential(this.legend.labels.decimal):f.toFixed(this.legend.labels.decimal),k=document.createElement("canvas"),g=k.getContext("2d");
g.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface;g.measureText(f.toString());g.fillStyle="rgba(255,100,100,0.8)";g.strokeStyle="rgba(255,0,0,1)";g.lineWidth=4;g.fillStyle="rgba( 0, 0, 0, 1.0 )";g.fillText(f.toString(),4,this.legend.labels.fontsize+4);k=new THREE.CanvasTexture(k);k.minFilter=THREE.LinearFilter;k=new THREE.SpriteMaterial({map:k});k=new THREE.Sprite(k);k.scale.set(2,1,1);"vertical"==this.legend.layout&&(g=m+(f-this.minV)/(this.maxV-this.minV)*(l-m),k.position.set(this.legend.position.x+
2.7*this.legend.dimensions.width,g,this.legend.position.z));"horizontal"==this.legend.layout&&(g=r+(f-this.minV)/(this.maxV-this.minV)*(n-r),k.position.set(g,this.legend.position.y-this.legend.dimensions.width*(5<this.legend.labels.ticks?0===b%2?1.7:2.1:1.7),this.legend.position.z));var g=new THREE.LineBasicMaterial({color:0,linewidth:2}),p=[];if("vertical"==this.legend.layout){var q=this.legend.position.y-.5*this.legend.dimensions.height+.01+(f-this.minV)/(this.maxV-this.minV)*this.legend.dimensions.height*
.99;p.push(new THREE.Vector3(this.legend.position.x+.55*this.legend.dimensions.width,q,this.legend.position.z));p.push(new THREE.Vector3(this.legend.position.x+.7*this.legend.dimensions.width,q,this.legend.position.z))}"horizontal"==this.legend.layout&&(q=this.legend.position.x-.5*this.legend.dimensions.height+.01+(f-this.minV)/(this.maxV-this.minV)*this.legend.dimensions.height*.99,p.push(new THREE.Vector3(q,this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),p.push(new THREE.Vector3(q,
this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z)));f=(new THREE.BufferGeometry).setFromPoints(p);f=new THREE.Line(f,g);e[b]=f;d[b]=k}}return{title:c,ticks:d,lines:e}}};
THREE.ColorMapKeywords={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]};