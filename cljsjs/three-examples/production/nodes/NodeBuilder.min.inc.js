THREE.NodeBuilder=function(a){this.material=a;this.caches=[];this.slots=[];this.keywords={};this.parsing=!1;this.optimize=!0;this.update()};THREE.NodeBuilder.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"};THREE.NodeBuilder.constructors=["float","vec2","vec3","vec4"];THREE.NodeBuilder.elements=["x","y","z","w"];
THREE.NodeBuilder.prototype={constructor:THREE.NodeBuilder,addCache:function(a,b){this.caches.push({name:a||"",requires:b||{}});return this.update()},removeCache:function(){this.caches.pop();return this.update()},addSlot:function(a){this.slots.push({name:a||""});return this.update()},removeSlot:function(){this.slots.pop();return this.update()},isCache:function(a){for(var b=this.caches.length;b--;)if(this.caches[b].name==a)return!0;return!1},isSlot:function(a){for(var b=this.slots.length;b--;)if(this.slots[b].name==
a)return!0;return!1},update:function(){var a=this.caches[this.caches.length-1],b=this.slots[this.slots.length-1];this.slot=b?b.name:"";this.cache=a?a.name:"";this.requires=a?a.requires:{};return this},require:function(a,b){this.requires[a]=b;return this},include:function(a,b,c){this.material.include(this,a,b,c);return this},colorToVector:function(a){return a.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(a){return THREE.NodeBuilder.constructors[a-
1]},getFormatName:function(a){return a.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(a){return/^m/.test(a)},getFormatLength:function(a){return parseInt(this.getFormatName(a).substr(1))},getFormatFromLength:function(a){return 1==a?"fv1":"v"+a},format:function(a,b,c){switch(this.getFormatName(c+"\x3d"+b)){case "v1\x3dv2":return a+".x";case "v1\x3dv3":return a+".x";case "v1\x3dv4":return a+".x";case "v1\x3di":return"float("+a+")";case "v2\x3dv1":return"vec2("+a+
")";case "v2\x3dv3":return a+".xy";case "v2\x3dv4":return a+".xy";case "v2\x3di":return"vec2(float("+a+"))";case "v3\x3dv1":return"vec3("+a+")";case "v3\x3dv2":return"vec3("+a+",0.0)";case "v3\x3dv4":return a+".xyz";case "v3\x3di":return"vec2(float("+a+"))";case "v4\x3dv1":return"vec4("+a+")";case "v4\x3dv2":return"vec4("+a+",0.0,1.0)";case "v4\x3dv3":return"vec4("+a+",1.0)";case "v4\x3di":return"vec4(float("+a+"))";case "i\x3dv1":return"int("+a+")";case "i\x3dv2":return"int("+a+".x)";case "i\x3dv3":return"int("+
a+".x)";case "i\x3dv4":return"int("+a+".x)"}return a},getTypeByFormat:function(a){return THREE.NodeBuilder.type[a]||a},getUuid:function(a,b){(void 0!==b?b:1)&&this.cache&&(a=this.cache+"-"+a);return a},getElementByIndex:function(a){return THREE.NodeBuilder.elements[a]},getIndexByElement:function(a){return THREE.NodeBuilder.elements.indexOf(a)},isShader:function(a){return this.shader==a},setShader:function(a){this.shader=a;return this}};