THREE.VelocityNode=function(a,b){THREE.Vector3Node.call(this);this.params={};this.velocity=new THREE.Vector3;this.setTarget(a);this.setParams(b)};THREE.VelocityNode.prototype=Object.create(THREE.Vector3Node.prototype);THREE.VelocityNode.prototype.constructor=THREE.VelocityNode;THREE.VelocityNode.prototype.nodeType="Velocity";THREE.VelocityNode.prototype.isReadonly=function(a){return!1};
THREE.VelocityNode.prototype.setParams=function(a){switch(this.params.type){case "elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}this.params=a||{};switch(this.params.type){case "elastic":this.moment=new THREE.Vector3,this.speed=new THREE.Vector3,this.springVelocity=new THREE.Vector3,this.lastVelocity=new THREE.Vector3}};
THREE.VelocityNode.prototype.setTarget=function(a){this.target&&(delete this.position,delete this.oldPosition);if(this.target=a)this.position=a.getWorldPosition(),this.oldPosition=this.position.clone()};THREE.VelocityNode.prototype.updateFrameVelocity=function(a){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))};
THREE.VelocityNode.prototype.updateFrame=function(a){this.updateFrameVelocity(a);switch(this.params.type){case "elastic":a=a.delta*(this.params.fps||60);var b=Math.pow(this.params.spring,a),c=Math.pow(this.params.damping,a);this.velocity.multiplyScalar(Math.exp(-this.params.damping*a));this.velocity.add(this.springVelocity);this.velocity.add(this.speed.multiplyScalar(c).multiplyScalar(1-b));this.speed.subVectors(this.velocity,this.lastVelocity);this.springVelocity.add(this.speed);this.springVelocity.multiplyScalar(b);
this.moment.add(this.springVelocity);this.moment.multiplyScalar(c);this.lastVelocity.copy(this.velocity);this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}};THREE.VelocityNode.prototype.toJSON=function(a){var b=this.getJSONNode(a);b||(b=this.createJSONNode(a),this.target&&(b.target=this.target.uuid),b.params=JSON.parse(JSON.stringify(this.params)));return b};