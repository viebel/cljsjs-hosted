THREE.TrackballControls=function(M,B){function r(b){!1!==a.enabled&&(window.removeEventListener("keydown",r),u=d,d===c.NONE)&&(b.keyCode!==a.keys[c.ROTATE]||a.noRotate?b.keyCode!==a.keys[c.ZOOM]||a.noZoom?b.keyCode!==a.keys[c.PAN]||a.noPan||(d=c.PAN):d=c.ZOOM:d=c.ROTATE)}function C(b){!1!==a.enabled&&(d=u,window.addEventListener("keydown",r,!1))}function D(b){!1!==a.enabled&&(b.preventDefault(),b.stopPropagation(),d===c.NONE&&(d=b.button),d!==c.ROTATE||a.noRotate?d!==c.ZOOM||a.noZoom?d!==c.PAN||a.noPan||
(l.copy(n(b.pageX,b.pageY)),h.copy(l)):(e.copy(n(b.pageX,b.pageY)),k.copy(e)):(g.copy(p(b.pageX,b.pageY)),m.copy(g)),document.addEventListener("mousemove",v,!1),document.addEventListener("mouseup",w,!1),a.dispatchEvent(x))}function v(b){!1!==a.enabled&&(b.preventDefault(),b.stopPropagation(),d!==c.ROTATE||a.noRotate?d!==c.ZOOM||a.noZoom?d!==c.PAN||a.noPan||h.copy(n(b.pageX,b.pageY)):k.copy(n(b.pageX,b.pageY)):(m.copy(g),g.copy(p(b.pageX,b.pageY))))}function w(b){!1!==a.enabled&&(b.preventDefault(),
b.stopPropagation(),d=c.NONE,document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",w),a.dispatchEvent(y))}function E(b){if(!1!==a.enabled&&!0!==a.noZoom){b.preventDefault();b.stopPropagation();switch(b.deltaMode){case 2:e.y-=.025*b.deltaY;break;case 1:e.y-=.01*b.deltaY;break;default:e.y-=2.5E-4*b.deltaY}a.dispatchEvent(x);a.dispatchEvent(y)}}function F(b){if(!1!==a.enabled){switch(b.touches.length){case 1:d=c.TOUCH_ROTATE;g.copy(p(b.touches[0].pageX,b.touches[0].pageY));
m.copy(g);break;default:d=c.TOUCH_ZOOM_PAN;var G=b.touches[0].pageX-b.touches[1].pageX,f=b.touches[0].pageY-b.touches[1].pageY;t=z=Math.sqrt(G*G+f*f);l.copy(n((b.touches[0].pageX+b.touches[1].pageX)/2,(b.touches[0].pageY+b.touches[1].pageY)/2));h.copy(l)}a.dispatchEvent(x)}}function H(b){if(!1!==a.enabled)switch(b.preventDefault(),b.stopPropagation(),b.touches.length){case 1:m.copy(g);g.copy(p(b.touches[0].pageX,b.touches[0].pageY));break;default:var c=b.touches[0].pageX-b.touches[1].pageX,d=b.touches[0].pageY-
b.touches[1].pageY;t=Math.sqrt(c*c+d*d);h.copy(n((b.touches[0].pageX+b.touches[1].pageX)/2,(b.touches[0].pageY+b.touches[1].pageY)/2))}}function I(b){if(!1!==a.enabled){switch(b.touches.length){case 0:d=c.NONE;break;case 1:d=c.TOUCH_ROTATE,g.copy(p(b.touches[0].pageX,b.touches[0].pageY)),m.copy(g)}a.dispatchEvent(y)}}function J(b){!1!==a.enabled&&b.preventDefault()}var a=this,c={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=M;this.domElement=void 0!==B?B:document;this.enabled=
!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var A=new THREE.Vector3,d=c.NONE,u=c.NONE,f=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,K=new THREE.Vector3,q=0,e=new THREE.Vector2,k=new THREE.Vector2,z=0,t=0,l=new THREE.Vector2,h=new THREE.Vector2;this.target0=
this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var L={type:"change"},x={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),c=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-c.clientLeft;this.screen.top=a.top+window.pageYOffset-
c.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var n=function(){var b=new THREE.Vector2;return function(c,d){b.set((c-a.screen.left)/a.screen.width,(d-a.screen.top)/a.screen.height);return b}}(),p=function(){var b=new THREE.Vector2;return function(c,d){b.set((c-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-d))/a.screen.width);return b}}();this.rotateCamera=
function(){var b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,l=new THREE.Vector3,k=new THREE.Vector3,h;return function(){k.set(g.x-m.x,g.y-m.y,0);(h=k.length())?(f.copy(a.object.position).sub(a.target),d.copy(f).normalize(),e.copy(a.object.up).normalize(),l.crossVectors(e,d).normalize(),e.setLength(g.y-m.y),l.setLength(g.x-m.x),k.copy(e.add(l)),b.crossVectors(k,f).normalize(),h*=a.rotateSpeed,c.setFromAxisAngle(b,h),f.applyQuaternion(c),a.object.up.applyQuaternion(c),
K.copy(b),q=h):!a.staticMoving&&q&&(q*=Math.sqrt(1-a.dynamicDampingFactor),f.copy(a.object.position).sub(a.target),c.setFromAxisAngle(K,q),f.applyQuaternion(c),a.object.up.applyQuaternion(c));m.copy(g)}}();this.zoomCamera=function(){var b;d===c.TOUCH_ZOOM_PAN?(b=z/t,z=t,f.multiplyScalar(b)):(b=1+(k.y-e.y)*a.zoomSpeed,1!==b&&0<b&&f.multiplyScalar(b),a.staticMoving?e.copy(k):e.y+=(k.y-e.y)*this.dynamicDampingFactor)};this.panCamera=function(){var b=new THREE.Vector2,c=new THREE.Vector3,d=new THREE.Vector3;
return function(){b.copy(h).sub(l);b.lengthSq()&&(b.multiplyScalar(f.length()*a.panSpeed),d.copy(f).cross(a.object.up).setLength(b.x),d.add(c.copy(a.object.up).setLength(b.y)),a.object.position.add(d),a.target.add(d),a.staticMoving?l.copy(h):l.add(b.subVectors(h,l).multiplyScalar(a.dynamicDampingFactor)))}}();this.checkDistances=function(){a.noZoom&&a.noPan||(f.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,f.setLength(a.maxDistance)),e.copy(k)),f.lengthSq()<a.minDistance*
a.minDistance&&(a.object.position.addVectors(a.target,f.setLength(a.minDistance)),e.copy(k)))};this.update=function(){f.subVectors(a.object.position,a.target);a.noRotate||a.rotateCamera();a.noZoom||a.zoomCamera();a.noPan||a.panCamera();a.object.position.addVectors(a.target,f);a.checkDistances();a.object.lookAt(a.target);1E-6<A.distanceToSquared(a.object.position)&&(a.dispatchEvent(L),A.copy(a.object.position))};this.reset=function(){u=d=c.NONE;a.target.copy(a.target0);a.object.position.copy(a.position0);
a.object.up.copy(a.up0);f.subVectors(a.object.position,a.target);a.object.lookAt(a.target);a.dispatchEvent(L);A.copy(a.object.position)};this.dispose=function(){this.domElement.removeEventListener("contextmenu",J,!1);this.domElement.removeEventListener("mousedown",D,!1);this.domElement.removeEventListener("wheel",E,!1);this.domElement.removeEventListener("touchstart",F,!1);this.domElement.removeEventListener("touchend",I,!1);this.domElement.removeEventListener("touchmove",H,!1);document.removeEventListener("mousemove",
v,!1);document.removeEventListener("mouseup",w,!1);window.removeEventListener("keydown",r,!1);window.removeEventListener("keyup",C,!1)};this.domElement.addEventListener("contextmenu",J,!1);this.domElement.addEventListener("mousedown",D,!1);this.domElement.addEventListener("wheel",E,!1);this.domElement.addEventListener("touchstart",F,!1);this.domElement.addEventListener("touchend",I,!1);this.domElement.addEventListener("touchmove",H,!1);window.addEventListener("keydown",r,!1);window.addEventListener("keyup",
C,!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;