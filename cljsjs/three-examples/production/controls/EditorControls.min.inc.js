THREE.EditorControls=function(e,b){function v(a){!1!==d.enabled&&(0===a.button?k=h.ROTATE:1===a.button?k=h.ZOOM:2===a.button&&(k=h.PAN),n.set(a.clientX,a.clientY),b.addEventListener("mousemove",r,!1),b.addEventListener("mouseup",f,!1),b.addEventListener("mouseout",f,!1),b.addEventListener("dblclick",f,!1))}function r(a){if(!1!==d.enabled){t.set(a.clientX,a.clientY);var b=t.x-n.x,c=t.y-n.y;k===h.ROTATE?d.rotate(new THREE.Vector3(-b*d.rotationSpeed,-c*d.rotationSpeed,0)):k===h.ZOOM?d.zoom(new THREE.Vector3(0,
0,c)):k===h.PAN&&d.pan(new THREE.Vector3(-b,c,0));n.set(a.clientX,a.clientY)}}function f(a){b.removeEventListener("mousemove",r,!1);b.removeEventListener("mouseup",f,!1);b.removeEventListener("mouseout",f,!1);b.removeEventListener("dblclick",f,!1);k=h.NONE}function w(a){a.preventDefault();d.zoom(new THREE.Vector3(0,0,a.deltaY))}function x(a){a.preventDefault()}function y(a){if(!1!==d.enabled){switch(a.touches.length){case 1:c[0].set(a.touches[0].pageX,a.touches[0].pageY,0);c[1].set(a.touches[0].pageX,
a.touches[0].pageY,0);break;case 2:c[0].set(a.touches[0].pageX,a.touches[0].pageY,0),c[1].set(a.touches[1].pageX,a.touches[1].pageY,0),u=c[0].distanceTo(c[1])}l[0].copy(c[0]);l[1].copy(c[1])}}function z(a){function b(a,c){var d=c[0],e;for(e in c)d.distanceTo(a)>c[e].distanceTo(a)&&(d=c[e]);return d}if(!1!==d.enabled){a.preventDefault();a.stopPropagation();switch(a.touches.length){case 1:c[0].set(a.touches[0].pageX,a.touches[0].pageY,0);c[1].set(a.touches[0].pageX,a.touches[0].pageY,0);d.rotate(c[0].sub(b(c[0],
l)).multiplyScalar(-d.rotationSpeed));break;case 2:c[0].set(a.touches[0].pageX,a.touches[0].pageY,0);c[1].set(a.touches[1].pageX,a.touches[1].pageY,0);a=c[0].distanceTo(c[1]);d.zoom(new THREE.Vector3(0,0,u-a));u=a;a=c[0].clone().sub(b(c[0],l));var e=c[1].clone().sub(b(c[1],l));a.x=-a.x;e.x=-e.x;d.pan(a.add(e).multiplyScalar(.5))}l[0].copy(c[0]);l[1].copy(c[1])}}b=void 0!==b?b:document;this.enabled=!0;this.center=new THREE.Vector3;this.zoomSpeed=this.panSpeed=.001;this.rotationSpeed=.005;var d=this,
p=new THREE.Vector3,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},k=h.NONE,g=this.center,A=new THREE.Matrix3,t=new THREE.Vector2,n=new THREE.Vector2,m=new THREE.Spherical,q={type:"change"};this.focus=function(a){var b=(new THREE.Box3).setFromObject(a);!1===b.isEmpty()?(g.copy(b.getCenter()),a=b.getBoundingSphere().radius):(g.setFromMatrixPosition(a.matrixWorld),a=.1);b=new THREE.Vector3(0,0,1);b.applyQuaternion(e.quaternion);b.multiplyScalar(4*a);e.position.copy(g).add(b);d.dispatchEvent(q)};this.pan=function(a){var b=
e.position.distanceTo(g);a.multiplyScalar(b*d.panSpeed);a.applyMatrix3(A.getNormalMatrix(e.matrix));e.position.add(a);g.add(a);d.dispatchEvent(q)};this.zoom=function(a){var b=e.position.distanceTo(g);a.multiplyScalar(b*d.zoomSpeed);a.length()>b||(a.applyMatrix3(A.getNormalMatrix(e.matrix)),e.position.add(a),d.dispatchEvent(q))};this.rotate=function(a){p.copy(e.position).sub(g);m.setFromVector3(p);m.theta+=a.x;m.phi+=a.y;m.makeSafe();p.setFromSpherical(m);e.position.copy(g).add(p);e.lookAt(g);d.dispatchEvent(q)};
this.dispose=function(){b.removeEventListener("contextmenu",x,!1);b.removeEventListener("mousedown",v,!1);b.removeEventListener("wheel",w,!1);b.removeEventListener("mousemove",r,!1);b.removeEventListener("mouseup",f,!1);b.removeEventListener("mouseout",f,!1);b.removeEventListener("dblclick",f,!1);b.removeEventListener("touchstart",y,!1);b.removeEventListener("touchmove",z,!1)};b.addEventListener("contextmenu",x,!1);b.addEventListener("mousedown",v,!1);b.addEventListener("wheel",w,!1);var c=[new THREE.Vector3,
new THREE.Vector3,new THREE.Vector3],l=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],u=null;b.addEventListener("touchstart",y,!1);b.addEventListener("touchmove",z,!1)};THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.EditorControls.prototype.constructor=THREE.EditorControls;