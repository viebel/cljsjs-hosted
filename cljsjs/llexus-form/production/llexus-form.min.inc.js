!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.LlexusForm=t(require("react")):e.LlexusForm=t(e.React)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";e.exports=r(1)},function(e,t,r){"use strict";function n(e){var t,r,n={};for(t=0;t<e.length;++t)r=e[t],n[s(r.path)]=r.errors;return n}function s(e){return e.join("_")}function i(e){return e.context||e.schema}var a=r(2),o=a.DOM,p=r(3),u=r(4),l=r(17),c=r(9);e.exports=a.createClass({displayName:"Form",propsToAdditionalPropsInPlace:function(e,t,r,n){if("object"==typeof r&&!Array.isArray(r)){var s,i,a=e.properties||{},o=n||e;e.additionalProperties&&(t._additionalProperties=[],i=c(e.additionalProperties,o));for(s in r)if(s in a)this.propsToAdditionalPropsInPlace(a[s],t[s],r[s],o);else if(e.additionalProperties){var p=JSON.parse(JSON.stringify(r[s]));this.propsToAdditionalPropsInPlace(i,p,r[s],o),t._additionalProperties.push({key:s,value:p}),delete t[s]}}},getInitialState:function(){if(this.props.values){var e=JSON.parse(JSON.stringify(this.props.values));this.propsToAdditionalPropsInPlace(this.props.schema,e,this.props.values)}else var e=this.props.values;var t=this.validate(this.props.schema,this.props.values,i(this.props));return console.log(t),{values:e,output:e,errors:t}},componentWillReceiveProps:function(e){var t=e.values||this.state.values,r=e.values||this.state.output;this.setState({values:t,output:r,errors:this.validate(e.schema,r,i(e))})},setValue:function(e,t,r){var n=this.props.schema,s=i(this.props),a=l(p.setIn(this.state.values,e,t),n,s),o=l(p.setIn(this.state.output,e,r),n,s),u=this.validate(n,o,s);this.props.submitOnChange?this.props.onSubmit(o,null,u):this.setState({values:a,output:o,errors:u})},getValue:function(e){return p.getIn(this.state.values,e)},getErrors:function(e){return this.state.errors[s(e)]},validate:function(e,t,r){return n(this.props.validate(e,this.additionalPropsToProps(t),r))},preventSubmit:function(e){e.preventDefault()},additionalPropsToProps:function(e){if("object"!=typeof e||Array.isArray(e))return e;var t,r={};for(t in e)"_additionalProperties"==t?e[t].forEach(function(e){var t=e.key,n=e.value;r[t]=this.additionalPropsToProps(n)}.bind(this)):r[t]=this.additionalPropsToProps(e[t]);return r},handleSubmit:function(e){this.props.onSubmit(this.additionalPropsToProps(this.state.output),e.target.value,this.state.errors)},handleKeyPress:function(e){13===e.keyCode&&this.props.enterKeySubmits&&this.props.onSubmit(this.state.output,this.props.enterKeySubmits)},renderButtons:function(){var e=this.handleSubmit;if("function"==typeof this.props.buttons)return this.props.buttons(e);var t=(this.props.buttons||["Cancel","Submit"]).map(function(t){return o.input({type:"submit",key:t,value:t,onClick:e})});return o.p(null,t)},render:function(){var e=u.make(u,{schema:this.props.schema,context:i(this.props),fieldWrapper:this.props.fieldWrapper,sectionWrapper:this.props.sectionWrapper,handlers:this.props.handlers,hints:this.props.hints,path:[],update:this.setValue,getValue:this.getValue,getErrors:this.getErrors});return o.form({onSubmit:this.preventSubmit,onKeyPress:this.handleKeyPress,className:this.props.className},this.props.extraButtons?this.renderButtons():o.span(),e,this.renderButtons())}})},function(t,r){t.exports=e},function(e,t){"use strict";var r=function(e){return"number"==typeof e&&e>=0&&e%1==0},n=function(){var e,t=Array.prototype.slice.call(arguments),n=[];for(e=0;e+1<t.length;e+=2)r(t[e])||(n={});for(e=0;e+1<t.length;e+=2)n[t[e]]=t[e+1];return n},s=function(){var e,t,r,n=Array.prototype.slice.call(arguments),s=n.every(Array.isArray)?[]:{};for(e in n){t=n[e];for(r in t)s[r]=t[r]}return s},i=function(e,t){return 0==t.length||void 0==e?e:i(e[t[0]],t.slice(1))},a=function(e,t,r){if(0==t.length)return r;var i=null==e?null:e[t[0]],r=a(i||[],t.slice(1),r);return s(e,n(t[0],r))},o=function(e){var t,r,n,s;if(null==e||""===e)t=null;else if(e.constructor===Array||e.constructor===Object){r=Array.isArray(e),t=r?[]:{};for(n in e)s=o(e[n]),null!=s&&(r?t.push(s):t[n]=s);0==Object.keys(t).length&&(t=null)}else t=e;return t},p=function(e,t){var r={},n={};for(key in t){var s=t[key];e(key,s)?r[key]=s:n[key]=s}return[r,n]},u=function(e,t){var r,n={};for(r in t)n[r]=e(t[r]);return n},l=function(e,t){var r,n={};for(r in t)n[e(r)]=t[r];return n};e.exports={object:n,merge:s,getIn:i,setIn:a,prune:o,split:p,map:u,mapKeys:l}},function(e,t,r){"use strict";e.exports={CheckBox:r(5),FileField:r(6),InputField:r(11),UserDefinedField:r(14),Selection:r(15),make:r(16)}},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=n.createClass({displayName:"CheckBox",handleChange:function(e){var t=e.target.checked;this.props.update(this.props.path,t,t)},render:function(){return s.input({name:this.props.label,type:"checkbox",checked:this.props.value||!1,onChange:this.handleChange})}});e.exports=i},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(3),a=r(7),o=r(10),p=n.createClass({displayName:"FileField",loadFile:function(e){var t=new FileReader,r=e.target.files[0],n=i.merge(this.props.getValue(this.props.path),{name:r.name,type:r.type,size:r.size});this.props.update(this.props.path,n,n),t.onload=function(e){n.data=e.target.result,this.props.update(this.props.path,n,n)}.bind(this),r&&("dataURL"===this.props.mode?t.readAsDataURL(r):t.readAsText(r))},render:function(){var e=this.props.fields||{},t=this.props.value||{},r=[s.input({key:"input",type:"file",onChange:this.loadFile}),s.dl({key:"fileProperties"},s.dt(null,"Name"),s.dd(null,t.name||"-"),s.dt(null,"Size"),s.dd(null,t.size||"-"),s.dt(null,"Type"),s.dd(null,t.type||"-"))];return o.section(this.props,r.concat(a.object(e,this.props)))}});e.exports=p},function(e,t,r){"use strict";function n(e,t){var r,n,s=Object.keys(t||{}),i=[];for(r in e||[])n=e[r],s.indexOf(n)>=0&&i.push(n);for(r in s)n=s[r],i.indexOf(n)<0&&i.push(n);return i}var s=r(3),i=r(8),a={alternative:function(e,t){var r=i.schema(t.getValue(t.path),t.schema,t.context);return a.object(e,s.merge(t,{schema:r}))},array:function(e,t){var r=Array.isArray(t.schema.items);if(r)return t.schema.items.map(function(r,n){return e.make(e,s.merge(t,{schema:r,path:t.path.concat(n)}))});for(var n=(t.getValue(t.path)||[]).length+1,i=[],a=0;n>a;++a)i.push(e.make(e,s.merge(t,{schema:t.schema.items,path:t.path.concat(a)})));return i},object:function(e,t){var r=n(t.schema["x-ordering"],t.schema.properties),i=r.map(function(r){return e.make(e,s.merge(t,{schema:t.schema.properties[r],path:t.path.concat(r)}))});if(t.schema.additionalProperties)for(var a=Object.keys(t.getValue(t.path)||{}).length+1,i=[],o=0;a>o;++o){var p={type:"object",title:"item:",properties:{key:{type:"string",title:"key"},value:t.schema.additionalProperties}};i.push(e.make(e,s.merge(t,{schema:p,path:t.path.concat("_additionalProperties").concat(o)})))}return i}};e.exports=a},function(e,t,r){"use strict";var n=r(3),s=r(9);t.schema=function(e,t,r){var i,a,o;if(i=n.getIn(t,["x-hints","form","selector"])){var p=t.oneOf.map(function(e){return s(e,r)});return a=p.map(function(e){return n.getIn(e,["properties",i,"enum",0])||""}),o=(e||{})[i]||a[0],n.merge(n.setIn(p[a.indexOf(o)],["properties",i],n.merge(n.getIn(t,["properties",i]),{"enum":a})),{type:"object"})}}},function(e,t,r){"use strict";function n(e){var t=[].slice.call(arguments),r=Array.isArray(e)?[]:{};for(var n in e)t.indexOf(n)<0&&(r[n]=e[n]);return r}var s=r(3);e.exports=function(e,t){var r=e.$ref;if(r){if(!r.match(/^#(\/([a-zA-Z_][a-zA-Z_0-9]*|[0-9]+))*$/))throw new Error("reference "+r+" has unsupported format");return s.merge(s.getIn(t,r.split("/").slice(1)),n(e,"$ref"))}return e}},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(3),a=function(e){return e&&0!==e.length?"error":""},o=function(e,t){var r=[];return e&&e.length>0&&r.push(e),t&&t.length>0&&r.push(t.join("\n")),r.join("\n\n")},p=n.createClass({displayName:"FieldWrapper",render:function(){var e=[].concat(a(this.props.errors)||[],"form-element",this.props.classes||[]);return s.div({className:e.join(" "),key:this.props.label,title:o(this.props.description,this.props.errors)},s.label({htmlFor:this.props.label},this.props.title),this.props.children)}}),u=n.createClass({displayName:"SectionWrapper",render:function(){var e=this.props.path.length,t=[].concat("form-section",e>0?"form-subsection":[],this.props.classes||[]),r=[].concat(a(this.props.errors)||[],"form-section-title");return s.fieldset({className:t.join(" "),key:this.props.label},s.legend({className:r.join(" "),title:o(this.props.description,this.props.errors)},this.props.title),this.props.children)}}),l=function(e){return{label:e.label,path:e.path,errors:e.errors,classes:i.getIn(e.schema,["x-hints","form","classes"]),title:e.schema.title,type:e.schema.type,description:e.schema.description}};t.section=function(e,t){return n.createElement(e.sectionWrapper||u,l(e),t)},t.field=function(e,t){return n.createElement(e.fieldWrapper||p,l(e),t)}},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(12),a=r(13),o=n.createClass({displayName:"InputField",normalize:function(e){return i[this.props.type](e)},parse:function(e){return a[this.props.type](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13===e.keyCode&&e.preventDefault()},render:function(){return s.input({type:"text",name:this.props.label,value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}});e.exports=o},function(e,t){"use strict";t.string=function(e){return e.replace(/\s+/g," ").replace(/^ /,"").replace(/\u00ad/g,"")},t.integer=function(e){return e.replace(/[^-\d]/g,"").replace(/(.)-/g,"$1")},t.number=function(e){return e.replace(/[^-\.e\d]/gi,"").replace(/(e[^e]*)e/gi,"$1").replace(/([e.][^.]*)\./gi,"$1").replace(/([^e])-/gi,"$1").replace(/(e-?\d\d\d)\d/gi,"$1")}},function(e,t,r){"use strict";var n=r(12);t.string=function(e){return n.string(e)},t.integer=function(e){return e?parseInt(n.integer(e)):null},t.number=function(e){return e?parseFloat(n.number(e)):null}},function(e,t,r){"use strict";var n=r(2),s=r(12),i=r(13),a=n.createClass({displayName:"UserDefinedField",normalize:function(e){var t=s[this.props.type];return t?t(e):e},parse:function(e){var t=i[this.props.type];return t?t(e):e},handleChange:function(e){var t=this.normalize(e);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13===e.keyCode&&e.preventDefault()},render:function(){return n.createElement(this.props.component,{schema:this.props.schema,value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}});e.exports=a},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(12),a=r(13),o=n.createClass({displayName:"Selection",normalize:function(e){var t=this.props.type||"string";return i[t](e)},parse:function(e){var t=this.props.type||"string";return a[t](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},render:function(){var e=this.props.names;return s.select({name:this.props.label,value:this.props.value||this.props.values[0],onChange:this.handleChange},this.props.values.map(function(t,r){return s.option({key:t,value:t},e[r]||t)}))}});e.exports=o},function(e,t,r){"use strict";function n(e){return e.join("_")}var s=r(2),i=r(3),a=r(9),o=r(7),p=r(10);e.exports=function(e,t){var r=a(t.schema,t.context),u=r["x-hints"]||{},l=i.getIn(u,["form","inputComponent"]),c=n(t.path);if(t=i.merge(t,{schema:r,key:c,label:c,value:t.getValue(t.path),errors:t.getErrors(t.path),type:r.type}),l)return t=i.merge(t,{component:t.handlers[l]}),p.field(t,s.createElement(e.UserDefinedField,t));if(u.fileUpload)return console.warn("DEPRECATION WARNING: built-in file upload will be removed"),t=i.merge(t,{fields:e}),s.createElement(e.FileField,i.merge(t,{mode:u.fileUpload.mode}));if(r.oneOf)return p.section(t,o.alternative(e,t));if(r["enum"])return t=i.merge(t,{values:r["enum"],names:r.enumNames||r["enum"]}),p.field(t,s.createElement(e.Selection,t));switch(r.type){case"boolean":return p.field(t,s.createElement(e.CheckBox,t));case"object":return p.section(t,o.object(e,t));case"array":return p.section(t,o.array(e,t));case"number":case"integer":case"string":default:return p.field(t,s.createElement(e.InputField,t))}}},function(e,t,r){"use strict";function n(e,t,r){var o,p,u=a(t,r);if(u.oneOf&&(u=i.schema(e,u,r)),u["enum"])o=e||u["enum"][0];else if("object"===u.type){o=s.merge(e);for(p in u.properties)o[p]=n((e||{})[p],u.properties[p],r)}else if("array"===u.type)for(o=[],p=0;p<(e||[]).length;++p)o[p]=n((e||[])[p],u.items,r);else o=e;return o}var s=r(3),i=r(8),a=r(9);e.exports=function(e,t,r){return s.prune(n(e,t,r))}}])});