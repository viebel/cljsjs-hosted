var range,testEl="undefined"!==typeof document?document.body||document.createElement("div"):{},hasAttribute;hasAttribute=testEl.hasAttribute?function(b,a){return b.hasAttribute(a)}:function(b,a){return b.getAttributeNode(a)};function empty(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0}
function toElement(b){!range&&document.createRange&&(range=document.createRange(),range.selectNode(document.body));var a;range&&range.createContextualFragment?a=range.createContextualFragment(b):(a=document.createElement("body"),a.innerHTML=b);return a.childNodes[0]}
var specialElHandlers={OPTION:function(b,a){(b.selected=a.selected)?b.setAttribute("selected",""):b.removeAttribute("selected","")},INPUT:function(b,a){b.checked=a.checked;b.value!=a.value&&(b.value=a.value);hasAttribute(a,"checked")||b.removeAttribute("checked");hasAttribute(a,"value")||b.removeAttribute("value")},TEXTAREA:function(b,a){var c=a.value;b.value!=c&&(b.value=c);b.firstChild&&(b.firstChild.nodeValue=c)}};function noop(){}
function morphAttrs(b,a){var c=a.attributes,e,d,m,p={};for(e=c.length-1;0<=e;e--)d=c[e],!1!==d.specified&&(m=d.name,d=d.value,p[m]=!0,b.getAttribute(m)!==d&&b.setAttribute(m,d));c=b.attributes;for(e=c.length-1;0<=e;e--)d=c[e],!1!==d.specified&&(m=d.name,p.hasOwnProperty(m)||b.removeAttribute(m))}function moveChildren(b,a){for(var c=b.firstChild;c;){var e=c.nextSibling;a.appendChild(c);c=e}return a}function defaultGetNodeKey(b){return b.id}
function morphdom(b,a,c){function e(r,b){var a=q(r);a?n[a]=r:b||k(r);if(1===r.nodeType)for(var c=r.firstChild;c;)e(c,b||a),c=c.nextSibling}function d(a){if(1===a.nodeType)for(a=a.firstChild;a;)q(a)||(k(a),d(a)),a=a.nextSibling}function m(a,b,c){!1!==z(a)&&(b.removeChild(a),c?q(a)||(k(a),d(a)):e(a))}function p(a,b,c,g){var d=q(b);d&&delete n[d];if(!g){if(!1===A(a,b))return;morphAttrs(a,b);if(!1===B(a,b))return}if("TEXTAREA"!=a.tagName){g=b.firstChild;var f=a.firstChild,e,h,k;a:for(;g;){h=g.nextSibling;
for(d=q(g);f;){var l=q(f);e=f.nextSibling;if(!c&&l&&(k=v[l]))k.parentNode.replaceChild(f,k),p(f,k,c);else{var u=f.nodeType;if(u===g.nodeType){var s=!1;1===u?(f.tagName===g.tagName&&(l||d?d===l&&(s=!0):s=!0),s&&p(f,g,c)):3===u&&(s=!0,f.nodeValue=g.nodeValue);if(s){g=h;f=e;continue a}}m(f,a,c)}f=e}d&&((f=n[d])?(p(f,g,!0),g=f):v[d]=g);a.appendChild(g);1===g.nodeType&&(d||g.firstChild)&&t.push(g);g=h;f=e}for(;f;)e=f.nextSibling,m(f,a,c),f=e}(c=specialElHandlers[a.tagName])&&c(a,b)}c||(c={});"string"===
typeof a&&(a=toElement(a));var n={},v={},q=c.getNodeKey||defaultGetNodeKey,k=c.onNodeDiscarded||noop,A=c.onBeforeMorphEl||noop,B=c.onBeforeMorphElChildren||noop,z=c.onBeforeNodeDiscarded||noop;c=!0===c.childrenOnly;var t=[],h=b,l=h.nodeType,w=a.nodeType;if(!c)if(1===l)1===w?b.tagName!==a.tagName&&(k(b),h=moveChildren(b,document.createElement(a.tagName))):h=a;else if(3===l){if(3===w)return h.nodeValue=a.nodeValue,h;h=a}if(h===a)k(b);else{p(h,a,!1,c);var x=function(a){for(a=a.firstChild;a;){var b=a.nextSibling,
c=q(a);if(c&&(c=n[c])&&a.tagName===c.tagName){a.parentNode.replaceChild(c,a);p(c,a,!0);a=b;if(empty(n))return!1;continue}1===a.nodeType&&x(a);a=b}};if(!empty(n))a:for(;t.length;)for(a=t,t=[],l=0;l<a.length;l++)if(!1===x(a[l]))break a;for(var y in n)n.hasOwnProperty(y)&&(a=n[y],k(a),d(a))}!c&&h!==b&&b.parentNode&&b.parentNode.replaceChild(h,b);return h};