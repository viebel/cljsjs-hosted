(function(f){var a={RELAXED:!1,IGNORE_RECORD_LENGTH:!1,IGNORE_QUOTES:!1,LINE_FEED_OK:!0,CARRIAGE_RETURN_OK:!0,DETECT_TYPES:!0,IGNORE_QUOTE_WHITESPACE:!0,DEBUG:!1,COLUMN_SEPARATOR:",",ERROR_EOF:"UNEXPECTED_END_OF_FILE",ERROR_CHAR:"UNEXPECTED_CHARACTER",ERROR_EOL:"UNEXPECTED_END_OF_RECORD",WARN_SPACE:"UNEXPECTED_WHITESPACE",parse:function(b){var d=a.result=[];a.offset=0;a.str=b;a.record_begin();a.debug("parse()",b);for(var c;;){c=b[a.offset++];a.debug("c",c);if(null==c){a.escaped&&a.error(a.ERROR_EOF);
a.record&&(a.token_end(),a.record_end());a.debug("...bail",c,a.state,a.record);a.reset();break}if(null==a.record){if(a.RELAXED&&("\n"==c||"\r"==c&&"\n"==b[a.offset+1]))continue;a.record_begin()}if(0==a.state){if((" "===c||"\t"===c)&&'"'==a.next_nonspace())if(a.RELAXED||a.IGNORE_QUOTE_WHITESPACE)continue;else a.warn(a.WARN_SPACE);if('"'==c&&!a.IGNORE_QUOTES){a.debug("...escaped start",c);a.escaped=!0;a.state=1;continue}a.state=1}1==a.state&&a.escaped?'"'==c?'"'==b[a.offset]?(a.debug("...escaped quote",
c),a.token+='"',a.offset++):(a.debug("...escaped end",c),a.escaped=!1,a.state=2):(a.token+=c,a.debug("...escaped add",c,a.token)):"\r"==c?("\n"==b[a.offset]?a.offset++:a.CARRIAGE_RETURN_OK||a.error(a.ERROR_CHAR),a.token_end(),a.record_end()):"\n"==c?(a.LINE_FEED_OK||a.RELAXED||a.error(a.ERROR_CHAR),a.token_end(),a.record_end()):c==a.COLUMN_SEPARATOR?a.token_end():1==a.state?(a.token+=c,a.debug("...add",c,a.token)):" "===c||"\t"===c?a.IGNORE_QUOTE_WHITESPACE||a.error(a.WARN_SPACE):a.RELAXED||a.error(a.ERROR_CHAR)}return d},
stream:function(){var b=(new require("stream")).Transform({objectMode:!0});b.EOL="\n";b.prior="";b.emitter=function(b){return function(c){b.push(a.parse(c+b.EOL))}}(b);b._transform=function(a,b,e){a=""==this.prior?a.toString().split(this.EOL):(this.prior+a.toString()).split(this.EOL);this.prior=a.pop();a.forEach(this.emitter);e()};b._flush=function(a){""!=this.prior&&(this.emitter(this.prior),this.prior="");a()};return b}};a.stream.json=function(){var a=(new require("stream")).Transform({objectMode:!0});
a._transform=function(d,c,e){a.push(JSON.stringify(d.toString())+require("os").EOL);e()};return a};a.reset=function(){a.state=null;a.token=null;a.escaped=null;a.record=null;a.offset=null;a.result=null;a.str=null};a.next_nonspace=function(){for(var b=a.offset,d;b<a.str.length;)if(d=a.str[b++]," "!=d&&"\t"!==d)return d;return null};a.record_begin=function(){a.escaped=!1;a.record=[];a.token_begin();a.debug("record_begin")};a.record_end=function(){a.state=4;!a.IGNORE_RECORD_LENGTH&&!a.RELAXED&&0<a.result.length&&
a.record.length!=a.result[0].length&&a.error(a.ERROR_EOL);a.result.push(a.record);a.debug("record end",a.record);a.record=null};a.resolve_type=function(a){a.match(/^\d+(\.\d+)?$/)?a=parseFloat(a):a.match(/^(true|false)$/i)?a=Boolean(a.match(/true/i)):"undefined"===a?a=void 0:"null"===a&&(a=null);return a};a.token_begin=function(){a.state=0;a.token=""};a.token_end=function(){a.DETECT_TYPES&&(a.token=a.resolve_type(a.token));a.record.push(a.token);a.debug("token end",a.token);a.token_begin()};a.debug=
function(){a.DEBUG&&console.log(arguments)};a.dump=function(b){return[b,"at char",a.offset,":",a.str.substr(a.offset-50,50).replace(/\r/mg,"\\r").replace(/\n/mg,"\\n").replace(/\t/mg,"\\t")].join(" ")};a.error=function(b){b=a.dump(b);a.reset();throw b;};a.warn=function(b){b=a.dump(b);try{console.warn(b);return}catch(d){}try{console.log(b)}catch(c){}};if("undefined"!=typeof module&&module.exports)module.exports=a;else{if("undefined"!=typeof exports)exports.CSV=a;else if("function"==typeof define&&
"object"==typeof define.amd){define([],function(){return a});return}f&&(f.CSV=a)}})(this);