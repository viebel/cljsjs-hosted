(function(){function h(a){for(;a;){if("DIALOG"==a.nodeName.toUpperCase())return a;a=a.parentElement}return null}function k(a){a&&a.blur&&a!=document.body&&a.blur()}function l(a){this.dialog_=a;this.openAsModal_=this.replacedStyleTop_=!1;a.hasAttribute("role")||a.setAttribute("role","dialog");a.show=this.show.bind(this);a.showModal=this.showModal.bind(this);a.close=this.close.bind(this);"returnValue"in a||(a.returnValue="");this.maybeHideModal=this.maybeHideModal.bind(this);"MutationObserver"in window?
(new MutationObserver(this.maybeHideModal)).observe(a,{attributes:!0,attributeFilter:["open"]}):a.addEventListener("DOMAttrModified",this.maybeHideModal);Object.defineProperty(a,"open",{set:this.setOpen.bind(this),get:a.hasAttribute.bind(a,"open")});this.backdrop_=document.createElement("div");this.backdrop_.className="backdrop";this.backdropClick_=this.backdropClick_.bind(this)}var d=window.CustomEvent;d&&"object"!=typeof d||(d=function(a,b){b=b||{};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,
!!b.bubbles,!!b.cancelable,b.detail||null);return c},d.prototype=window.Event.prototype);l.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){!this.openAsModal_||this.dialog_.hasAttribute("open")&&document.body.contains(this.dialog_)||(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.removeEventListener("click",this.backdropClick_),this.backdrop_.parentElement&&this.backdrop_.parentElement.removeChild(this.backdrop_),
c.dm.removeDialog(this))},setOpen:function(a){a?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(a){var b=document.createEvent("MouseEvents");b.initMouseEvent(a.type,a.bubbles,a.cancelable,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);this.dialog_.dispatchEvent(b);a.stopPropagation()},updateZIndex:function(a,b){this.backdrop_.style.zIndex=
a;this.dialog_.style.zIndex=b},show:function(){this.setOpen(!0)},showModal:function(){if(this.dialog_.hasAttribute("open"))throw Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!document.body.contains(this.dialog_))throw Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!c.dm.pushDialog(this))throw Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");this.show();
this.openAsModal_=!0;c.needsCentering(this.dialog_)?(c.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1;this.backdrop_.addEventListener("click",this.backdropClick_);this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling);var a=this.dialog_.querySelector("[autofocus]:not([disabled])");a||(a=["button","input","keygen","select","textarea"].map(function(a){return a+":not([disabled])"}).join(", "),a=this.dialog_.querySelector(a));k(document.activeElement);
a&&a.focus()},close:function(a){if(!this.dialog_.hasAttribute("open"))throw Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1);void 0!==a&&(this.dialog_.returnValue=a);a=new d("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(a)}};var c={reposition:function(a){var b=document.body.scrollTop||document.documentElement.scrollTop;a.style.top=Math.max(b,b+(window.innerHeight-a.offsetHeight)/2)+"px"},
isInlinePositionSetByStylesheet:function(a){for(var b=0;b<document.styleSheets.length;++b){var c=document.styleSheets[b],d=null;try{d=c.cssRules}catch(m){}if(d)for(c=0;c<d.length;++c){var g=d[c],e=null;try{e=document.querySelectorAll(g.selectorText)}catch(h){}var f;if(!(f=!e)){a:{for(f=0;f<e.length;++f)if(e[f]==a){e=!0;break a}e=!1}f=!e}if(!f&&(e=g.style.getPropertyValue("top"),g=g.style.getPropertyValue("bottom"),e&&"auto"!=e||g&&"auto"!=g))return!0}}return!1},needsCentering:function(a){return"absolute"!=
window.getComputedStyle(a).position||"auto"!=a.style.top&&""!=a.style.top||"auto"!=a.style.bottom&&""!=a.style.bottom?!1:!c.isInlinePositionSetByStylesheet(a)},forceRegisterDialog:function(a){a.showModal&&console.warn("This browser already supports \x3cdialog\x3e, the polyfill may not work correctly",a);if("DIALOG"!=a.nodeName.toUpperCase())throw Error("Failed to register dialog: The element is not a dialog.");new l(a)},registerDialog:function(a){a.showModal?console.warn("Can't upgrade \x3cdialog\x3e: already supported",
a):c.forceRegisterDialog(a)},DialogManager:function(){this.pendingDialogStack=[];this.overlay=document.createElement("div");this.overlay.className="_dialog_overlay";this.overlay.addEventListener("click",function(a){a.stopPropagation()});this.handleKey_=this.handleKey_.bind(this);this.handleFocus_=this.handleFocus_.bind(this);this.handleRemove_=this.handleRemove_.bind(this);this.zIndexLow_=1E5;this.zIndexHigh_=100150}};c.DialogManager.prototype.topDialogElement=function(){return this.pendingDialogStack.length?
this.pendingDialogStack[this.pendingDialogStack.length-1].dialog:null};c.DialogManager.prototype.blockDocument=function(){document.body.appendChild(this.overlay);document.body.addEventListener("focus",this.handleFocus_,!0);document.addEventListener("keydown",this.handleKey_);document.addEventListener("DOMNodeRemoved",this.handleRemove_)};c.DialogManager.prototype.unblockDocument=function(){document.body.removeChild(this.overlay);document.body.removeEventListener("focus",this.handleFocus_,!0);document.removeEventListener("keydown",
this.handleKey_);document.removeEventListener("DOMNodeRemoved",this.handleRemove_)};c.DialogManager.prototype.updateStacking=function(){for(var a=this.zIndexLow_,b=0;b<this.pendingDialogStack.length;b++)b==this.pendingDialogStack.length-1&&(this.overlay.style.zIndex=a++),this.pendingDialogStack[b].updateZIndex(a++,a++)};c.DialogManager.prototype.handleFocus_=function(a){if(h(a.target)!=this.topDialogElement())return a.preventDefault(),a.stopPropagation(),k(a.target),!1};c.DialogManager.prototype.handleKey_=
function(a){if(27==a.keyCode){a.preventDefault();a.stopPropagation();a=new d("cancel",{bubbles:!1,cancelable:!0});var b=this.topDialogElement();b.dispatchEvent(a)&&b.close()}};c.DialogManager.prototype.handleRemove_=function(a){if("DIALOG"==a.target.nodeName.toUpperCase()){var b=a.target;b.open&&this.pendingDialogStack.some(function(a){if(a.dialog==b)return a.maybeHideModal(),!0})}};c.DialogManager.prototype.pushDialog=function(a){if(this.pendingDialogStack.length>=(this.zIndexHigh_-this.zIndexLow_)/
2-1)return!1;this.pendingDialogStack.push(a);1==this.pendingDialogStack.length&&this.blockDocument();this.updateStacking();return!0};c.DialogManager.prototype.removeDialog=function(a){a=this.pendingDialogStack.indexOf(a);-1!=a&&(this.pendingDialogStack.splice(a,1),this.updateStacking(),0==this.pendingDialogStack.length&&this.unblockDocument())};c.dm=new c.DialogManager;document.addEventListener("submit",function(a){var b=a.target;if(b&&b.hasAttribute("method")&&"dialog"==b.getAttribute("method").toLowerCase()&&
(a.preventDefault(),b=h(a.target))){var c,d=["BUTTON","INPUT"];[document.activeElement,a.explicitOriginalTarget].some(function(b){if(b&&b.form==a.target&&-1!=d.indexOf(b.nodeName.toUpperCase()))return c=b.value,!0});b.close(c)}},!0);c.forceRegisterDialog=c.forceRegisterDialog;c.registerDialog=c.registerDialog;"object"===typeof module&&"object"===typeof module.exports?module.exports=c:"function"===typeof define&&"amd"in define?define(function(){return c}):window.dialogPolyfill=c})();